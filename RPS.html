<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
<html>
<style>
#myHeader {
  background-color: lightblue;
  color: black;
  padding: 20px;
  text-align: center;
} 
</style>
<style>
div.b {
  line-height: .5;
}

</style>

 <head>
  <title>Back Test Retirement Plan</title>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
 </head>

<h1 id="myHeader">Retirement Plan Simulator</h1>

<body style="background-color:whitesmoke;"

<div class="w3-bar w3-black">
   <a href="RPS_Disclaimer.html" >Disclaimer</a>
   &nbsp;&nbsp;&nbsp;
   <a href="RPS_User_Guide.pdf" >User Guide</a> 
   &nbsp;&nbsp;&nbsp;
   <a href="mailto:josephnagy72@gmail.com" >Contact Me</a>   
</div>

<form onsubmit=" ">
<div align="left">
<p> 

<fieldset>
  <legend> <b> Plan Info </b> </legend>

<input type="button" value="List Plans" onclick="listplans(this.form)">

<label for="plan_id">Plan Name:</label> 
   <input type="text" name="plan_id" value="Demo Plan" style="width: 200;">

<input type="button" value="Get Plan" onclick="getprev(this.form)">

 <label for="sim_start_yr">Simulation Start Year: </label> 
     <input id='sim_start_yr' type="number" name="sim_start_yr" value=2024 min="1900" max="2100" style="width: 55px;"> 

<label for="plan_dsc">Plan Desc:</label> 
    <input type="text" name="plan_dsc" value="Default Name for Demonstration.  Scroll down and press Run Simulation button." style="width: 600;">
</fieldset>
<br>

<fieldset>
  <legend> <b> Your Information </b> </legend>
     <label for="you_birth_yr">Birth Year: </label> 
     <input id='you_birth_yr' type="number" name="you_birth_yr" value=1961 style="width: 55px;"> 

     <label for="you_birth_mth">Birth Month: </label> 
     <input id='you_birth_mth' type="number" name="you_birth_mth" value=01 min="01" max="12" style="width: 50px;"> 

     <label for="you_retire_age">Retire Begin Age:</label> 
     <input type="number" name="you_retire_age" value=62 min="20" max="99" style="width: 50px;"> 

     <label for="you_retire_end_age">Retire End Age:</label>  
     <input type="number" name="you_retire_end_age" value="91" min="20" max="99" style="width: 50px;">

     <div class="b"><br> </div>

     <label for="you_socsec_age">Soc Sec Start Age:</label> 	
     <input type="number" name="you_socsec_age" value="70" min="62" max="70" style="width: 50px;">

     <label for="you_socsec_amt">Annual Social Security Amt:</label> 	
     <input type="number" name="you_socsec_amt" value=40000 min="0" max="100000" style="width: 75px;"     >
    
     <label for="you_ira_start_bal_amt">IRA/401K Balance:</label>
     <input type="number" name="you_ira_start_bal_amt" value=500000 min="0" max="999999999" style="width: 100px;">

     <label for="you_ira_ann_dep_amt">IRA/401K Annual Deposit:</label>
     <input type="number" name="you_ira_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

      <div class="b"><br> </div>
     <label for="you_pension_amt">Annual Pension:</label> 
     <input type="number" name="you_pension_amt" value=0 min="0" max="999999" style="width: 75px;">

     <label for="you_pension_beg_age">Pension Begin Age:</label> 
     <input type="number" name="you_pension_begin_age" value=0 min="0" max="99" style="width: 50px;"	>

    <label for="you_pension_inf_pct">Annual Pension Inflation Adjustment %:</label> 
    <input type="number" name="you_pension_inf_pct" value=0 min="0" max="10" style="width: 50px;">

    <label for="you_pension_survivor_pct">Pension Survivor %:</label> 
    <input type="number" name="you_pension_survivor_pct" value=0 min="0" max="100" style="width: 50px;">

</fieldset>
<br>
<fieldset>
  <legend><b> Spouse Information </b> </legend>
     
     <label for="spo_birth_yr">Birth Year: </label> 
     <input id='spo_birth_yr' type="number" name="spo_birth_yr" value=1961 style="width: 55px;"> 

     <label for="spo_birth_mth">Birth Month: </label> 
     <input id='spo_birth_mth' type="number" name="spo_birth_mth" value=01 min="01" max="12" style="width: 50px;"> 

     <label for="spo_retire_age">Retire Begin Age:</label> 
     <input type="number" name="spo_retire_age" value=62 min="20" max="99" style="width: 50px;"> 

     <label for="spo_retire_end_age">Retire End Age:</label> 
     <input type="number" name="spo_retire_end_age" value=94 min="20" max="99" style="width: 50px;">
   
     <div class="b"><br> </div>

     <label for="spo_socsec_age">Soc Sec Start Age:</label>  	
     <input type="number" name="spo_socsec_age" value=62 min="62" max="70" style="width: 50px;">
     
     <label for="spo_socsec_amt">Annual Social Security Amt:</label>
     <input type="number" name="spo_socsec_amt" value=20000 min="0" max="100000" style="width: 75px;">       

     <label for="spo_ira_start_bal_amt">IRA/401k Balance:</label> 
     <input type="number" name="spo_ira_start_bal_amt" value=300000 min="0" max="999999999" style="width: 100px;">

     <label for="spo_ira_ann_dep_amt">IRA/401k Annual Deposit:</label> 
     <input type="number" name="spo_ira_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

     <label for="spo_taxinc_amt">Taxable Income:</label> 
     <input type="number" name="spo_taxinc_amt" value=0 min="0" max="999999" style="width: 75px;">

     <label for="spo_takhom_amt">Take Home:</label> 
     <input type="number" name="spo_takhom_amt" value=0 min="0" max="999999" style="width: 75px;">


     <div class="b"><br> </div>

     <label for="spo_pension_amt">Annual Pension:</label> 
     <input type="number" name="spo_pension_amt" value=0 min="0" max="999999" style="width: 75px;">

     <label for="spo_pension_beg_age">Pension Begin Age:</label> 
     <input type="number" name="spo_pension_begin_age" value=0 min="0" max="99" style="width: 50px;">

    <label for="spo_pension_inf_pct">Annual Pension Inflation Adjustment %:</label> 
    <input type="number" name="spo_pension_inf_pct" value=0 min="0" max="10" style="width: 50px;">

    <label for="spo_pension_survivor_pct">Pension Survivor %:</label>  
    <input type="number" name="spo_pension_survivor_pct" value=0 min="0" max="100" style="width: 50px;">

</fieldset>
<br>
<fieldset>
  <legend><b> Brokerage / Home Information </b> </legend>

    <label for="brkrg_start_bal_amt">Current Balance:</label>
    <input type="number" name="brkrg_start_bal_amt" value=100000 min="0" max="999999999" style="width: 100px;">

    <label for="brkrg_cost_basis_amt">Cost Basis:</label>
    <input type="number" name="brkrg_cost_basis_amt" value=50000 min="0" max="999999999" style="width: 100px;">

     <label for="brkrg_ann_dep_amt">Annual Deposit:</label> 
     <input type="number" name="brkrg_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

     <label for="brkrg_taxable_dist_pct">Taxable Distribution %:</label>  
        <input type="number" name="brkrg_taxable_dist_pct" value=2 min="0" max="10" style="width: 50px;">

    <label for="home_equity_amt">Home Equity:</label>
      <input type="number" name="home_equity_amt" value=200000 min="0" max="999999999" style="width: 100px;">
</fieldset> 
<br>

<fieldset>
  <legend><b> Roth Account Information </b> </legend>

    <label for="roth_start_bal_amt">Roth Current Balance:</label> 
    <input type="number" name="roth_start_bal_amt" value=200000 min="0" max="999999999" style="width: 100px;">

     <label for="roth_ann_dep_amt">Roth Annual Deposit:</label> 
     <input type="number" name="roth_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

    <label for="roth_conv_pct">Roth Conversion Max Tax Bracket:</label>
         <select name="roth_conv_pct" id="roth_conv_pct">
           <option value="none">None</option>
           <option value="0">0%</option>
           <option value="10">10%</option>
           <option value="12">12%</option>
           <option value="22">22%</option>
           <option value="24">24%</option>
          value="none"
          </select>

    <label for="roth_conv_end_age">Roth Conv End Age:</label> 
     <input type="number" name="roth_conv_end_age" value="62" min="20" max="99" style="width: 50px;"> 


    <label for="roth_draw_begin_age">Roth Draw Begin Age:</label> 
     <input type="number" name="roth_draw_begin_age" value="62" min="20" max="99" style="width: 50px;"> 

    <label for="pre_roth_ftb_pct">Fill the Bracket Max Tax %:</label>
         <select name="pre_roth_ftb_pct" id="pre_roth_ftb_pct">
           <option value="None">None</option>
           <option value="0">0%</option>
           <option value="10">10%</option>
           <option value="12">12%</option>
           <option value="22">22%</option>
           <option value="24">24%</option>
          value=0
          </select>
   <br>
   <label for="roth_flatdraw_amt">Roth Flat Draw:</label> 
     <input type="number" name="roth_flatdraw_amt" value=0 min="0" max="999999" style="width: 75px;">

   <label for="roth_flatend_age">Roth Flat End Age:</label> 
     <input type="number" name="roth_flatend_age" value="62" min="20" max="99" style="width: 50px;"> 



  </fieldset> 
  <br>
  <fieldset>
  <legend><b> HSA Account Information </b> </legend>
 
   <label for="hsa_start_bal_amt">HSA Current Balance:</label> 
    <input type="number" name="hsa_start_bal_amt" value=0 min="0" max="999999999" style="width: 100px;">

   <label for="hsa_ann_dep_amt">HSA Annual Deposit:</label> 
     <input type="number" name="hsa_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

   <label for="hsa_use_flag">HSA MedB Prem Use:</label>
         <select name="hsa_use_flag" id="hsa_use_flag">
           <option value="none">None</option>
           <option value="medb">MedB</option>
         </select>

   <div class="b"><br> </div>

  <label for="hsa_init_draw_amt">HSA Initial Flat Draw Amt:</label> 
     <input type="number" name="hsa_init_draw_amt" value=0 min="0" max="999999" style="width: 75px;">

  <label for="hsa_init_begin_age">HSA Initial Draw Begin Age:</label> 
     <input type="number" name="hsa_init_begin_age" value=65 min="20" max="99" style="width: 50px;"> 

  <label for="hsa_init_end_age">HSA Initial Draw End Age:</label> 
     <input type="number" name="hsa_init_end_age" value=65 min="20" max="99" style="width: 50px;"> 

  <label for="hsa_reg_draw_amt">HSA Subsequent Regular Flat Draw Amt:</label> 
     <input type="number" name="hsa_reg_draw_amt" value=0 min="0" max="999999" style="width: 75px;">


    
</fieldset> 
<br>

<fieldset>
    <legend><b> Annual Budget </b> </legend>

    <label for="trans_budget_amt">Year 1 Budget Adjust Amt:</label> 
    <input type="number" name="trans_budget_amt" value=0 min="0" max="999999" style="width: 75px;">

    <label for="full_budget_amt">Full Initial Budget Amt:</label> 
    <input type="number" name="full_budget_amt" value=85000 min="0" max="999999" style="width: 75px;">

    <label for="lastx_budget_amt">Asstd Living Amt:</label> 
    <input type="number" name="lastx_budget_amt" value=200000 min="0" max="9999999" style="width: 75px;">

    <label for="lastx_years">Asstd Living Years:</label> 
    <input type="number" name="lastx_years" value=3 min="0" max="9" style="width: 50 px;">

    <label for="mortgage_budget_amt">Mortgage Amt:</label> 
    <input type="number" name="mortgage_budget_amt" value=12000 min="0" max="999999" style="width: 75px;">

    <label for="mortgage_end_age">Age Mortgage Ends:</label> 
    <input type="number" name="mortgage_end_age" value=65 min="0" max="99" style="width: 50px;">

</fieldset> 

<br>
<fieldset>
  <legend><b> Annual Budget % Reductions </b> </legend>

    <label for="gogo_reduce_pct">Go Go % (age < 75):</label> 
       <input type="number" name="gogo_reduce_pct" value=0 min="0" max="100" style="width: 50px;" >

    <label for="slogo_reduce_pct">Slow Go % (age < 85):</label> 
       <input type="number" name="slogo_reduce_pct" value=0 min="0" max="100" style="width: 50px;" >

    <label for="nogo_reduce_pct">No Go % (age > 85):</label> 
       <input type="number" name="nogo_reduce_pct" value=0 min="0" max="100" style="width: 50px;" >

</fieldset> 
<br>
<fieldset>
  <legend><b> Asset Allocation </b> </legend>
    
    <label for="gogo_stock_pct">GoGo Stock Allocation %:</label> 
    <input type="number" name="gogo_stock_pct" value=60 min="0" max="100" style="width: 50px;" >

    <label for="slogo_stock_pct">SloGo Stock Allocation %:</label> 
    <input type="number" name="slogo_stock_pct" value=60 min="0" max="100" style="width: 50px;" >

    <label for="nogo_stock_pct">NoGo Stock Allocation %:</label> 
    <input type="number" name="nogo_stock_pct" value=60 min="0" max="100" style="width: 50px;" >

    <label for="lastx_stock_pct">Assisted Living Stock Allocation %:</label> 
    <input type="number" name="lastx_stock_pct" value=0 min="0" max="100" style="width: 50px;" >

</fieldset> 
<br>


<fieldset>
  <legend><b> Variable Withdraw / Base Plan Parameters </b> </legend>
    
    <label for="bonus_pct">Variable Withdraw %:</label>
    <input type="number" name="bonus_pct" value=10 min="0" max="100" style="width: 50px;">

    <label for="baseline_stock_return_pct">Base Stock Return %:</label>
    <input type="number" name="baseline_stock_return_pct" value=7 min="0" max="10" style="width: 50px;">

    <label for="baseline_bond_return_pct">Base Bond Return %:</label>
    <input type="number" name="baseline_bond_return_pct" value=3 min="0" max="10" style="width: 50px;">

     <label for="baseline_inf_pct">Base Inflation %:</label>
    <input type="number" name="baseline_inf_pct" value=2.25 min="0" max="10" style="width: 50px;">

   <label for="baseline_frozen_flag">Use Frozen Baseline:</label>
         <select name="baseline_frozen_flag" id="baseline_frozen_flag">
           <option value="N">No</option>
           <option value="Y">Yes</option>
          </select>


</fieldset> 
<br>


<fieldset>
  <legend><b> Misc Parameters </b> </legend>
    
   <label for="medb_flag">Include Medicare B Premium:</label>
         <select name="medb_flag" id="medb_flag">
           <option value="NO">No</option>
           <option value="YES">Yes</option>
         </select>

   <label for="qcd_pct">QCD %:</label>
       <input type="number" name="qcd_pct" value=0 min="0" max="10" style="width: 50px;">

   <label for="early_death_pct">Early Death Budget %:</label>
       <input type="number" name="early_death_pct" value=75 min="50" max="100" style="width: 50px;">

   <label for="rpt_fmt_flag">Report Format:</label>
         <select name="rpt_fmt_flag" id="rpt_fmt_flag">
           <option value="Basic">Basic</option>
           <option value="Detail">Detail</option>
         </select>
   </fieldset> 

   
<br>
<input type="button" value="Run Simulation" onclick="calcdraw(this.form,'NO')">

<input type="button" value="Download Detail Results" onclick="calcdraw(this.form,'YES')">

<input type="button" value="Save Plan" onclick="save_plan(this.form)">

<input type="button" value="Delete Plan" onclick="delete_plan(this.form)">

<p id="showresults">


</div>
</form>

<script type="text/javascript">
 function getprev(form) 
  { 

   fFrm_Plan_Id = form.plan_id.value; 
   fFrm_Plan_Id = fFrm_Plan_Id.trim();

   form.plan_dsc.value     = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_plan_dsc"));
   form.you_birth_yr.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_birth_yr"));
   form.you_birth_mth.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_birth_mth"));

   form.spo_birth_yr.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_birth_yr"));
   form.spo_birth_mth.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_birth_mth"));

   form.roth_conv_end_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_roth_conv_end_age"));
   form.roth_draw_begin_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_roth_draw_begin_age"));

   form.roth_flatdraw_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_roth_flatdraw_amt"));
   form.roth_flatend_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_roth_flatend_age"));


   form.spo_pension_begin_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_begin_age"));
   form.spo_pension_inf_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_inf_pct"));
   form.spo_pension_survivor_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_survivor_pct"));
   form.spo_retire_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_retire_age"));
   form.spo_socsec_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_socsec_age"));
   form.you_pension_begin_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_pension_begin_age"));
   form.you_pension_inf_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_pension_inf_pct"));
   form.you_pension_survivor_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_pension_survivor_pct"));
   form.you_retire_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_retire_age"));
   form.you_socsec_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_socsec_age"));
   form.brkrg_start_bal_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_brkrg_start_bal_amt"));
   form.brkrg_cost_basis_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_brkrg_cost_basis_amt"));
   form.home_equity_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_home_equity_amt"));
//
   form.trans_budget_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_trans_budget_amt"));
   
   form.full_budget_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_full_budget_amt"));
   
   form.lastx_budget_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_lastx_budget_amt"));
   form.lastx_years.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_lastx_years"));

   form.mortgage_budget_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_mortgage_budget_amt"));
   form.mortgage_end_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_mortgage_end_age"));

   form.gogo_reduce_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_gogo_reduce_pct"));
   form.nogo_reduce_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_nogo_reduce_pct"));
   form.slogo_reduce_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_slogo_reduce_pct"));

   form.spo_ira_start_bal_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_ira_start_bal_amt"));
   form.spo_pension_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_amt"));
   form.spo_socsec_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_socsec_amt"));
   form.you_ira_start_bal_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_ira_start_bal_amt"));
   form.you_pension_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_pension_amt"));
   form.you_socsec_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_socsec_amt"));
   form.gogo_stock_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_stock_pct"));
   form.slogo_stock_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_slogo_stock_pct"));
   form.nogo_stock_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_nogo_stock_pct"));
   form.lastx_stock_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_lastx_stock_pct"));

   if (form.slogo_stock_pct.value == "") {form.slogo_stock_pct.value = form.gogo_stock_pct.value;}
   if (form.nogo_stock_pct.value == "") {form.nogo_stock_pct.value = form.gogo_stock_pct.value;}
   if (form.lastx_stock_pct.value == "") {form.lastx_stock_pct.value = form.gogo_stock_pct.value;}

   form.bonus_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_bonus_pct"));
   form.medb_flag.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_medb_flag"));
   if (form.medb_flag.value == "") {form.medb_flag.value = "YES";}

   form.spo_retire_end_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_retire_end_age"));
   form.you_retire_end_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_retire_end_age"));
   form.roth_start_bal_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_roth_start_bal_amt"));
   form.roth_conv_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_roth_conv_pct"));
   form.pre_roth_ftb_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_pre_roth_ftb_pct"));
   if(form.pre_roth_ftb_pct.value == "") {form.pre_roth_ftb_pct.value = "0";}

   form.hsa_start_bal_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_hsa_start_bal_amt"));
   form.hsa_ann_dep_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_hsa_ann_dep_amt"));
   form.hsa_use_flag.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_hsa_use_flag"));

   form.hsa_init_draw_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_draw_amt"));
   form.hsa_init_begin_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_begin_age"));
   form.hsa_init_end_age.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_end_age"));
   form.hsa_reg_draw_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_hsa_reg_draw_amt"));
   
   form.you_ira_ann_dep_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_you_ira_ann_dep_amt"));
   form.spo_ira_ann_dep_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_ira_ann_dep_amt"));
   form.spo_takhom_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_takhom_amt"));
   form.spo_taxinc_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_spo_taxinc_amt"));

   form.brkrg_ann_dep_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_brkrg_ann_dep_amt"));
   form.roth_ann_dep_amt.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_roth_ann_dep_amt"));
   
   form.brkrg_taxable_dist_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_brkrg_taxable_dist_pct"));

   form.baseline_stock_return_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_baseline_stock_return_pct"));
   form.baseline_bond_return_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_baseline_bond_return_pct"));
   form.baseline_inf_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_baseline_inf_pct"));
   if (form.baseline_inf_pct.value == "") {form.baseline_inf_pct.value = 2.25;}
   
   form.baseline_frozen_flag.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_baseline_frozen_flag"));
   if (form.baseline_frozen_flag.value == "") {form.baseline_frozen_flag.value = "N";}
   

   form.qcd_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_qcd_pct"));
   if (form.qcd_pct.value == "") {form.qcd_pct.value = 0;}

   form.early_death_pct.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_early_death_pct"));
   if (form.early_death_pct.value == "") {form.early_death_pct.value = 75;}

   form.rpt_fmt_flag.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_rpt_fmt_flag"));

   form.sim_start_yr.value = localStorage.getItem(fFrm_Plan_Id.concat("SimpSim_sim_start_yr"));
   
   if (form.sim_start_yr.value == "") {form.sim_start_yr.value = 2023;}
  }  
</script>

<script type="text/javascript">
 function listplans(form) 
  {   

      Table_Results = ' <style> table, th, td {border: 1px solid black; } </style>';
      
      TableResults = Table_Results + '<table id = "Scenario_Results">' + 
                          '<thead>' +
                          '<tr>' +
                          '<th colspan="1" style="background-color:#4d7e80">____Plan Name____</th> ' +
                          '<th colspan="1" style="background-color:#4d7e80">____Plan Description____</th> ' +
                          ' </tr> ' ;

     storedPlans = localStorage.getItem("SimpSim_stored_plans");
     storedPlans = JSON.parse(storedPlans);

     for (var i = 0; i < storedPlans.length; i++)
       {
        
          Plan_Id = storedPlans[i];
          Plan_Dsc  = localStorage.getItem(Plan_Id.concat("SimpSim_plan_dsc"));
          TableResults = TableResults +  '<tr>' +        
            '<td align = "left"> ' + storedPlans[i] + " </td> " +
             '<td align = "left"> ' + Plan_Dsc    + " </td> " +
            " </tr>" ;
       }      

    openWin2(TableResults); 

  }
</script>

<script type="text/javascript">
 function clearplans(form) 
  { 
  localStorage.clear();      

  }  
</script>

<script type="text/javascript">
 function calcdraw(form, fDownload_Results) {

      error_message = '';
      error_message1 = '<p> Ooops.  Errors found on input</p>';

      if (form.you_birth_yr.value > 2100) 
          {error_message = error_message + "<p> Your Birth Year Invalid. </p> ";  }
  
      if (form.you_birth_yr.value < 1900) 
        {error_message = error_message + "<p> Your Birth Year Invalid. </p> "; }
      
      if (form.you_birth_mth.value > 12) 
          {error_message = error_message + "<p> Your Birth Month Invalid. </p> ";  }
  
      if (form.you_birth_mth.value < 01) 
        {error_message = error_message + "<p> Your Birth Month Invalid </p> "; }

//      if (form.spo_birth_yr.value > 2100) 
//          {error_message = error_message + "<p> Spouse Birth Year Invalid. </p> ";  }
  
//      if (form.spo_birth_yr.value < 1900) 
//        {error_message = error_message + "<p> Spouse Birth Year Invalid. </p> "; }
      
//      if (form.spo_birth_mth.value > 12) 
//          {error_message = error_message + "<p> Spouse Birth Month Invalid. </p> ";  }
  
//      if (form.spo_birth_mth.value < 01) 
//        {error_message = error_message + "<p> Spouse Birth Month Invalid </p> "; }

      if (form.roth_draw_begin_age.value > 99) 
          {error_message = error_message + "<p> Roth Draw Begin Age must be between 20 and 99. </p> ";  }
  
      if (form.roth_draw_begin_age.value < 20) 
        {error_message = error_message + "<p> Roth Draw Begin Age must be between 20 and 99. </p> "; }

      if (form.you_retire_age.value > 99) 
        {error_message = error_message + "<p> Your Retire Age must be between 20 and 99. </p>"; }
  
      if (form.you_retire_age.value < 20) 
        {error_message = error_message + "<p> Your Retire Age must be between 20 and 99. </p>"; }

      if (form.you_retire_end_age.value > 99) 
        {error_message = error_message + "<p> Your Retire End Age must be between 60 and 99. </p> "; }
  
      if (form.you_retire_end_age.value < 60) 
        {error_message = error_message + "<p> Your Retire End Age must be between 60 and 99. </p>"; }

      if (form.you_socsec_age.value < 62) 
        {error_message = error_message + "<p> Your Social Security Start Age must be between 62 and 70. </p> "; }

      if (form.you_socsec_age.value > 71) 
        {error_message = error_message + "<p> Your Social Security Start Age must be between 62 and 70. </p>"; }

      if (form.you_socsec_amt.value > 100000) 
          {error_message = error_message + "<p> Your Social Security Amount must be betwen 0 and 100000. </p>"; }
      
      if (form.you_socsec_amt.value < 0) 
          {error_message = error_message + "<p> Your Social Security Amount must be between 0 and 100000. </p> "; }

      if (form.you_ira_start_bal_amt.value < 0) 
          {error_message = error_message + "<p> Your IRA Amount must be between 0 and 1000000000. </p> "; }

      if (form.you_ira_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> Your IRA Amount must be between 0 and 1000000000.  </p>"; }

      if (form.you_ira_ann_dep_amt.value < 0) 
         {error_message = error_message + "<p> Your Annual IRA Deposit must be between 0 and 1000000. </p>"; }

      if (form.you_ira_ann_dep_amt.value > 1000000) 
         {error_message = error_message + "<p> Your Annual IRA Deposit must be between 0 and 1000000. </p>"; }

      if (form.you_pension_amt.value < 0) 
         {error_message = error_message + "<p> Your Pension must be between 0 and 1000000.  </p>"; }

      if (form.you_pension_amt.value > 1000000) 
         {error_message = error_message + "<p> Your Pension must be between 0 and 1000000.  </p>"; }

      if (form.you_pension_begin_age.value < 0) 
         {error_message = error_message + "<p> Your Pension Begin Age must be between 0 and 99. </p>"; }

      if (form.you_pension_begin_age.value > 99) 
         {error_message = error_message + "<p> Your Pension Begin Age must be between 0 and 99.  </p>"; }

      if (form.you_pension_inf_pct.value < 0) 
         {error_message = error_message + "<p> Your Pension Inflation Adjustment must be between 0 and 10.  </p>"; }

      if (form.you_pension_inf_pct.value > 10) 
         {error_message = error_message + "<p> Your Pension Inflation Adjustment must be between 0 and 10.  </p>"; }

      if (form.you_pension_survivor_pct.value < 0) 
         {error_message = error_message + "<p> Your Pension Survivor Percent must be between 0 and 100.  </p>"; }

      if (form.you_pension_survivor_pct.value > 100) 
         {error_message = error_message + "<p> Your Pension Survivor Percent must be between 0 and 100.  </p>"; }

       if (form.brkrg_start_bal_amt.value < 0) 
         {error_message = error_message + "<p> Brokerage Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> Brokerage Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_cost_basis_amt.value < 0) 
         {error_message = error_message + "<p> Brokerage Cost Basis must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_cost_basis_amt.value > 1000000000) 
         {error_message = error_message + "<p> Brokerage Cost Basis must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_ann_dep_amt.value < 0) 
         {error_message = error_message + "<p> Brokerage Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_ann_dep_amt.value > 1000000000) 
         {error_message = error_message + "<p> Brokerage Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_taxable_dist_pct.value < 0) 
         {error_message = error_message + "<p> Brokerage Annual Deposit must be between 0 and 10.  </p>"; }
      
       if (form.brkrg_taxable_dist_pct.value > 10) 
         {error_message = error_message + "<p> Brokerage Annual Deposit must be between 0 and 10.  </p>"; }
      
       if (form.roth_start_bal_amt.value < 0) 
         {error_message = error_message + "<p> Roth Start Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.roth_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> Roth Start Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.roth_ann_dep_amt.value < 0) 
         {error_message = error_message + "<p> Roth Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.roth_ann_dep_amt.value > 1000000000) 
         {error_message = error_message + "<p> Roth Annual Deposit must be between 0 and 1000000000.  </p>"; }

       if (form.hsa_start_bal_amt.value < 0) 
         {error_message = error_message + "<p> HSA Start Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.hsa_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> HSA Start Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.hsa_ann_dep_amt.value < 0) 
         {error_message = error_message + "<p> HSA Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.hsa_ann_dep_amt.value > 1000000000) 
         {error_message = error_message + "<p> HSA Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.trans_budget_amt.value < 0) 
         {error_message = error_message + "<p> Trans Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.trans_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> Trans Budget must be between 0 and 1000000000.  </p>"; }

       if (form.full_budget_amt.value < 0) 
         {error_message = error_message + "<p> Go Go Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.full_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> Go Go Budget must be between 0 and 1000000000.  </p>"; }

       
       
      
       if (form.lastx_budget_amt.value < 0) 
         {error_message = error_message + "<p> Last x Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.lastx_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> Last x Budget must be between 0 and 1000000000.  </p>"; }
     
       if (form.mortgage_budget_amt.value < 0) 
         {error_message = error_message + "<p> Mortgage Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.mortgage_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> Mortgage Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.mortgage_end_age.value < 0) 
         {error_message = error_message + "<p> Mortgage End Age must be between 0 and 99.  </p>"; }
      
       if (form.mortgage_end_age.value > 99) 
         {error_message = error_message + "<p> Mortgage End Age must be between 0 and 99.  </p>"; }
      
       if (form.gogo_stock_pct.value < 0) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.gogo_stock_pct.value > 100) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.slogo_stock_pct.value < 0) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.slogo_stock_pct.value > 100) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.nogo_stock_pct.value < 0) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.nogo_stock_pct.value > 100) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.lastx_stock_pct.value < 0) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.lastx_stock_pct.value > 100) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.bonus_pct.value < 0) 
         {error_message = error_message + "<p> Bonus Pct must be between 0 and 100.  </p>"; }
      
       if (form.bonus_pct.value > 100) 
         {error_message = error_message + "<p> Bonus Pct must be between 0 and 100.  </p>"; }

       if (form.baseline_stock_return_pct.value < 0) 
         {error_message = error_message + "<p> Baseline Stock Return Pct must be between 0 and 10.  </p>"; }
      
       if (form.baseline_stock_return_pct.value > 10) 
         {error_message = error_message + "<p> Baseline Stock Return Pct must be between 0 and 10.  </p>"; }

       if (form.baseline_bond_return_pct.value < 0) 
         {error_message = error_message + "<p> Baseline Bond Return Pct must be between 0 and 10.  </p>"; }
      
       if (form.baseline_bond_return_pct.value > 10) 
         {error_message = error_message + "<p> Baseline Bond Return Pct must be between 0 and 10.  </p>"; }
      
       if (form.baseline_inf_pct.value < 1) 
         {error_message = error_message + "<p> Baseline Inflation Pct must be between 1 and 10.  </p>"; }
      
       if (form.baseline_inf_pct.value > 10) 
         {error_message = error_message + "<p> Baseline Inflation Pct must be between 1 and 10.  </p>"; }

       if (form.qcd_pct.value < 0) 
         {error_message = error_message + "<p> QCD Pct must be between 0 and 10.  </p>"; }
      
       if (form.qcd_pct.value > 10) 
         {error_message = error_message + "<p> QCD Pct must be between 0 and 10.  </p>"; }

       if (error_message == '')
         {process_form(form,fDownload_Results)};
      
      if (error_message != '')
         {
           document.getElementById("showresults").innerHTML = error_message1 + error_message;
           window.scrollTo(0, 200);
         }
 
  }  
</script>


<script type="text/javascript">
 function edit_spouse_form (form, error_message) {

            
      if (form.spo_retire_age.value > 99) 
        {error_message = error_message + "<p> Spouse Retire Age must be between 20 and 99. </p>"; }
  
      if (form.spo_retire_age.value < 20) 
        {error_message = error_message + "<p> Spouse Retire Age must be between 20 and 99. </p>"; }

      if (form.spo_retire_end_age.value > 99) 
        {error_message = error_message + "<p> Spouse Retire End Age must be between 60 and 99. </p> "; }
  
      if (form.spo_retire_end_age.value < 60) 
        {error_message = error_message + "<p> Spouse Retire End Age must be between 60 and 99. </p>"; }

      if (form.spo_socsec_age.value < 62) 
         {error_message = error_message + "<p> Spouse Social Security Start Age must be between 62 and 70. </p> "; }

      if (form.spo_socsec_age.value > 71) 
        {error_message = error_message + "<p> Spouse Social Security Start Age must be between 62 and 70. </p>"; }

      if (form.spo_socsec_amt.value > 100000) 
          {error_message = error_message + "<p> Spouse Social Security Amount must be betwen 0 and 100000. </p>"; }
      
      if (form.spo_socsec_amt.value < 0) 
          {error_message = error_message + "<p> Spouse Social Security Amount must be between 0 and 100000. </p> "; }

      if (form.spo_ira_start_bal_amt.value < 0) 
          {error_message = error_message + "<p> Spouse IRA Amount must be between 0 and 1000000000. </p> "; }

      if (form.spo_ira_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> Spouse IRA Amount must be between 0 and 1000000000.  </p>"; }

      if (form.spo_ira_ann_dep_amt.value < 0) 
          {error_message = error_message + "<p> Spouse Annual IRA Deposit must be between 0 and 1000000. </p>"; }

      if (form.spo_ira_ann_dep_amt.value > 1000000) 
         {error_message = error_message + "<p> Spouse Annual IRA Deposit must be between 0 and 1000000. </p>"; }

      if (form.spo_pension_amt.value < 0) 
         {error_message = error_message + "<p> Spouse Pension must be between 0 and 1000000.  </p>"; }

      if (form.spo_pension_amt.value > 1000000) 
         {error_message = error_message + "<p> Spouse Pension must be between 0 and 1000000.  </p>"; }

      if (form.spo_pension_begin_age.value < 0) 
         {error_message = error_message + "<p> Spouse Pension Begin Age must be between 0 and 99. </p>"; }

      if (form.spo_pension_begin_age.value > 99) 
         {error_message = error_message + "<p> Spouse Pension Begin Age must be between 0 and 99.  </p>"; }

      if (form.spo_pension_inf_pct.value < 0) 
         {error_message = error_message + "<p> Spouse Pension Inflation Adjustment must be between 0 and 10.  </p>"; }

      if (form.spo_pension_inf_pct.value > 10) 
         {error_message = error_message + "<p> Spouse Pension Inflation Adjustment must be between 0 and 10.  </p>"; }

      if (form.spo_pension_survivor_pct.value < 0) 
         {error_message = error_message + "<p> Spouse Pension Survivor Percent must be between 0 and 100.  </p>"; }

      if (form.spo_pension_survivor_pct.value > 100) 
         {error_message = error_message + "<p> Spouse Pension Survivor Percent must be between 0 and 100.  </p>"; }

      
       return error_message; 
  }  

</script>
          
<script type="text/javascript">
 function edit_spouse_form2 (form, error_message) {

      if (form.spo_retire_age.value != 0) 
        {error_message = error_message + "<p> Spouse Retire Age entered - Spouse Current Age must be between 20 and 99. </p>"; }
  
      if (form.spo_retire_end_age.value != 0) 
        {error_message = error_message + "<p> Spouse Retire End entered - Spouse Current Age must be between 20 and 99. </p> "; }
  
     if (form.spo_socsec_age.value != 0) 
         {error_message = error_message + "<p> Spouse Social Security Age entered - Spouse Current Age must be between 20 and 99.  </p> "; }

     if (form.spo_socsec_amt.value != 0) 
          {error_message = error_message + "<p> Spouse Social Security Amount entered - Spouse Current Age must be between 20 and 99.   </p>"; }
      
      if (form.spo_ira_start_bal_amt.value != 0) 
          {error_message = error_message + "<p> Spouse IRA Amount entered - Spouse Current Age must be between 20 and 99.    </p> "; }

      if (form.spo_ira_ann_dep_amt.value != 0) 
         {error_message = error_message + "<p> Spouse Annual IRA Deposit entered - Spouse Current Age must be between 20 and 99.  </p>"; }

      if (form.spo_pension_amt.value != 0) 
         {error_message = error_message + "<p> Spouse Pension Spouse Annual IRA Deposit entered - Spouse Current Age must be between 20 and 99. </p>"; }

      if (form.spo_pension_begin_age.value != 0) 
         {error_message = error_message + "<p> Spouse Pension Begin Age entered - Spouse Current Age must be between 20 and 99. </p>"; }

      if (form.spo_pension_inf_pct.value != 0) 
         {error_message = error_message + "<p> Spouse Pension Inflation Adjustment entered - Spouse Current Age must be between 20 and 99. </p>"; }

      if (form.spo_pension_survivor_pct.value != 0) 
         {error_message = error_message + "<p> Spouse Pension Survivor Percent entered - Spouse Current Age must be between 20 and 99. </p>"; }

       return error_message; 
  }  
</script>

<script type="text/javascript">
 function save_plan(form) {

    if (confirm("Press OK to save.  Cancel to quit.")) {
        save_plan_confirmed(form);
     } else {
       
     }

 }
</script>

<script type="text/javascript">
 function save_plan_confirmed(form) {

     
     var storedPlans = JSON.parse(localStorage.getItem("SimpSim_stored_plans")); 
    
     numberofPlans = 0;
     if (Array.isArray(storedPlans))
         {numberofPlans = storedPlans.length;}
      else
         {storedPlans = [""];}

     fFrm_Plan_Id = form.plan_id.value;
     fFrm_Plan_Id = fFrm_Plan_Id.trim();
         
     bNewPlan = "YES";
     for (var i=0; i <= numberofPlans ; i++)
        {if (fFrm_Plan_Id == storedPlans[i]) {bNewPlan = "NO"};}

     if (bNewPlan == "YES") 
        { 
         storedPlans[numberofPlans] = fFrm_Plan_Id;
         storedPlans.sort();
         localStorage.setItem("SimpSim_stored_plans", JSON.stringify(storedPlans));       
        }   

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_plan_id"), form.plan_id.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_plan_dsc"), form.plan_dsc.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_birth_yr"), form.you_birth_yr.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_birth_mth"), form.you_birth_mth.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_roth_conv_end_age"), form.roth_conv_end_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_roth_draw_begin_age"), form.roth_draw_begin_age.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_roth_flatdraw_amt"), form.roth_flatdraw_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_roth_flatend_age"), form.roth_flatend_age.value);
   
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_birth_yr"), form.spo_birth_yr.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_birth_mth"), form.spo_birth_mth.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_begin_age"), form.spo_pension_begin_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_inf_pct"), form.spo_pension_inf_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_survivor_pct"), form.spo_pension_survivor_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_retire_age"), form.spo_retire_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_socsec_age"), form.spo_socsec_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_pension_begin_age"), form.you_pension_begin_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_pension_inf_pct"), form.you_pension_inf_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_pension_survivor_pct"), form.you_pension_survivor_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_retire_age"), form.you_retire_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_socsec_age"), form.you_socsec_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_brkrg_start_bal_amt"), form.brkrg_start_bal_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_brkrg_cost_basis_amt"), form.brkrg_cost_basis_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_home_equity_amt"), form.home_equity_amt.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_trans_budget_amt"), form.trans_budget_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_full_budget_amt"), form.full_budget_amt.value);
   
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_lastx_budget_amt"), form.lastx_budget_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_lastx_years"), form.lastx_years.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_mortgage_budget_amt"), form.mortgage_budget_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_mortgage_end_age"), form.mortgage_end_age.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_gogo_reduce_pct"), form.gogo_reduce_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_nogo_reduce_pct"), form.nogo_reduce_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_slogo_reduce_pct"), form.slogo_reduce_pct.value);
   
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_ira_start_bal_amt"), form.spo_ira_start_bal_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_amt"), form.spo_pension_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_socsec_amt"), form.spo_socsec_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_ira_start_bal_amt"), form.you_ira_start_bal_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_pension_amt"), form.you_pension_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_socsec_amt"), form.you_socsec_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_bonus_pct"), form.bonus_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_medb_flag"), form.medb_flag.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_stock_pct"), form.gogo_stock_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_slogo_stock_pct"), form.slogo_stock_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_nogo_stock_pct"), form.nogo_stock_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_lastx_stock_pct"), form.lastx_stock_pct.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_retire_end_age"), form.spo_retire_end_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_retire_end_age"), form.you_retire_end_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_roth_start_bal_amt"), form.roth_start_bal_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_roth_conv_pct"), form.roth_conv_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_pre_roth_ftb_pct"), form.pre_roth_ftb_pct.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_hsa_start_bal_amt"), form.hsa_start_bal_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_hsa_ann_dep_amt"), form.hsa_ann_dep_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_hsa_use_flag"), form.hsa_use_flag.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_draw_amt"), form.hsa_init_draw_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_begin_age"), form.hsa_init_begin_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_end_age"), form.hsa_init_end_age.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_hsa_reg_draw_amt"), form.hsa_reg_draw_amt.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_you_ira_ann_dep_amt"), form.you_ira_ann_dep_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_ira_ann_dep_amt"), form.spo_ira_ann_dep_amt.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_takhom_amt"), form.spo_takhom_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_spo_taxinc_amt"), form.spo_taxinc_amt.value);


   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_brkrg_ann_dep_amt"), form.brkrg_ann_dep_amt.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_roth_ann_dep_amt"), form.roth_ann_dep_amt.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_brkrg_taxable_dist_pct"), form.brkrg_taxable_dist_pct.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_baseline_stock_return_pct"), form.baseline_stock_return_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_baseline_bond_return_pct"), form.baseline_bond_return_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_baseline_inf_pct"), form.baseline_inf_pct.value);
   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_baseline_frozen_flag"), form.baseline_frozen_flag.value);


   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_qcd_pct"), form.qcd_pct.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_early_death_pct"), form.early_death_pct.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_rpt_fmt_flag"), form.rpt_fmt_flag.value);

   localStorage.setItem(fFrm_Plan_Id.concat("SimpSim_sim_start_yr"), form.sim_start_yr.value);

   display_message1 = fFrm_Plan_Id;
   display_message2 = " Plan Saved!";
   display_message_final = display_message1.concat(display_message2);

   window.alert(display_message_final);
 }

</script>

<script type="text/javascript">
 function delete_plan(form) {

    if (confirm("Press OK to delete.  Cancel to quit.")) {
        delete_plan_confirmed(form);
     } else {
       
     }

 }

</script>

<script type="text/javascript">
 function delete_plan_confirmed(form) {
     
     var storedPlans = JSON.parse(localStorage.getItem("SimpSim_stored_plans")); 
    
     numberofPlans = 0;
     if (Array.isArray(storedPlans))
         {numberofPlans = storedPlans.length;}
      else
         {storedPlans = [""];};

     fFrm_Plan_Id = form.plan_id.value;
  
     for (var i=0; i <= numberofPlans ; i++)
        {if (fFrm_Plan_Id == storedPlans[i]) 
          {
           storedPlans[i] = "";
           break;
          };
        };
   
   storedPlans.sort();    
   storedPlans.shift();

   localStorage.setItem("SimpSim_stored_plans", JSON.stringify(storedPlans));  
   
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_plan_id"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_plan_dsc"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_cur_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_birth_yr"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_birth_mth"))

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_roth_conv_end_age"));   
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_roth_draw_begin_age"));
   
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_roth_flatdraw_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_roth_flatend_age"));
   
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_cur_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_begin_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_birth_yr"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_birth_mth"))

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_inf_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_survivor_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_retire_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_socsec_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_pension_begin_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_pension_inf_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_pension_survivor_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_retire_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_socsec_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_brkrg_start_bal_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_brkrg_cost_basis_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_home_equity_amt"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_trans_budget_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_full_budget_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_slowgo_budget_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_nogo_budget_amt"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_last3_budget_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_lastx_budget_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_lastx_years"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_mortgage_budget_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_mortgage_end_age"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_gogo_reduce_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_slogo_reduce_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_nogo_reduce_pct"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_ira_start_bal_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_pension_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_socsec_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_ira_start_bal_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_pension_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_socsec_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_bonus_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_medb_flag"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_stock_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_slogo_stock_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_nogo_stock_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_last3_stock_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_lastx_stock_pct"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_retire_end_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_retire_end_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_roth_start_bal_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_roth_conv_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_pre_roth_ftb_pct"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_start_bal_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_ann_dep_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_use_flag"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_flat_draw_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_draw_begin_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_draw_end_age"));
   
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_draw_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_begin_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_init_end_age"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_hsa_reg_draw_amt"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_you_ira_ann_dep_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_ira_ann_dep_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_takhom_amt"));
    localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_spo_taxinc_amt"));
   
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_brkrg_ann_dep_amt"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_roth_ann_dep_amt"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_brkrg_taxable_dist_pct"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_baseline_stock_return_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_baseline_bond_return_pct"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_baseline_inf_pct"));
   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_baseline_frozen_flag"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_qcd_pct"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_early_death_pct"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_rpt_fmt_flag"));

   localStorage.removeItem(fFrm_Plan_Id.concat("SimpSim_sim_start_yr"));


   display_message1 = fFrm_Plan_Id;
   display_message2 = " Plan Deleted!";
   display_message_final = display_message1.concat(display_message2);

   window.alert(display_message_final);

 }

</script>

<script type="text/javascript">
 function process_form(form, fDownload_Results) {

     

    var fRateLen     = ratehistory.length;    

    var simulation_scenario = new Array( );
    var scenario_summary = new Array( );

    fCurrent_Year = form.sim_start_yr.value * 1;

    var fRowNbr      = 0;
    
    fFrm_Bonus_Pct   = form.bonus_pct.value / 100;

    fFrm_Medb_Flag = form.medb_flag.value;

    fBaseline_Stock_Return_Pct = form.baseline_stock_return_pct.value / 100;
    fBaseline_Bond_Return_Pct = form.baseline_bond_return_pct.value / 100;
    fBaseline_Inf_Pct = form.baseline_inf_pct.value / 100;
    fBaseline_Frozen_Flag = form.baseline_frozen_flag.value;

    fFrm_QCD_Pct = form.qcd_pct.value / 100;

    fFrm_Early_Death_Pct = form.early_death_pct.value / 100;

    fFrm_Rpt_Fmt_Flg = form.rpt_fmt_flag.value;

    fFrm_You_Birth_Yr              = form.you_birth_yr.value * 1;   
    fFrm_You_Current_Age           = fCurrent_Year - fFrm_You_Birth_Yr;
    fFrm_You_Birth_Mth              = form.you_birth_mth.value * 1;  


    fFrm_You_Retire_Age            = form.you_retire_age.value * 1;

    fFrm_Spo_Birth_Yr              = form.spo_birth_yr.value * 1;   
    
    fFrm_Spo_Current_Age = 0;
    if (fFrm_Spo_Birth_Yr > 0)
        {fFrm_Spo_Current_Age           = fCurrent_Year - fFrm_Spo_Birth_Yr;}

    fFrm_Spo_Birth_Mth              = form.spo_birth_mth.value * 1;  

    fFrm_Spo_Retire_Age            = form.spo_retire_age.value * 1;

    fFrm_You_Retire_End_Age                  = form.you_retire_end_age.value * 1;
    fFrm_Spo_Retire_End_Age                  = form.spo_retire_end_age.value * 1;
  
    fFrm_Roth_Conv_End_Age               = form.roth_conv_end_age.value * 1;    
    fFrm_Roth_Draw_Begin_Age             = form.roth_draw_begin_age.value * 1;
    
    fFrm_Roth_FlatDraw_Amt               = form.roth_flatdraw_amt.value * 1;
    fFrm_Roth_FlatEnd_Age                = form.roth_flatend_age.value * 1;

    fFrm_You_IRA_Start_Bal_Amt           = form.you_ira_start_bal_amt.value * 1;
    fFrm_Spo_IRA_Start_Bal_Amt           = form.spo_ira_start_bal_amt.value * 1;
    fFrm_Brkrg_Start_Bal_Amt             = form.brkrg_start_bal_amt.value * 1;
    fFrm_Brkrg_Cost_Basis_Amt            = form.brkrg_cost_basis_amt.value * 1;
    fFrm_Brkrg_Taxable_Dist_Pct          = form.brkrg_taxable_dist_pct.value / 100;
    fFrm_Home_Equity_Amt                  = form.home_equity_amt.value * 1;
    
    fFrm_Roth_Start_Bal_Amt              = form.roth_start_bal_amt.value * 1;
    fFrm_Roth_Conv_Pct                   = form.roth_conv_pct.value;
    fFrm_Pre_Roth_FTB_Pct                = form.pre_roth_ftb_pct.value;

    fFrm_HSA_Start_Bal_Amt               = form.hsa_start_bal_amt.value * 1;
    fFrm_HSA_Ann_Dep_Amt                 = form.hsa_ann_dep_amt.value * 1;
    fFrm_HSA_Use_Flag                    = form.hsa_use_flag;

    fFrm_HSA_Init_Draw_Amt               = form.hsa_init_draw_amt.value * 1;
    fFrm_HSA_Init_Begin_Age                = form.hsa_init_begin_age.value * 1;
    fFrm_HSA_Init_End_Age                = form.hsa_init_end_age.value * 1;
    fFrm_HSA_Reg_Draw_Amt                 = form.hsa_reg_draw_amt.value * 1;

    fFrm_You_IRA_Ann_Dep_Amt                 = form.you_ira_ann_dep_amt.value * 1;
    fFrm_Spo_IRA_Ann_Dep_Amt                 = form.spo_ira_ann_dep_amt.value * 1;
    fFrm_Spo_TakHom_Amt                 = form.spo_takhom_amt.value * 1;
    fFrm_Spo_TaxInc_Amt                 = form.spo_taxinc_amt.value * 1;

    fFrm_Brkrg_Ann_Dep_Amt                   = form.brkrg_ann_dep_amt.value * 1;
    fFrm_Roth_Ann_Dep_Amt                    = form.roth_ann_dep_amt.value * 1;

    fFrm_You_Pension_Amt                 = form.you_pension_amt.value * 1;
    fFrm_You_Pension_Begin_Age           = form.you_pension_begin_age.value * 1;
    fFrm_You_Pension_Inf_Pct             = form.you_pension_inf_pct.value / 100;
    fFrm_You_Pension_Survivor_Pct        = form.you_pension_survivor_pct.value /100;

    fFrm_Spo_Pension_Amt                 = form.spo_pension_amt.value * 1;
    fFrm_Spo_Pension_Begin_Age           = form.spo_pension_begin_age.value * 1;
    fFrm_Spo_Pension_Inf_Pct             = form.spo_pension_inf_pct.value / 100;
    fFrm_Spo_Pension_Survivor_Pct        = form.spo_pension_survivor_pct.value / 100;
 	
    fFrm_You_SocSec_Amt   = form.you_socsec_amt.value * 1;
    fFrm_Spo_SocSec_Amt   = form.spo_socsec_amt.value * 1;
    
    fFrm_You_SocSec_Age   = form.you_socsec_age.value * 1;
    fFrm_Spo_SocSec_Age   = form.spo_socsec_age.value * 1; 

    fFrm_Trans_Budget_Amt = form.trans_budget_amt.value * 1;
    fFrm_Full_Budget_Amt = form.full_budget_amt.value * 1;
    fFrm_Lastx_Budget_Amt = form.lastx_budget_amt.value * 1;
    fFrm_Lastx_Years = form.lastx_years.value * 1;
      
    fFrm_Mortgage_Budget_Amt = form.mortgage_budget_amt.value * 1;
    fFrm_Mortgage_End_Age = form.mortgage_end_age.value * 1;

    fFrm_GoGo_Reduce_Pct = form.gogo_reduce_pct.value / 100;
    fFrm_SloGo_Reduce_Pct = form.slogo_reduce_pct.value / 100;
    fFrm_NoGo_Reduce_Pct = form.nogo_reduce_pct.value / 100;

    fYou_Nbr_Years = fFrm_You_Retire_End_Age - fFrm_You_Current_Age;
    fSpouse_Nbr_Years = fFrm_Spo_Retire_End_Age - fFrm_Spo_Current_Age;	

    fNbr_Years = fYou_Nbr_Years;
    
    if (fSpouse_Nbr_Years > fYou_Nbr_Years) 
            {fNbr_Years = fSpouse_Nbr_Years;}   

    fYou_Remain_Years = fFrm_You_Retire_End_Age - fFrm_You_Current_Age;
    fSpo_Remain_Years = fFrm_Spo_Retire_End_Age - fFrm_Spo_Current_Age; 

    fLast_Alive = "you";
    fLastx_Start_Age = fFrm_You_Retire_End_Age - fFrm_Lastx_Years + 1;
    if (fSpo_Remain_Years > fYou_Remain_Years) 
         {fLast_Alive = "spouse";
          fLastx_Start_Age = fFrm_Spo_Retire_End_Age - fFrm_Lastx_Years + 1;
         }
             
    var fScenario_Nbr = 0;
    var fFailure_Nbr  = 0; 
    var fHome_Equity_Used_Nbr = 0;
    var fSurvive_Cnt = 0;
    
    baseline =  {year : 0, age_runout : 000, years_remain: 0, end_bal : 0};   
    sim_summary = {bl : baseline}; 
     
    fYou_RMD_Age = calc_rmd_age(fCurrent_Year, fFrm_You_Current_Age);
    fSpo_RMD_Age = calc_rmd_age(fCurrent_Year, fFrm_Spo_Current_Age); 
     
    fMax_Year = (fCurrent_Year - fNbr_Years + 40);

    infadj_std_deduct_married = 0;
    infadj_std_deduct_single = 0;
    infadj_senior_deduct_amt = 0;
    fFed_Tax_Hld_CurYr_Amt = 75000;
    fFed_Tax_Due_LstYr_Amt = 0;
      
for (var x=0; ratehistory[x].year <= fMax_Year ; x++)
  {
  
//******************************************************************************************
//***  Year 1 simulation will be the baseline plan.  Year 1 will be average rates.
//***  Real simulations will start with year 1871.
//***
//***  Reset inflation adjusted variables back to starting for first year in scenario.
//********************************************************************************************
    
    fSimulate = "NO";
    if (ratehistory[x].year == 1) {fSimulate="YES";}
    if (ratehistory[x].year == 101) {fSimulate="YES";}
    if (ratehistory[x].year > 1870) {fSimulate="YES";}

    if (fSimulate == "NO") {continue;} 

//    fProcess = "no";                                                        
//    if (ratehistory[x].year == 1) {fProcess = "yes";}
//    if (ratehistory[x].year == 1937) {fProcess = "yes";}
//    if (fProcess == "no") {continue;}
                                                              
    fInfAdj_You_SocSec_Amt   = fFrm_You_SocSec_Amt;
    fInfAdj_Spo_SocSec_Amt   = fFrm_Spo_SocSec_Amt;

    fInfAdj_Trans_Budget_Amt = fFrm_Trans_Budget_Amt;
    fInfAdj_Full_Budget_Amt = fFrm_Full_Budget_Amt;
    
    fInfAdj_Lastx_Budget_Amt = fFrm_Lastx_Budget_Amt;

    fInfAdj_Home_Equity_Amt = fFrm_Home_Equity_Amt;
      
    fMortgage_Budget_Amt = fFrm_Mortgage_Budget_Amt;
    fMortgage_End_Age = fFrm_Mortgage_End_Age;

    fInfAdj_You_Pension_Amt     = fFrm_You_Pension_Amt;
    fInfAdj_Spo_Pension_Amt     = fFrm_Spo_Pension_Amt;

    fYou_Age  = fFrm_You_Current_Age;
    fSpo_Age  = fFrm_Spo_Current_Age; 

    fStock_Pct    = form.gogo_stock_pct.value / 100;  
    if (fYou_Age >= 75) {fStock_Pct = form.slogo_stock_pct.value / 100;}
    if (fYou_Age >= 85) {fStock_Pct = form.nogo_stock_pct.value / 100;}
    if (fLast_Alive == "you" && fYou_Age >= fLastx_Start_Age) {fStock_Pct = form.lastx_stock_pct.value / 100;}
    if (fLast_Alive == "spouse" && fSpo_Age >= fLastx_Start_Age) {fStock_Pct = form.lastx_stock_pct.value / 100;}
 
    fYou_IRA_Beg_Bal_Amt   = fFrm_You_IRA_Start_Bal_Amt;
    fSpo_IRA_Beg_Bal_Amt   = fFrm_Spo_IRA_Start_Bal_Amt;
    fBrkrg_Beg_Bal_Amt        = fFrm_Brkrg_Start_Bal_Amt;
   
    fBrkrg_Beg_Cost_Basis_Amt = fFrm_Brkrg_Cost_Basis_Amt;

    fRoth_Beg_Bal_Amt      = fFrm_Roth_Start_Bal_Amt;
    fHSA_Beg_Bal_Amt       = fFrm_HSA_Start_Bal_Amt;
    fSpo_TakHom_Amt = fFrm_Spo_TakHom_Amt;  
    fSpo_TaxInc_Amt = fFrm_Spo_TaxInc_Amt; 

    var fYear_Cnt        = 0;
    fScenario_Nbr++;

    oTax_Results = {taxable_income    : 0,
                    taxable_income_pre : 0,
                    inc_tax_amt       : 0,
                    senior_deduct_nbr : 0,
                    senior_deduct_amt : 0,
                    std_deduct_amt    : 0,
                    top_pct           : 0,
                    top_amt           : 0};
  
   oCapgains_Tax_Results = {taxable_income    : 0,
                            tax_amt           : 0};                 

   var fIRA_Distribution_Amt = 0;
   var fPension_Amt = 0;
   var fSocSec_Taxable_Amt = 0;
   var fSocSec_Taxable_Pct = 0;            
   var fAdjusted_Gross_Amt = 0;
   var fExemptions = 0; 
   var fStd_Deduct_Amt = 0;
   var fSenior_Deduct_Nbr = 0;
   var fSenior_Deduct_Amt = 0;                   
   var fTaxable_Income = 0;
   var fInc_Tax_Amt = 0;
   var fCapGains_Tax_Amt = 0;
   var fBas_End_Bal = 0;
   var fBonus_Amt = 0;
   var fBonus_Running_Total = 0;
   var fFed_Tax_Running_Total = 0;
   var fInfAdj_Budget_Running_Total = 0;
   var fFirst_Home_Draw_Age = 0;
   var fBaseline_Index = 0; 
   

//*************************************************************************************************
//* set start for baseline amounts  
//*************************************************************************************************

   fFroz_Bas_Index = fCurrent_Year - 2023;
    
//*************************************************************************************************
//* reset inflation adjusted variables for first year in a scenario.  
//*************************************************************************************************
    infadj_std_deduct_married = stddeductmarried;
    infadj_std_deduct_single = stddeductsingle;
    infadj_senior_deduct_amt = senior_deduct_amt;

    for (ri=0; ri < TaxTableMarriedLen; ri++) 
     infadj_taxtable_married[ri] =       
        {from : taxtablemarried[ri].from, 
         thru : taxtablemarried[ri].thru};

    for (ri=0; ri < TaxTableSingleLen; ri++) 
     infadj_taxtable_single[ri] =       
        {from : taxtablesingle[ri].from, 
         thru : taxtablesingle[ri].thru};

    for (ri=0; ri < capgains_taxtable_len; ri++) 
      infadj_capgains_taxtable[ri] =       
        {from : capgains_taxtable[ri].from, 
         thru : capgains_taxtable[ri].thru}; 
    
    for (ri=0; ri < medb_premium_table_len; ri++) 
      infadj_medb_premium_table[ri] =       
        {adj_gross_from : medb_premium_table[ri].adj_gross_from, 
         adj_gross_thru : medb_premium_table[ri].adj_gross_thru,
         mthly_rate     : medb_premium_table[ri].mthly_rate}; 
                                           
                    
    fBonus_Amt = fInfAdj_Trans_Budget_Amt;
    fFed_Tax_Hld_CurYr_Amt = 75000;
    fFed_Tax_Due_LstYr_Amt = 0;
    

//***************************************************************************       *
//*
//* The below loop performs one time for each year in a scenario until 
//* until end of retirement or run out of money.
//*
//***************************************************************************
    for (var i=x; i <= x+fNbr_Years; i++)
       
      {
          fYear_Cnt++; 
                                   
                                   
//*********************************************************************************************
//* determine retired status - fully retired / not retired, or in transition (i.e. one retired, one not retired
//*********************************************************************************************
         fRetired_Flag = "NO";
         fTrans_Flag = "NO";
      
         if (fFrm_Spo_Current_Age > 0)
              {if (fYou_Age >= fFrm_You_Retire_Age && fSpo_Age >= fFrm_Spo_Retire_Age) 
                 {fRetired_Flag = "YES";}}
         
         if (fFrm_Spo_Current_Age == 0)
              {if (fYou_Age >= fFrm_You_Retire_Age) 
                 {fRetired_Flag = "YES";}}

        if (fFrm_Spo_Current_Age > 0)
              {if (fYou_Age >= fFrm_You_Retire_Age && fSpo_Age < fFrm_Spo_Retire_Age) 
                 {fTrans_Flag = "YES";}}
        
        if (fFrm_Spo_Current_Age > 0)
              {if (fYou_Age < fFrm_You_Retire_Age && fSpo_Age >= fFrm_Spo_Retire_Age) 
                 {fTrans_Flag = "YES";}}                                   
 

        
//*********************************************************************************************
//* if still alive and greater than social security start age, include social security benefit
//*********************************************************************************************
          fYou_SocSec_Amt = 0;
          fSpo_SocSec_Amt = 0;
  
        if (fYou_Age > fFrm_You_SocSec_Age)
                {fYou_SocSec_Amt = fInfAdj_You_SocSec_Amt;}
          
          if (fYou_Age == fFrm_You_SocSec_Age)
                {fYou_SocSec_Amt = Math.round(fInfAdj_You_SocSec_Amt * ((12 - fFrm_You_Birth_Mth) / 12));}
                 
          if(fFrm_Spo_Current_Age > 0)
             {if (fSpo_Age > fFrm_Spo_SocSec_Age) 
                 {fSpo_SocSec_Amt = fInfAdj_Spo_SocSec_Amt;}
              if (fSpo_Age == fFrm_Spo_SocSec_Age)
                {fSpo_SocSec_Amt = Math.round(fInfAdj_Spo_SocSec_Amt * ((12 - fFrm_Spo_Birth_Mth) / 12));}
             }
      
      fSpo_TakHom_Amt2 =  fSpo_TakHom_Amt;
      fSpo_TaxInc_Amt2 =  fSpo_TaxInc_Amt;         
        
        
//****************************************************************************************************
//* if one pasess away, remaining person gets greater of your social security or spouse social security.
//*****************************************************************************************************     
          if ((fYou_Age > fFrm_You_Retire_End_Age) || (fSpo_Age > fFrm_Spo_Retire_End_Age))
             {if (fYou_SocSec_Amt >= fSpo_SocSec_Amt) 
                  {fSpo_SocSec_Amt = 0;}
              else
                  {fYou_SocSec_Amt = 0;}
             }
              
//****************************************************************************************************
//* if simulation includes a spouse and if one has passed away mid scenario, budget will be reduced to 75%
//*****************************************************************************************************     
          fBudget_Adj_Pct = 1;  
          if (fFrm_Spo_Current_Age > 0 && fSpo_Age > fFrm_Spo_Retire_End_Age) {fBudget_Adj_Pct = fFrm_Early_Death_Pct * 1;}
          if (fYou_Age > fFrm_You_Retire_End_Age) {fBudget_Adj_Pct = fFrm_Early_Death_Pct * 1;}

//*******************************************************************************************
//* calculate medb premium.  cannot do for year 1 of scenario because need previous year adjusted gross
//*******************************************************************************************
          fMedb_Premium_Amt = 0;
    
          if (fYear_Cnt > 1)
            {if (fFrm_Medb_Flag == "YES" && fTrans_Flag == "NO")   
              {fMedb_Premium_Amt = 
                 calc_medb_premium(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fFrm_You_Retire_End_Age, fSpo_Age, fFrm_Spo_Retire_End_Age, fFrm_Spo_Current_Age);}
            }
    
//********************************************************************************************************
//* determine if pension applies
//******************************************************************************************************

          var fUse_You_Pension_Amt = 0; 
          if (fFrm_You_Pension_Begin_Age > 0 && fYou_Age >= fFrm_You_Pension_Begin_Age) 
               {fUse_You_Pension_Amt = fInfAdj_You_Pension_Amt;
                if (fYou_Age > fFrm_You_Retire_End_Age)              
                    { fUse_You_Pension_Amt = 
                      Math.round(fUse_You_Pension_Amt * fFrm_You_Pension_Survivor_Pct);}                
               }

          var fUse_Spo_Pension_Amt = 0; 
          if (fFrm_Spo_Pension_Begin_Age > 0 && fSpo_Age >= fFrm_Spo_Pension_Begin_Age) 
               {fUse_Spo_Pension_Amt = fInfAdj_Spo_Pension_Amt;
                if (fSpo_Age > fFrm_Spo_Retire_End_Age)              
                    { fUse_Spo_Pension_Amt = 
                      Math.round(fUse_Spo_Pension_Amt * fFrm_Spo_Pension_Survivor_Pct);}                
               }

//*******************************************************************************************************************
//* start drawing down when both you and spouse have retired.
//* if drawing down, determine if go-go, slow-go, or no-go budget is being used
//* Total need to draw = Budget + Bonus + Income Tax + Capital gains tax - social security - pension
//********************************************************************************************************************
         fInfAdj_Budget_Amt = 0;
         fTotal_Need_Amt = 0;
         fUse_Mortgage_Budget_Amt = 0;
        
//        fVPW_Lookup = Math.max(fYou_Age, fSpo_Age) - 40;    
//        fVPW_Factor = vpwtable[fVPW_Lookup].factor;
//        fVPW_Draw_Amt = 
//           Math.round((fYou_IRA_Beg_Bal_Amt + fSpo_IRA_Beg_Bal_Amt + fBrkrg_Beg_Bal_Amt + fRoth_Beg_Bal_Amt + fHSA_Beg_Bal_Amt) * fVPW_Factor);
              
           
        if (fRetired_Flag == "YES")
             {
              
               if (fYou_Age <= fMortgage_End_Age) {fUse_Mortgage_Budget_Amt = fMortgage_Budget_Amt;}
               
               fInfAdj_Budget_Amt = fInfAdj_Full_Budget_Amt;
            
                                                   

               if (fLast_Alive == "you" && fYou_Age >= fLastx_Start_Age) {fInfAdj_Budget_Amt = fInfAdj_Lastx_Budget_Amt;}
               if (fLast_Alive == "spouse" && fSpo_Age >= fLastx_Start_Age) {fInfAdj_Budget_Amt = fInfAdj_Lastx_Budget_Amt;}
               
               fInfAdj_Budget_Amt = Math.round(fInfAdj_Budget_Amt * fBudget_Adj_Pct);  // make adjustment if one if deceased
        
//               if (fFrm_Plan_Id == "Roth Conv Test70" && fFrm_Roth_Conv_Pct == 22 && fYear_Cnt <= 4) {fInc_Tax_Amt += fFed_Tax_Hld_CurYr_Amt};
                        
                       
               fTotal_Need_Amt = fInfAdj_Budget_Amt + fUse_Mortgage_Budget_Amt + fBonus_Amt + fInc_Tax_Amt + fCapGains_Tax_Amt + fMedb_Premium_Amt 
                                 - fYou_SocSec_Amt - fSpo_SocSec_Amt 
                                 - fUse_You_Pension_Amt - fUse_Spo_Pension_Amt - fSpo_TakHom_Amt;
            }


        
//***********************************************************
//* calculate qualified charitable distribution deduction
//***********************************************************

        fQCD_Max_Amt = 0;
        
        if (fYou_Age >= 71 && fYou_Age < fLastx_Start_Age) {fQCD_Max_Amt += 100000;};
        if (fSpo_Age >= 71 && fSpo_Age < fLastx_Start_Age) {fQCD_Max_Amt += 100000;};
    
                                                                                   
        fPotential_QCD_Amt = 0;
        
        if(fYou_Age < fLastx_Start_Age && fSpo_Age < fLastx_Start_Age)                                                   
          {fPotential_QCD_Amt = Math.min(Math.round(fInfAdj_Budget_Amt * fFrm_QCD_Pct), fQCD_Max_Amt);}
        
//***********************************************************
//* set asset allocation based on age.
//***********************************************************
               
        fStock_Pct    = form.gogo_stock_pct.value / 100;  
        if (fYou_Age >= 75) {fStock_Pct = form.slogo_stock_pct.value / 100;}
        if (fYou_Age >= 85) {fStock_Pct = form.nogo_stock_pct.value / 100;}
        if (fLast_Alive == "you" && fYou_Age >= fLastx_Start_Age) {fStock_Pct = form.lastx_stock_pct.value / 100;}
        if (fLast_Alive == "spouse" && fSpo_Age >= fLastx_Start_Age) {fStock_Pct = form.lastx_stock_pct.value / 100;}
  
//***********************************************************
//* determine # exemptions for tax purposes
//***********************************************************
          fExemptions = 1;

          fYou_Years_Deceased = 0;
          if (fYou_Age > fFrm_You_Retire_End_Age) {fYou_Years_Deceased = fYou_Age - fFrm_You_Retire_End_Age;}

          fSpo_Years_Deceased = 0;
          if (fSpo_Age > fFrm_Spo_Retire_End_Age) {fSpo_Years_Deceased = fSpo_Age - fFrm_Spo_Retire_End_Age;}

          if (fYou_Years_Deceased < 2 && fSpo_Years_Deceased <2 && fFrm_Spo_Current_Age > 0)
              {fExemptions++;}
                   
          fPension_Amt = fUse_You_Pension_Amt + fUse_Spo_Pension_Amt;
          fSocSec_Total_Amt = fYou_SocSec_Amt + fSpo_SocSec_Amt;
 
//***************************************************************************
//* determine how much to draw from each account 
//****************************************************************************
                   
          fRemain_Need_Amt = fTotal_Need_Amt;

          fYou_RMD_Draw_Amt = calc_rmd(fYou_Age, fYou_IRA_Beg_Bal_Amt, fYou_RMD_Age);  // you RMD
          fYou_IRA_End_Bal_Amt1 = fYou_IRA_Beg_Bal_Amt - fYou_RMD_Draw_Amt;    
        
          fSpo_RMD_Draw_Amt = calc_rmd(fSpo_Age, fSpo_IRA_Beg_Bal_Amt, fSpo_RMD_Age);  // spouse RMD
          fSpo_IRA_End_Bal_Amt1 = fSpo_IRA_Beg_Bal_Amt - fSpo_RMD_Draw_Amt;
        
          fRemain_Need_Amt = fRemain_Need_Amt - fYou_RMD_Draw_Amt - fSpo_RMD_Draw_Amt;  
        
//***************************************************************************
//* after RMD calculated, determine if need to draw from HSA
//****************************************************************************

        fHSA_Draw_Amt = 0;
        if (fHSA_Beg_Bal_Amt > 0) 
          {
           fHSA_Draw_Amt = Math.min(fHSA_Beg_Bal_Amt, fMedb_Premium_Amt);
          }
           
        fHSA_End_Bal_Amt1 = fHSA_Beg_Bal_Amt - fHSA_Draw_Amt;
        
        fRemain_Need_Amt = fRemain_Need_Amt - fHSA_Draw_Amt;
        
        fHSA_Flat_Draw_Amt = 0;
        if (fHSA_End_Bal_Amt1 > 0 && fYou_Age > fFrm_HSA_Init_End_Age)   
           {
            fHSA_Flat_Draw_Amt = Math.min(fHSA_End_Bal_Amt1, fFrm_HSA_Reg_Draw_Amt);
           }
        
        if (fHSA_End_Bal_Amt1 > 0 && fYou_Age >= fFrm_HSA_Init_Begin_Age && fYou_Age <= fFrm_HSA_Init_End_Age) 
          {
           fHSA_Flat_Draw_Amt = Math.min(fHSA_End_Bal_Amt1, fFrm_HSA_Init_Draw_Amt);
          }
                                                                                                                         
        fHSA_End_Bal_Amt1 = fHSA_End_Bal_Amt1 - fHSA_Flat_Draw_Amt;
        
        fRemain_Need_Amt = fRemain_Need_Amt - fHSA_Flat_Draw_Amt;
        fHSA_Draw_Amt += fHSA_Flat_Draw_Amt;
                                                                                                             
        fHSA_Ann_Dep_Amt = 0;
        
//***************************************************************************
//* after drawing RMD, perform fill the tax bracket logic. 
//****************************************************************************
    
        fFTB_Amt = 0;
        fYou_IRA_FTB_Draw_Amt = 0;                                                                                                        
        
//      if (fRemain_Need_Amt > 0 && fFrm_Pre_Roth_FTB_Pct != 0 && fYou_Age >= fFrm_Roth_Draw_Begin_Age)
         if (fRemain_Need_Amt > 0 && fRetired_Flag == "YES" && fFrm_Pre_Roth_FTB_Pct != "None")
           {
            fFTB_Amt = calc_ftb_amt(fExemptions, fFrm_Pre_Roth_FTB_Pct, fYou_RMD_Draw_Amt, fSpo_RMD_Draw_Amt, fPension_Amt + fSpo_TaxInc_Amt2, fYou_Age, fSpo_Age, fSocSec_Total_Amt,fPotential_QCD_Amt);
            fYou_IRA_FTB_Draw_Amt = Math.min(fFTB_Amt, fYou_IRA_End_Bal_Amt1);
            fYou_IRA_End_Bal_Amt1 -=  fYou_IRA_FTB_Draw_Amt;
            fRemain_Need_Amt -= fYou_IRA_FTB_Draw_Amt; 
          }
//***************************************************************************
//* after filling the tax bracket, see how much is neded from roth. 
//****************************************************************************
                   
          fRoth_Draw_Amt0 = 0;
                                                   
          if (fYou_Age >= fFrm_Roth_Draw_Begin_Age && fRemain_Need_Amt > 0) 
            {
               fRoth_Draw_Amt0 = Math.min(fRemain_Need_Amt, fRoth_Beg_Bal_Amt);
               if (fYou_Age <= fFrm_Roth_FlatEnd_Age && fFrm_Roth_FlatDraw_Amt > 0)
                  {fRoth_Draw_Amt0 = Math.min(fFrm_Roth_FlatDraw_Amt, fRemain_Need_Amt, fRoth_Beg_Bal_Amt);}
            
               if(fRoth_Draw_Amt0 < 0) {fRoth_Draw_Amt0 = 0;};
            }

                                            
          fRoth_End_Bal_Amt0 = fRoth_Beg_Bal_Amt - fRoth_Draw_Amt0;           
          fRemain_Need_Amt = fRemain_Need_Amt - fRoth_Draw_Amt0;    
        
          fBrkrg_Draw_Amt = Math.min(fRemain_Need_Amt, fBrkrg_Beg_Bal_Amt);
          fBrkrg_End_Bal_Amt1 = fBrkrg_Beg_Bal_Amt - fBrkrg_Draw_Amt;        
          fRemain_Need_Amt = fRemain_Need_Amt - fBrkrg_Draw_Amt;

          fYou_IRA_Addl_Draw_Amt = Math.min(fRemain_Need_Amt, fYou_IRA_End_Bal_Amt1);
          fYou_IRA_End_Bal_Amt1 = fYou_IRA_End_Bal_Amt1 - fYou_IRA_Addl_Draw_Amt; 
          fRemain_Need_Amt = fRemain_Need_Amt - fYou_IRA_Addl_Draw_Amt;  
                                      
          fYou_IRA_Addl_Draw_Amt += fYou_IRA_FTB_Draw_Amt;
                   
          fSpo_IRA_Addl_Draw_Amt = Math.min(fRemain_Need_Amt, fSpo_IRA_End_Bal_Amt1);
          fSpo_IRA_End_Bal_Amt1 = fSpo_IRA_End_Bal_Amt1 - fSpo_IRA_Addl_Draw_Amt;
          fRemain_Need_Amt = fRemain_Need_Amt - fSpo_IRA_Addl_Draw_Amt;
                   
          fRoth_Draw_Amt1 = Math.min(fRemain_Need_Amt, fRoth_End_Bal_Amt0);
          fRoth_End_Bal_Amt1 = fRoth_End_Bal_Amt0 - fRoth_Draw_Amt1;           
          fRemain_Need_Amt = fRemain_Need_Amt - fRoth_Draw_Amt1;    
                   
          fRoth_Draw_Amt = fRoth_Draw_Amt0 + fRoth_Draw_Amt1;
        
          fHome_Draw_Amt = Math.min(fRemain_Need_Amt, fInfAdj_Home_Equity_Amt);
          fInfAdj_Home_Equity_Amt -= fHome_Draw_Amt;
          fRemain_Need_Amt  -= fHome_Draw_Amt;
        
          if (fHome_Draw_Amt > 0 && fFirst_Home_Draw_Age == 0)
             {fFirst_Home_Draw_Age = fYou_Age;}
                   
//***************************************************************************
//* see if roth conversion viable.  
//***************************************************************************                   

          fMax_Taxable_Income = 0;
          if (fExemptions ==2)
             {      
              if (fFrm_Roth_Conv_Pct == 10) fMax_Taxable_Income = infadj_taxtable_married[0].thru;   
              if (fFrm_Roth_Conv_Pct == 12) fMax_Taxable_Income = infadj_taxtable_married[1].thru;
              if (fFrm_Roth_Conv_Pct == 22) fMax_Taxable_Income = infadj_taxtable_married[2].thru;
              if (fFrm_Roth_Conv_Pct == 24) fMax_Taxable_Income = infadj_taxtable_married[3].thru;       
             }
        
           if (fExemptions ==1)
             {      
              if (fFrm_Roth_Conv_Pct == 10) fMax_Taxable_Income = infadj_taxtable_single[0].thru;   
              if (fFrm_Roth_Conv_Pct == 12) fMax_Taxable_Income = infadj_taxtable_single[1].thru;
              if (fFrm_Roth_Conv_Pct == 22) fMax_Taxable_Income = infadj_taxtable_single[2].thru;       
              if (fFrm_Roth_Conv_Pct == 24) fMax_Taxable_Income = infadj_taxtable_single[3].thru;              
             }
        
                   
//**********************************************************************
//* preliminary calculate taxes to help determine if roth conversion viable
//**********************************************************************
                   
          fIRA_Distribution_Amt = fYou_RMD_Draw_Amt + fYou_IRA_Addl_Draw_Amt + fSpo_RMD_Draw_Amt + fSpo_IRA_Addl_Draw_Amt;
        
          fActual_QCD_Amt = Math.min(fPotential_QCD_Amt, fIRA_Distribution_Amt);
    
          fBrkrg_Taxable_Dist_Amt = Math.round((fBrkrg_Beg_Bal_Amt - fBrkrg_Draw_Amt) * fFrm_Brkrg_Taxable_Dist_Pct);
                   
          fIncome_Less_SS = fIRA_Distribution_Amt + fPension_Amt + fBrkrg_Taxable_Dist_Amt - fActual_QCD_Amt + fSpo_TaxInc_Amt2;

          fSocSec_Taxable_Amt = calc_socsec_taxable_func(fIncome_Less_SS, fSocSec_Total_Amt, fExemptions);                 
          fSocSec_Taxable_Pct = 0;
          if (fSocSec_Total_Amt > 0) {fSocSec_Taxable_Pct = Math.round((fSocSec_Taxable_Amt / fSocSec_Total_Amt)*100);}

          fAdjusted_Gross_Amt = fIncome_Less_SS + fSocSec_Taxable_Amt;

          oTax_Results =          calc_income_tax(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fSpo_Age);
          
          fRoth_Conv_Amt = fMax_Taxable_Income - oTax_Results.taxable_income_pre;
        
          fYou_Roth_Conv_Amt = 0;
          fSpo_Roth_Conv_Amt = 0;
                   
          if (fFrm_Roth_Conv_Pct != 'none' && fRemain_Need_Amt == 0 && fRoth_Conv_Amt > 0 && fYou_Age <= fFrm_Roth_Conv_End_Age)
//                 && fInfAdj_Budget_Amt > 0
//                  && fSocSec_Total_Amt == 0)
             {
              fYou_Roth_Conv_Amt = Math.min(fRoth_Conv_Amt, fYou_IRA_End_Bal_Amt1);
              fYou_IRA_Addl_Draw_Amt = fYou_IRA_Addl_Draw_Amt + fYou_Roth_Conv_Amt;
              fYou_IRA_End_Bal_Amt1 = fYou_IRA_End_Bal_Amt1 - fYou_Roth_Conv_Amt;       
              fRoth_Draw_Amt = fRoth_Draw_Amt - fYou_Roth_Conv_Amt;       
              fRoth_End_Bal_Amt1 = fRoth_End_Bal_Amt1 + fYou_Roth_Conv_Amt;
                   
              fRoth_Conv_Amt = fRoth_Conv_Amt - fYou_Roth_Conv_Amt;
              
              fSpo_Roth_Conv_Amt = Math.min(fRoth_Conv_Amt, fSpo_IRA_End_Bal_Amt1);
              fSpo_IRA_Addl_Draw_Amt = fSpo_IRA_Addl_Draw_Amt + fSpo_Roth_Conv_Amt;
              fSpo_IRA_End_Bal_Amt1 = fSpo_IRA_End_Bal_Amt1 - fSpo_Roth_Conv_Amt;
              fRoth_Draw_Amt = fRoth_Draw_Amt - fSpo_Roth_Conv_Amt;       
              fRoth_End_Bal_Amt1 = fRoth_End_Bal_Amt1 + fSpo_Roth_Conv_Amt;
            }

//**********************************************************************
//* final tax calculation.  taxes will be included in the budget for next year.
//**********************************************************************
                   
          fIRA_Distribution_Amt = fYou_RMD_Draw_Amt + fYou_IRA_Addl_Draw_Amt + fSpo_RMD_Draw_Amt + fSpo_IRA_Addl_Draw_Amt;
        
          fActual_QCD_Amt = Math.min(fPotential_QCD_Amt, fIRA_Distribution_Amt);
    
          fBrkrg_Taxable_Dist_Amt = Math.round((fBrkrg_Beg_Bal_Amt - fBrkrg_Draw_Amt) * fFrm_Brkrg_Taxable_Dist_Pct);
                   
          fIncome_Less_SS = fIRA_Distribution_Amt + fPension_Amt + fBrkrg_Taxable_Dist_Amt - fActual_QCD_Amt + fSpo_TaxInc_Amt2;

          fSocSec_Taxable_Amt = calc_socsec_taxable_func(fIncome_Less_SS, fSocSec_Total_Amt, fExemptions);                 
          fSocSec_Taxable_Pct = 0;
          if (fSocSec_Total_Amt > 0) {fSocSec_Taxable_Pct = Math.round((fSocSec_Taxable_Amt / fSocSec_Total_Amt)*100);}

          fAdjusted_Gross_Amt = fIncome_Less_SS + fSocSec_Taxable_Amt;

          oTax_Results =          calc_income_tax(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fSpo_Age);
                   
          fCurYr_Taxable_Income = oTax_Results.taxable_income;
          fCurYr_Inc_Tax_Amt = oTax_Results.inc_tax_amt;

          fSenior_Deduct_Nbr = oTax_Results.senior_deduct_nbr; 
          fSenior_Deduct_Amt = oTax_Results.senior_deduct_amt;
          fStd_Deduct_Amt    = oTax_Results.std_deduct_amt;
                   
                  
          
//**************************************************************************************************************************************             
//*   adjust cost basis if updating brokerage balance       
//************************************************************************************************************************************       
         
          fBrkrg_Adj_Cost_Basis_Amt = 0;

          if (fBrkrg_Beg_Bal_Amt != 0 && fBrkrg_Draw_Amt > 0) 
             {fBrkrg_Adj_Cost_Basis_Amt = (Math.round((fBrkrg_Draw_Amt / fBrkrg_Beg_Bal_Amt) * 
                                           fBrkrg_Beg_Cost_Basis_Amt))*-1;}
          if (fBrkrg_Draw_Amt < 0) 
             {fBrkrg_Adj_Cost_Basis_Amt = fBrkrg_Draw_Amt * -1;}
          
           
//*************************************************************************************
//* calculate capital gains tax
//************************************************************************************
          
          fCapgains_Amt = 0;
          fCurYr_CapGains_Tax_Amt = 0;
          if (fBrkrg_Draw_Amt > 0) 
             {fCapgains_Amt = fBrkrg_Draw_Amt + fBrkrg_Adj_Cost_Basis_Amt;    
              oCapgains_Tax_Results = calc_capgains_tax(fAdjusted_Gross_Amt, 
                                                        fStd_Deduct_Amt + fSenior_Deduct_Amt, 
                                                        fCapgains_Amt, 
                                                        fExemptions);
              fCurYr_CapGains_Tax_Amt = oCapgains_Tax_Results.tax_amt
             }
               
         fFed_Tax_Running_Total = fFed_Tax_Running_Total + fCurYr_Inc_Tax_Amt + fCurYr_CapGains_Tax_Amt;
        

         
         
                   
//**************************************************************************************************************************************             
//* calculate gains, add deposits, and rebalance
//************************************************************************************************************************************       
          fYou_IRA_Ann_Dep_Amt = 0;
          fSpo_IRA_Ann_Dep_Amt = 0;
          fBrkrg_Ann_Dep_Amt = 0;
          fRoth_Ann_Dep_Amt = 0;

          if(fYou_Age < fFrm_You_Retire_Age) {fYou_IRA_Ann_Dep_Amt = fFrm_You_IRA_Ann_Dep_Amt;}
          if(fSpo_Age < fFrm_Spo_Retire_Age) {fSpo_IRA_Ann_Dep_Amt = fFrm_Spo_IRA_Ann_Dep_Amt;}
          if(fYou_Age < fFrm_You_Retire_Age) {fBrkrg_Ann_Dep_Amt = fFrm_Brkrg_Ann_Dep_Amt;}
          if(fYou_Age < fFrm_You_Retire_Age) {fRoth_Ann_Dep_Amt = fFrm_Roth_Ann_Dep_Amt;}
          if(fSpo_Age < fFrm_Spo_Retire_Age) {fRoth_Ann_Dep_Amt = fFrm_Roth_Ann_Dep_Amt;}
                                  
//***********************************************************************************************************************    
//* after withdrawl for year, calc gain and add deposit (assumption is withdrawals 
//* are at beginning of year and deposits are accumulated at end of year)
//*
//* 1) reallocate 2) calculate gain 3) add deposit and gains 4) reallocate again
//* 
//* if testing year 1 (baseline plan), baseline rates can be overriden by user.
//***********************************************************************************************************************
    
          if (ratehistory[x].year == 1) 
               {
                ratehistory[i].stockret = fBaseline_Stock_Return_Pct;
                ratehistory[i].bondret = fBaseline_Bond_Return_Pct;
                ratehistory[i].infrate = fBaseline_Inf_Pct;   
               }
        
          fIRA_Stock_Pct = fStock_Pct;
          fOther_Stock_Pct = fStock_Pct;
                                            
//          fIRA_End_Bal_Amt1 = fYou_IRA_End_Bal_Amt1 + fSpo_IRA_End_Bal_Amt1;
//                                            
//         if (fStock_Pct > 0 && fIRA_End_Bal_Amt1 > 0)
//            {  
//             fOther_Stock_Pct = 1;
//             fNonIRA_End_Bal_Amt1 = fBrkrg_End_Bal_Amt1 + fRoth_End_Bal_Amt1 +fHSA_End_Bal_Amt1;
//             fDesired_Stock_Amt1 = Math.round((fNonIRA_End_Bal_Amt1 + fIRA_End_Bal_Amt1) * fStock_Pct); 
//             fDesired_IRA_Stock_Amt1 = fDesired_Stock_Amt1 - fNonIRA_End_Bal_Amt1;
//             if(fNonIRA_End_Bal_Amt1 > fIRA_End_Bal_Amt1) 
//                  {fDesired_IRA_Stock_Pct = fStock_Pct;
//                   fDesired_Other_Stock_Pct = fStock_Pct;      
//                  }
//               else
//                  {fDesired_IRA_Stock_Pct = (Math.round((fDesired_IRA_Stock_Amt1 / fIRA_End_Bal_Amt1)*100))/100;
//                   fDesired_Other_Stock_Pct = 1;
//                   }
//             
//             fIRA_Stock_Pct = fDesired_IRA_Stock_Pct;    
//             fOther_Stock_Pct = fDesired_Other_Stock_Pct;
//            }
        
          fYou_IRA_Gain_Amt = calc_gain(fYou_IRA_End_Bal_Amt1, fIRA_Stock_Pct, ratehistory[i].stockret, ratehistory[i].bondret);
          fYou_IRA_End_Bal_Amt2 = fYou_IRA_End_Bal_Amt1 + fYou_IRA_Gain_Amt + fYou_IRA_Ann_Dep_Amt;
                                   
          fSpo_IRA_Gain_Amt = calc_gain(fSpo_IRA_End_Bal_Amt1, fIRA_Stock_Pct, ratehistory[i].stockret, ratehistory[i].bondret);
          fSpo_IRA_End_Bal_Amt2 = fSpo_IRA_End_Bal_Amt1 + fSpo_IRA_Gain_Amt + fSpo_IRA_Ann_Dep_Amt;
      
          fBrkrg_Gain_Amt = calc_gain(fBrkrg_End_Bal_Amt1, fOther_Stock_Pct, ratehistory[i].stockret, ratehistory[i].bondret);
          fBrkrg_End_Bal_Amt2 = fBrkrg_End_Bal_Amt1 + fBrkrg_Gain_Amt + fBrkrg_Ann_Dep_Amt;
      
          fBrkrg_End_Cost_Basis_Amt = fBrkrg_Beg_Cost_Basis_Amt + fBrkrg_Adj_Cost_Basis_Amt + fBrkrg_Ann_Dep_Amt; 
        
          fRoth_Gain_Amt = calc_gain(fRoth_End_Bal_Amt1, fOther_Stock_Pct, ratehistory[i].stockret, ratehistory[i].bondret);
          fRoth_End_Bal_Amt2 = fRoth_End_Bal_Amt1 + fRoth_Gain_Amt + fRoth_Ann_Dep_Amt;
  
          fHSA_Gain_Amt = calc_gain(fHSA_End_Bal_Amt1, fOther_Stock_Pct, ratehistory[i].stockret, ratehistory[i].bondret);
          fHSA_End_Bal_Amt2 = fHSA_End_Bal_Amt1 + fHSA_Gain_Amt + fHSA_Ann_Dep_Amt;
                          
          fBeg_Bal = fYou_IRA_Beg_Bal_Amt + fSpo_IRA_Beg_Bal_Amt + fBrkrg_Beg_Bal_Amt + fRoth_Beg_Bal_Amt + fHSA_Beg_Bal_Amt;
          fEnd_Bal = fYou_IRA_End_Bal_Amt2 + fSpo_IRA_End_Bal_Amt2 + fBrkrg_End_Bal_Amt2 + fRoth_End_Bal_Amt2 + fHSA_End_Bal_Amt2;

          fTotal_Draw_Amt = fYou_RMD_Draw_Amt + fYou_IRA_Addl_Draw_Amt + fSpo_RMD_Draw_Amt + fSpo_IRA_Addl_Draw_Amt +
                            fBrkrg_Draw_Amt + fRoth_Draw_Amt + fHSA_Draw_Amt + fHome_Draw_Amt;
                                        
          fTotal_Ann_Dep_Amt = fYou_IRA_Ann_Dep_Amt + fSpo_IRA_Ann_Dep_Amt +
                            fBrkrg_Ann_Dep_Amt + fRoth_Ann_Dep_Amt + fHSA_Ann_Dep_Amt;

          fTotal_Gain_Amt = fYou_IRA_Gain_Amt + fSpo_IRA_Gain_Amt + 
                            fBrkrg_Gain_Amt + fRoth_Gain_Amt + fHSA_Gain_Amt;  
       
          fBas_End_Bal = 0;
          fBas_Diff = 0;
          fRecalc_Bas_End_Bal = 0;                                    
                                                       
          fFroz_Bas_End_Bal = get_baseline(fFroz_Bas_Index);
          fFroz_Bas_Index++;        
        
          if (ratehistory[x].year > 1) 
            {fRecalc_Bas_End_Bal = simulation_scenario[fYear_Cnt-1].end_bal}
        
          fBas_End_Bal = fRecalc_Bas_End_Bal;
          if (fBaseline_Frozen_Flag == "Y")
              {fBas_End_Bal = fFroz_Bas_End_Bal};
        
          if (ratehistory[x].year > 1) 
            {
             if (fEnd_Bal > fBas_End_Bal)
                {fBas_Diff = fEnd_Bal - fBas_End_Bal;}
            }

          fBonus_Running_Total = fBonus_Running_Total + fBonus_Amt;
          fInfAdj_Budget_Running_Total = fInfAdj_Budget_Running_Total + fInfAdj_Budget_Amt + fUse_Mortgage_Budget_Amt;
        
//**********************************************************************************
//* compute a score for the scenario.  used to determine best, worst and median scenarios
//***********************************************************************************
          fScore_Age = (fYou_Age * 1000000000000) 
          
          fScore_Survived = 0;            
          if ((fEnd_Bal + fInfAdj_Home_Equity_Amt) > 0 ) {fScore_Survived = 1000000000;}
          
          fScore_Years_Remain = 0;
          if (fTotal_Draw_Amt > 0) {fScore_Years_Remain = Math.round((fEnd_Bal + fInfAdj_Home_Equity_Amt) / fTotal_Draw_Amt) * 1000000;}
        
          fScore_Bonus = 0;
          if (fInfAdj_Budget_Running_Total > 0) {fScore_Bonus = Math.round((fBonus_Running_Total / fInfAdj_Budget_Running_Total) * 1000);}
                   
          fScenario_Score =  fScore_Age + fScore_Survived + fScore_Bonus + fScore_Years_Remain;   
                            
//**************************************************************************************
//* save scenario / year calculation results
//**************************************************************************************
          simulation_scenario[fRowNbr] = 
                       {scenario_year :ratehistory[x].year,
                        year:    ratehistory[i].year,
                        you_age: fYou_Age,
                        spouse_age: fSpo_Age,
                        scenario_nbr: fScenario_Nbr,
                        yearcnt: fYear_Cnt,
                        budgetadj : fBudget_Adj_Pct,
                        infadj_budget_amt : fInfAdj_Budget_Amt,
                        infadj_budget_running_total : fInfAdj_Budget_Running_Total,
                        mortgage_budget_amt : fUse_Mortgage_Budget_Amt,

                        you_pension_amt : fUse_You_Pension_Amt,
                        spo_pension_amt : fUse_Spo_Pension_Amt,
                         
                        exemptions: fExemptions, 
                    
                        inc_tax_amt : fInc_Tax_Amt, 
                        capgains_tax_amt : fCapGains_Tax_Amt,
                        
                        curyr_inc_tax_amt : fCurYr_Inc_Tax_Amt,
                        fed_tax_running_total : fFed_Tax_Running_Total,
                   
                        curyr_taxable_income : fCurYr_Taxable_Income, 
                        
                   
                        curyr_capgains_amt : fCapgains_Amt,
    
                        curyr_capgains_tax_amt : fCurYr_CapGains_Tax_Amt,
                    
                        you_socsec_amt: fYou_SocSec_Amt,
                        spo_socsec_amt: fSpo_SocSec_Amt,
    
                        medb_premium_amt: fMedb_Premium_Amt,

                        total_need_amt      : fTotal_Need_Amt,
                        remain_need_amt     : fRemain_Need_Amt,

                        you_ira_beg_bal_amt   : fYou_IRA_Beg_Bal_Amt,
                        you_rmd_draw_amt      : fYou_RMD_Draw_Amt,
                        you_ira_addl_draw_amt : fYou_IRA_Addl_Draw_Amt,
                        you_ira_gain_amt      : fYou_IRA_Gain_Amt,
                        you_ira_ann_dep_amt   : fYou_IRA_Ann_Dep_Amt,
                        you_ira_end_bal_amt   : fYou_IRA_End_Bal_Amt2,

                        spo_ira_beg_bal_amt   : fSpo_IRA_Beg_Bal_Amt,
                        spo_rmd_draw_amt      : fSpo_RMD_Draw_Amt,
                        spo_ira_addl_draw_amt : fSpo_IRA_Addl_Draw_Amt,
                        spo_ira_gain_amt      : fSpo_IRA_Gain_Amt,
                        spo_ira_ann_dep_amt   : fSpo_IRA_Ann_Dep_Amt,
                        spo_ira_end_bal_amt   : fSpo_IRA_End_Bal_Amt2,

                        brkrg_beg_bal_amt  : fBrkrg_Beg_Bal_Amt,
                        brkrg_draw_amt    : fBrkrg_Draw_Amt,
                        brkrg_gain_amt     : fBrkrg_Gain_Amt,
                        brkrg_ann_dep_amt   : fBrkrg_Ann_Dep_Amt,
                        brkrg_end_bal_amt  : fBrkrg_End_Bal_Amt2,
    
                        brkrg_beg_cost_basis_amt : fBrkrg_Beg_Cost_Basis_Amt,
                        brkrg_adj_cost_basis_amt : fBrkrg_Adj_Cost_Basis_Amt,
                        brkrg_end_cost_basis_amt : fBrkrg_End_Cost_Basis_Amt,
          
                        roth_beg_bal_amt  : fRoth_Beg_Bal_Amt,
                        roth_draw_amt   : fRoth_Draw_Amt,
                        roth_gain_amt     : fRoth_Gain_Amt,
                        roth_ann_dep_amt   : fRoth_Ann_Dep_Amt,
                        roth_end_bal_amt  : fRoth_End_Bal_Amt2,
        
                        hsa_beg_bal_amt  : fHSA_Beg_Bal_Amt,
                        hsa_draw_amt   : fHSA_Draw_Amt,
                        hsa_gain_amt     : fHSA_Gain_Amt,
                        hsa_ann_dep_amt   : fHSA_Ann_Dep_Amt,
                        hsa_end_bal_amt  : fHSA_End_Bal_Amt2,
        
                        infadj_home_equity_amt : fInfAdj_Home_Equity_Amt,
                        home_draw_amt    : fHome_Draw_Amt,
                        first_home_draw_age : fFirst_Home_Draw_Age,

                        beg_bal            : fBeg_Bal,  
                        total_draw_amt    : fTotal_Draw_Amt,
                        total_gain_amt    : fTotal_Gain_Amt,
                        total_ann_dep_amt : fTotal_Ann_Dep_Amt,
                        end_bal            : fEnd_Bal,
                        bas_end_bal        : fBas_End_Bal,
                        bonus_amt          : fBonus_Amt,
                        bonus_running_total : fBonus_Running_Total, 
    
                        you_roth_conv_amt : fYou_Roth_Conv_Amt,
                        spo_roth_conv_amt : fSpo_Roth_Conv_Amt,

                        scenario_score      : fScenario_Score,

                        stockret:  ratehistory[i].stockret,
                        bondret:   ratehistory[i].bondret,
                        infrate: ratehistory[i].infrate,
                        ira_stock_pct: fIRA_Stock_Pct,
                        other_stock_pct: fOther_Stock_Pct,
                        
                        ira_distribution_amt: fIRA_Distribution_Amt,
                        pension_amt         : fPension_Amt,
                        socsec_taxable_amt  : fSocSec_Taxable_Amt,
                        socsec_taxable_pct  : fSocSec_Taxable_Pct,   
        
                        actual_qcd_amt      : fActual_QCD_Amt,
        
                        adjusted_gross_amt  : fAdjusted_Gross_Amt,
                        brkrg_taxable_dist_amt : fBrkrg_Taxable_Dist_Amt,
                        std_deduct_nbr      : fExemptions, 
                        std_deduct_amt      : fStd_Deduct_Amt,
                        senior_deduct_nbr  : fSenior_Deduct_Nbr,
                        senior_deduct_amt   : fSenior_Deduct_Amt,  
                   
                        top_tax_pct             : oTax_Results.top_pct,
                        
                        std_deduct_married : infadj_std_deduct_married,
                        std_deduct_single  : infadj_std_deduct_single,
                        taxtablemarried0 : infadj_taxtable_married[0].thru,
                        taxtablemarried1 : infadj_taxtable_married[1].thru,
                        taxtablemarried2 : infadj_taxtable_married[2].thru,
                        taxtablemarried3 : infadj_taxtable_married[3].thru,
                        taxtablemarried4 : infadj_taxtable_married[4].thru,
                        taxtablemarried5 : infadj_taxtable_married[5].thru,
                        taxtablemarried6 : infadj_taxtable_married[6].thru,
                        taxtablesingle0 : infadj_taxtable_single[0].thru,
                        taxtablesingle1 : infadj_taxtable_single[1].thru,
                        taxtablesingle2 : infadj_taxtable_single[2].thru,
                        taxtablesingle3 : infadj_taxtable_single[3].thru,
                        taxtablesingle4 : infadj_taxtable_single[4].thru,
                        taxtablesingle5 : infadj_taxtable_single[5].thru,
                        taxtablesingle6 : infadj_taxtable_single[6].thru,
                        captaxtable0_file_status : infadj_capgains_taxtable[0].file_status,
                        captaxtable0_thru : infadj_capgains_taxtable[0].thru,
                        captaxtable1_file_status : infadj_capgains_taxtable[1].file_status,
                        captaxtable1_thru : infadj_capgains_taxtable[1].thru,
                        captaxtable2_file_status : infadj_capgains_taxtable[2].file_status,
                        captaxtable2_thru : infadj_capgains_taxtable[2].thru,
                        captaxtable3_file_status : infadj_capgains_taxtable[3].file_status,
                        captaxtable3_thru : infadj_capgains_taxtable[3].thru,
                        captaxtable4_file_status : infadj_capgains_taxtable[4].file_status,
                        captaxtable4_thru : infadj_capgains_taxtable[4].thru,
                        captaxtable5_file_status : infadj_capgains_taxtable[5].file_status,
                        captaxtable5_thru : infadj_capgains_taxtable[5].thru,
                        
                       };

//**********************************************************************************
//* current yr taxes will be included in budget for next year.
//**********************************************************************************

         fInc_Tax_Amt = fCurYr_Inc_Tax_Amt;
         fCapGains_Tax_Amt = fCurYr_CapGains_Tax_Amt;   
        
//         if (fFrm_Plan_Id == "Roth Conv Test70" && fFrm_Roth_Conv_Pct == 22 && fYear_Cnt <= 3) 
//             {fInc_Tax_Amt = fFed_Tax_Hld_CurYr_Amt - fCurYr_Inc_Tax_Amt};
        
//       fFed_Tax_Due_LstYr_Amt = fCurYr_Inc_Tax_Amt + fCurYr_CapGains_Tax_Amt - fFed_Tax_Hld_CurYr_Amt;
//         fFed_Tax_Hld_CurYr_Amt = Math.round((fCurYr_Inc_Tax_Amt + fCurYr_CapGains_Tax_Amt)/2);     
               
                   
//*************************************************************************************
//* calculate bonus amount.  terminate bonus if early death.
//************************************************************************************
           fBonus_Amt = 0;
           if (fTotal_Need_Amt > 0 && fBudget_Adj_Pct == 1) 
               {fBonus_Amt = Math.round(fBas_Diff * fFrm_Bonus_Pct);}
   
//************************************************************************
//* inflation adjustments : social security, budget, pension, tax tables 
//************************************************************************

          fInfAdj_You_SocSec_Amt  = Math.round(fInfAdj_You_SocSec_Amt * (1+ratehistory[i].infrate));
          fInfAdj_Spo_SocSec_Amt  = Math.round(fInfAdj_Spo_SocSec_Amt * (1+ratehistory[i].infrate));
          fInfAdj_Home_Equity_Amt  = Math.round(fInfAdj_Home_Equity_Amt * (1+ratehistory[i].infrate));

          fReduce_Pct = 0.00;
          if (fRetired_Flag == "YES")
             {
              fReduce_Pct = fFrm_GoGo_Reduce_Pct;
              if (fYou_Age >= 75) {fReduce_Pct = fFrm_SloGo_Reduce_Pct;}
              if (fYou_Age >= 85) {fReduce_Pct = fFrm_NoGo_Reduce_Pct;}
             }
           
          fSpo_TakHom_Amt = 0;
          fSpo_TaxInc_Amt = 0;
        
          fInfAdj_Trans_Budget_Amt = Math.round(fInfAdj_Trans_Budget_Amt  * (1+ratehistory[i].infrate));
        
//          fInfAdj_Full_Budget_Amt = Math.round(fInfAdj_Full_Budget_Amt - (fInfAdj_Full_Budget_Amt * fReduce_Pct));
          
          fAdjust_Pct = 1+ratehistory[i].infrate - fReduce_Pct;
          fInfAdj_Full_Budget_Amt = Math.round(fInfAdj_Full_Budget_Amt  * fAdjust_Pct);
          
          fInfAdj_Lastx_Budget_Amt = Math.round(fInfAdj_Lastx_Budget_Amt  * (1+ratehistory[i].infrate));

          if (fFrm_You_Pension_Begin_Age > 0 && fYou_Age >= fFrm_You_Pension_Begin_Age)  
               {fInfAdj_You_Pension_Amt = Math.round(fInfAdj_You_Pension_Amt * (1+fFrm_You_Pension_Inf_Pct));}

          if (fFrm_Spo_Pension_Begin_Age > 0 && fSpo_Age >= fFrm_Spo_Pension_Begin_Age)
             {fInfAdj_Spo_Pension_Amt = Math.round(fInfAdj_Spo_Pension_Amt * (1+fFrm_Spo_Pension_Inf_Pct));}
       
          infadj_tax_variables_func(ratehistory[i].infrate);          

//************************************************************************
//* set beginning balances for next year from ending balance in current year 
//************************************************************************          
          fYou_IRA_Beg_Bal_Amt = fYou_IRA_End_Bal_Amt2;
          fSpo_IRA_Beg_Bal_Amt = fSpo_IRA_End_Bal_Amt2;
          fBrkrg_Beg_Bal_Amt = fBrkrg_End_Bal_Amt2;
          fBrkrg_Beg_Cost_Basis_Amt = fBrkrg_End_Cost_Basis_Amt;
          fRoth_Beg_Bal_Amt = fRoth_End_Bal_Amt2;
          fHSA_Beg_Bal_Amt = fHSA_End_Bal_Amt2;
                   
          fRowNbr++;
          fYou_Age++;
          if (fFrm_Spo_Current_Age > 0) {fSpo_Age++};

//***********************************************************************************************
//* if total ending balance for this scneario is <= 0, means scenario failed to reach end of retirement.
//* finish this scenario and go to next scenario.
//************************************************************************************************
          if ((fEnd_Bal + fInfAdj_Home_Equity_Amt) <= 0)
            {
               scenario_summary[fScenario_Nbr-1] = simulation_scenario[fRowNbr-1];
               fFailure_Nbr = fFailure_Nbr + 1;
               break;
            } 
        
      }
//***********************************************************************************************
//* if falls out of inside loop, means scenario got to retirement end age without running out of money.  
//************************************************************************************************
         fSurvive_Cnt++;
         scenario_summary[fScenario_Nbr-1] = simulation_scenario[fRowNbr-1];
         if (fFirst_Home_Draw_Age > 0) {fHome_Equity_Used_Nbr += 1;}
   }  

       
        
//***********************************************************************************************
//* if falls out of outside loop, means all scenarios simulated - now time to report results.
//************************************************************************************************
    
    var today = new Date();
    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
    var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
    var dateTime = date+' '+time;

    var fSuccessNbr = fScenario_Nbr - fFailure_Nbr;
    var fSuccessRate = Math.round((fSuccessNbr / fScenario_Nbr) * 100);

    var TableResults = "<h3> RPS Simulation Results - " + dateTime + "</h3>";

    TableResults = TableResults + fScenario_Nbr + " scenarios simulated ";  
    TableResults = TableResults + " of which " + fSuccessNbr + " passed for a success rate of ";
    TableResults = TableResults + fSuccessRate + "%.  Scenario test is considered successful if net worth is greater than zero at the end of retirement. </p>";   
    TableResults = TableResults + fHome_Equity_Used_Nbr + " scenarios that survived required using home equity. </p>";   

//*****************************************************************************************
//* sort scenario summary results worst to best
//****************************************************************************************    
    scenario_summary.sort(function(a, b){return a.scenario_score - b.scenario_score});

    fMedian_Scenario = Math.round(fScenario_Nbr / 2);
    if (scenario_summary[fMedian_Scenario].scenario_year == 1) {fMedian_Scenario++;}

    fWorst_Case_Scenario = 0;
    if (scenario_summary[fWorst_Case_Scenario].scenario_year == 1) {fWorst_Case_Scenario++;}
    
    fBest_Case_Scenario = fScenario_Nbr - 1; 
    if (scenario_summary[fBest_Case_Scenario].scenario_year == 1) {fMedian_Scenario--;}

    fWorst_Year=scenario_summary[fWorst_Case_Scenario].scenario_year;
    fBest_Year=scenario_summary[fBest_Case_Scenario].scenario_year;
    fMedian_Year=scenario_summary[fMedian_Scenario].scenario_year;

    fMost_Recent_Year = fCurrent_Year - fNbr_Years - 1;      
    
    TableResults = TableResults + set_table_style();
    
    TableResults = show_scenario_summary(TableResults, scenario_summary, fFrm_You_Retire_End_Age, fNbr_Years,fWorst_Year,fBest_Year,fMedian_Year, fMost_Recent_Year);
    
    if (fDownload_Results == "YES")
         {download_simulation_result_summary(scenario_summary, fFrm_You_Retire_End_Age, fNbr_Years); }
       
    TableResults = showdetails(TableResults,simulation_scenario, 1, "Minimum");
        
    TableResults = showdetails(TableResults,simulation_scenario, 101, "Average");

    TableResults = showdetails(TableResults,simulation_scenario, fWorst_Year, " - Worst Case");
 
    TableResults = showdetails(TableResults,simulation_scenario, fMedian_Year, " - Median Case");
  
    TableResults = showdetails(TableResults,simulation_scenario, fBest_Year, " - Best Case");
     
    TableResults = showdetails(TableResults,simulation_scenario, fMost_Recent_Year, " - Recent Case");

    openWin(TableResults);   
   
    document.getElementById("showresults").innerHTML = " ";
    
//    window.scrollTo(0, 700);
    
   if (fDownload_Results == "YES")
        {download_simulation_result_detail(simulation_scenario);
         download_simulation_input_variables(form);}
    
 }
</script>

<script>

function openWin(TableResults) {
try {
  myWindow.close();
 }
  catch (err)
      {   }
  myWindow = window.open("", "myWindow", "scrollbars=yes,width=1500,height=600");
  myWindow.document.write(TableResults);
}

function closeWin() {
  myWindow.close();
}
</script>          

<script>
function openWin2(TableResults) {
try {
  myWindow.close();
 }
  catch (err)
      {   }
  myWindow = window.open("", "myWindow", "scrollbars=yes,width=750,height=300");
  myWindow.document.write(TableResults);
}

function closeWin() {
  myWindow.close();
}
</script>          
          
          
                   
<script type="text/javascript"> 
    function showdetails(TableResults, simulation_scenario, fYear, fCase) {

      var fsimulation_scenarioLen = simulation_scenario.length;

      fCaption =  '<caption style="text-align:left"> <h3> Detail simulation results using Minimum Base Rates </h3></caption>';
      
      if (fYear == 101)
          {fCaption = '<caption style="text-align:left"> <h3> Detail simulation results using Average Rates </h3></caption>';}
      
      if (fYear > 101) 
	  {fCaption = '<caption style="text-align:left"> <h3> Detail simulation results using rates starting in ' + fYear + fCase + '</h3></caption>';}
      
      TableResults = TableResults + fCaption;

//**********************************************************************************
//* first row of column headers        
//**********************************************************************************        
        
       TableResults = TableResults + '<table id = "Scenario_Results">' + 
                          '<thead>' +
                          '<tr>' +
                         '<th colspan="3" style="background-color:#4d7e80">Age</th> ';
           
         TableResults = TableResults +       
             '<th colspan="6" style="background-color:#4da6ff">Spend Plan</th> ';
        
        
        fPension_Cnt = 0;
        if (fFrm_You_Pension_Amt > 0)
           {fPension_Cnt++};
        
        if (fFrm_Spo_Pension_Amt > 0)
           {fPension_Cnt++};
        
        if (fPension_Cnt == 2)
           {TableResults = TableResults +      
                          '<th colspan="4" style="background-color:#ff66ff">Total Income</th> ';}
        if (fPension_Cnt == 1)
           {TableResults = TableResults +      
                          '<th colspan="3" style="background-color:#ff66ff">Total Income</th> ';}
        if (fPension_Cnt == 0)
           {TableResults = TableResults +      
                          '<th colspan="2" style="background-color:#ff66ff">Total Income</th> ';}
                     
       TableResults = TableResults +
                          '<th colspan="1"> </th> ' +
                          '<th colspan="6" style="background-color:#666699">Withdraw Strategy </th> ' +
                          '<th colspan="6" style="background-color:#E18973">Summary Account Activity</th> ' + 
                          '<th colspan="3" >Rates' +
                          '<th colspan="2" >Asset Alloc' 
                          ;
        if (fFrm_Rpt_Fmt_Flg == "Detail")
            {TableResults = TableResults + 
                          '<th colspan="1" style="background-color:#ff33cc"> </th> ' +
                          '<th colspan="2" style="background-color:#000000"> </th> ' +
                          '<th colspan="6" style="background-color:#33C0FF">You IRA Account Activity</th> ' +
                          '<th colspan="6" style="background-color:#D833FF">Spouse IRA Account Activity</th> ' +
                          '<th colspan="8" style="background-color:#000000">Brokerage Account Activity</th> ' +
                          '<th colspan="7" style="background-color:#FF9A33">Roth Account Activity</th> ' +
                          '<th colspan="5" style="background-color:#33C0FF">HSA Account Activity</th> ' +
                          '<th colspan="14" style="background-color:#5F9EA0">Federal Income Tax Calculations</th> ' +
                          '<th colspan="14" style="background-color:#5F9EA0">Federal Tax Brackets</th> ' +
                          '<th colspan="9" style="background-color:#999966">Capital Gains Tax Calculation</th> ' +
                          '<th colspan="6" style="background-color:#999966">Capital Gains Tax Brackets</th> ';
            }
        
         TableResults = TableResults + " </tr> " ;
        
        
//**********************************************************************************
//* 2nd row of column headers        
//**********************************************************************************        
        
 
      TableResults = TableResults + "<tr> " + 
                         '<th style="background-color:#4d7e80">Year</th> ' +
                         '<th style="background-color:#4d7e80">You</th> ' +
                         '<th style="background-color:#4d7e80">Sp</th> ' +
                         '<th style="background-color:#4da6ff">Budget</th> ' +
                         '<th style="background-color:#4da6ff">Mtge</th> ' +
                         '<th style="background-color:#4da6ff">Variable</th> ' +
                         
                         '<th style="background-color:#4da6ff">Inc Tax</th> ' + 
                         '<th style="background-color:#4da6ff">Cap Gains Tax</th> '; 
        
    TableResults = TableResults + 
                         '<th style="background-color:#4da6ff">Med B Prem</th> ';
    
    TableResults = TableResults +     
                         '<th style="background-color:#ff66ff">You SocSec</th> ' +
                         '<th style="background-color:#ff66ff">Spo SocSec</th> ';
        
    if (fFrm_You_Pension_Amt > 0)
         {TableResults = TableResults +     
                             '<th style="background-color:#ff66ff">You Pension</th> ';} 
    if (fFrm_Spo_Pension_Amt > 0)
        {TableResults = TableResults +     
                             '<th style="background-color:#ff66ff">Spo Pension</th> ';}
    
    TableResults = TableResults +     
                              '<th>Withdraw From Savings</th> ' +
          
                          '<th style="background-color:#666699">You IRA</th> ' +
                          '<th style="background-color:#666699">Sp IRA</th> ' +
                          '<th style="background-color:#666699">Brkrg</th> ' +
                          '<th style="background-color:#666699">Roth</th> ' +
                          '<th style="background-color:#666699">HSA</th> ' +
                          '<th style="background-color:#666699">Home Equity</th> ' +
          
          
// summary account info          
                         '<th style="background-color:#E18973">Beg Bal</th> ' +
                         '<th style="background-color:#E18973">Withdraw</th> ' +
                         '<th style="background-color:#E18973">Gain (Loss)</th> ' +
                         '<th style="background-color:#E18973">Deposit</th> ' +
                         '<th style="background-color:#E18973">End Bal</th> '+ 
                         '<th style="background-color:#E18973">Home Equity</th> '+ 
                         '<th>Stock Ret</th> ' + 
                         '<th>Bond Ret</th> ' +      
                         '<th>Inf Rate</th> ' +
                         '<th>IRA</th> ' + 
                         '<th>NonIRA</th> ' ;     
                         
 
        if (fFrm_Rpt_Fmt_Flg == "Detail")
              {    
                 TableResults = TableResults +
                         '<th style="background-color:#ff33cc">Base</th> ';
	                
                 TableResults = TableResults +    
                     '<th style="background-color:#000000">SS Taxable</th> ' +
                     '<th style="background-color:#000000">Top Tax</th> ';

                  
// you ira info
                 TableResults = TableResults +       
                         '<th style="background-color:#33C0FF">Beg Bal </th> ' +
                         '<th style="background-color:#33C0FF">Draw RMD </th> ' +
                         '<th style="background-color:#33C0FF">Draw Addl </th> ' +
                         '<th style="background-color:#33C0FF">Gain / Loss</th> ' +
                         '<th style="background-color:#33C0FF">Deposit </th> ' +
                         '<th style="background-color:#33C0FF">End Bal </th> ' +
// Spouse IRA activity
                         '<th style="background-color:#D833FF">Beg Bal </th> ' +
                         '<th style="background-color:#D833FF">Draw RMD </th> ' +
                         '<th style="background-color:#D833FF">Draw Addl </th> ' +
                         '<th style="background-color:#D833FF">Gain / Loss</th> ' +
                         '<th style="background-color:#D833FF">Deposit </th> ' +
                         '<th style="background-color:#D833FF">End Bal </th> ' +
// brokerage account activity          
                         '<th style="background-color:#000000">Beg Bal </th> ' +
                         '<th style="background-color:#000000">Draw / Deposit</th> ' +
                         '<th style="background-color:#000000">Gain / Loss</th> ' +
                         '<th style="background-color:#000000">Deposit </th> ' +
                         '<th style="background-color:#000000">End Bal </th> ' +

                         '<th style="background-color:#b3b3cc">Beg Cost Basis </th> ' +
                         '<th style="background-color:#b3b3cc">Adj Cost Basis </th> ' +
                         '<th style="background-color:#b3b3cc">End Cost Basis </th> ' +
// Roth account activity                        
                         '<th style="background-color:#FF9A33">Beg Bal </th> ' +
                         '<th style="background-color:#FF9A33">Draw / Deposit </th> ' +
                         '<th style="background-color:#FF9A33">Gain / Loss</th> ' +
                         '<th style="background-color:#FF9A33">Deposit </th> ' +
                         '<th style="background-color:#FF9A33">End Bal </th> ' +
                         '<th style="background-color:#993300">Conv You </th> ' +
                         '<th style="background-color:#993300">Conv Spouse </th> ' +
// HSA account activity                          
                         '<th style="background-color:#33C0FF">Beg Bal </th> ' +
                         '<th style="background-color:#33C0FF">Draw </th> ' +
                         '<th style="background-color:#33C0FF">Gain / Loss</th> ' +
                         '<th style="background-color:#33C0FF">Deposit </th> ' +
                         '<th style="background-color:#33C0FF">End Bal </th> ' +
                                     
// income tax calcultion 
                         '<th style="background-color:#5F9EA0">IRA Draw</th> ' +
                         '<th style="background-color:#5F9EA0">Pension</th> ' +
                         '<th style="background-color:#5F9EA0">SS Taxable Amt </th> ' +
                         '<th style="background-color:#5F9EA0">SS Taxable Pct </th> ' +
                         '<th style="background-color:#5F9EA0">Brkrg Dist Taxable </th> ' +
                         '<th style="background-color:#5F9EA0">QCD Amt </th> ' +
                         '<th style="background-color:#5F9EA0">Adjusted Gross </th> ' +
                         '<th style="background-color:#5F9EA0">Std Deduct Nbr </th> ' +
                         '<th style="background-color:#5F9EA0">Std Deduct Amt </th> ' +
                         '<th style="background-color:#5F9EA0">Sr Deduct Nbr </th> ' +
                         '<th style="background-color:#5F9EA0">Sr Deduct Amt </th> ' +
                         '<th style="background-color:#5F9EA0">Taxable Income</th> ' +
                         '<th style="background-color:#5F9EA0">Est Tax</th> ' +   
                         '<th style="background-color:#5F9EA0">Top Tax</th> ' +   


  
                         "<th>Tax Married 10%</th> " +
                         "<th>Tax Married 12%</th> " +
                         "<th>Tax Married 22%</th> " +
                         "<th>Tax Married 24%</th> " +
                         "<th>Tax Married 32%</th> " +
                         "<th>Tax Married 35%</th> " + 
                         "<th>Tax Married 37%</th> " +
                         "<th>Tax Single 10%</th> " +
                         "<th>Tax Single 12%</th> " +
                         "<th>Tax Single 22%</th> " +
                         "<th>Tax Single 24%</th> " +
                         "<th>Tax Single 32%</th> " +
                         "<th>Tax Single 35%</th> " +
                         "<th>Tax Single 37%</th> " +
// capital gains tax calculation
          
                         '<th style="background-color:#999966">Adj Gross</th> ' + 
                         '<th style="background-color:#999966">Std Ded Nbr</th> ' + 
                         '<th style="background-color:#999966">Std Ded Amt</th> ' + 
                         '<th style="background-color:#999966">Sr Ded Nbr</th> ' + 
                         '<th style="background-color:#999966">Sr Ded Amt</th> ' + 
                         '<th style="background-color:#999966">Brkg Withdraw</th> ' + 
                         '<th style="background-color:#999966">Adj Cost Basis</th> ' + 
                         '<th style="background-color:#999966">Cap Gains</th> ' + 
                         '<th style="background-color:#999966">Cap Gains Tax</th> ' +  
                         
                         "<th>Tax Married 0%</th> " +
                         "<th>Tax Married 15%</th> " +
                         "<th>Tax Married 20%</th> " +

                         "<th>Tax Single 0%</th> " +
                         "<th>Tax Single 15%</th> " +
                         "<th>Tax Single 20%</th> ";
              }
                    TableResults = TableResults +  
                          " </tr> " ;
     
      
//      fBaseline_Year = getcurrentyear();  
        fBaseline_Year = fCurrent_Year;
      
      for (var i=0; i<fsimulation_scenarioLen; i++)
       
      {
         if (simulation_scenario[i].scenario_year == fYear)
          {
           fStockColor = setcolor(simulation_scenario[i].stockret);
           fBondColor = setcolor(simulation_scenario[i].bondret);
           fInfRateColor = setcolor(simulation_scenario[i].infrate);
           fGainColor = setcolor(simulation_scenario[i].total_gain_amt);
           fRoth_Background_Color  = setbackgroundcolor(simulation_scenario[i].roth_draw_amt);  
           fBrkrg_Background_Color = setbackgroundcolor(simulation_scenario[i].brkrg_draw_amt);   
           
           fYou_IRA_Draw_Amt = simulation_scenario[i].you_rmd_draw_amt + simulation_scenario[i].you_ira_addl_draw_amt;
           fSpo_IRA_Draw_Amt = simulation_scenario[i].spo_rmd_draw_amt + simulation_scenario[i].spo_ira_addl_draw_amt;
        
           fDisplay_Year = simulation_scenario[i].year;   
           if (fYear == 1) 
              {fDisplay_Year = fBaseline_Year;
               fBaseline_Year +=1;
              };
               
           TableResults = TableResults + "<tr>" +  
               '<td align = "right"> ' + fDisplay_Year  + " </td> " +
               '<td align = "right"> ' + simulation_scenario[i].you_age  + " </td> " +
               '<td align = "right"> ' + simulation_scenario[i].spouse_age  + " </td> " +

// spend plan   
// income
               '<td align = "right"> ' + addcomma(simulation_scenario[i].infadj_budget_amt)  + " </td> " +
               '<td align = "right"> ' + addcomma(simulation_scenario[i].mortgage_budget_amt)  + " </td> " +
               '<td align = "right"> ' + addcomma(simulation_scenario[i].bonus_amt)  + " </td> " +
               '<td align = "right"> ' + simulation_scenario[i].inc_tax_amt  + " </td> " +
               '<td align = "right"> ' + simulation_scenario[i].capgains_tax_amt  + " </td> ";
            
            TableResults = TableResults +      
                  '<td align = "right"> ' + simulation_scenario[i].medb_premium_amt  + " </td> ";      

           TableResults = TableResults +      
               '<td align = "right"> ' + addcomma(simulation_scenario[i].you_socsec_amt)  + " </td> " +
               '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_socsec_amt)  + " </td> ";
          
           if (fFrm_You_Pension_Amt > 0)
               {TableResults = TableResults +      
               '<td align = "right"> ' + addcomma(simulation_scenario[i].you_pension_amt)  + " </td> ";}

           if (fFrm_Spo_Pension_Amt > 0)
              {TableResults = TableResults +      
               '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_pension_amt)  + " </td> ";}

// withdraw need
// withdraw strategy
// summary account activity 
           TableResults = TableResults +
               '<td align = "right"> ' + addcomma(simulation_scenario[i].total_need_amt)   + " </td> " +
               '<td align = "right"> ' + addcomma(fYou_IRA_Draw_Amt * -1)+"</td> " +       
               '<td align = "right"> ' + addcomma(fSpo_IRA_Draw_Amt * -1)+"</td> " +       
               '<td ' + fBrkrg_Background_Color + '>' + addsign(addcomma(simulation_scenario[i].brkrg_draw_amt * -1)) + "</td> " +      
               '<td ' + fRoth_Background_Color  + '>' + addsign(addcomma(simulation_scenario[i].roth_draw_amt * -1))  + "</td> " +      
               '<td ' + fRoth_Background_Color  + '>' + addsign(addcomma(simulation_scenario[i].hsa_draw_amt * -1))  + "</td> " + 
                '<td ' + '>' + addsign(addcomma(simulation_scenario[i].home_draw_amt * -1))  + "</td> " + 
               '<td align = "right"> ' + addcomma(simulation_scenario[i].beg_bal)   + " </td> " +
               '<td align = "right"> ' + addcomma(simulation_scenario[i].total_draw_amt * -1)   + " </td> " +
               '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].total_gain_amt) + " </td> " +
               '<td align = "right"> ' + addcomma(simulation_scenario[i].total_ann_dep_amt)   + " </td> " +    
               '<td align = "right"> ' + addcomma(simulation_scenario[i].end_bal)   + " </td> "  +
               '<td align = "right"> ' + addcomma(simulation_scenario[i].infadj_home_equity_amt)   + " </td> "  +
               '<td ' + fStockColor + ' align = "right"> ' + (Math.round(simulation_scenario[i].stockret * 10000)/100) + "%"+ " </td> " +
               '<td ' + fBondColor + ' align = "right"> ' + (Math.round(simulation_scenario[i].bondret * 10000)/100) + "%"+ 
               " </td> " +
               '<td ' + fInfRateColor + ' align = "right"> ' + (Math.round(simulation_scenario[i].infrate * 10000)/100) + "%"+ 
               " </td> "  +
               '<td ' + fBondColor + ' align = "right"> ' + (Math.round(simulation_scenario[i].ira_stock_pct * 10000)/100) + "%"+ 
               " </td> " +
               '<td ' + fInfRateColor + ' align = "right"> ' + (Math.round(simulation_scenario[i].other_stock_pct * 10000)/100) + "%"+ 
               " </td> "  ; 
        
          
          if (fFrm_Rpt_Fmt_Flg == "Detail")
              {
                  TableResults = TableResults + 
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].bas_end_bal)   + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].socsec_taxable_pct  + "%" + " </td> " +
                  '<td align = "right"> ' + (simulation_scenario[i].top_tax_pct * 100) + "%" + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].you_ira_beg_bal_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].you_rmd_draw_amt * -1) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].you_ira_addl_draw_amt * -1) + " </td> " +
                  '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].you_ira_gain_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].you_ira_ann_dep_amt) + " </td> " +      
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].you_ira_end_bal_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_beg_bal_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_rmd_draw_amt * -1) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_addl_draw_amt * -1) + " </td> " +
                  '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_gain_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_ann_dep_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_end_bal_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_beg_bal_amt) + " </]td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_draw_amt * -1) + " </td> " +
                  '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].brkrg_gain_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_ann_dep_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_end_bal_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_beg_cost_basis_amt) + " </]td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_adj_cost_basis_amt) + " </]td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_end_cost_basis_amt) + " </]td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].roth_beg_bal_amt)    + " </]td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].roth_draw_amt * -1)      + " </td> " +
                  '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].roth_gain_amt)       + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].roth_ann_dep_amt) + " </td> " +   
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].roth_end_bal_amt)    + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].you_roth_conv_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_roth_conv_amt) + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].hsa_beg_bal_amt)    + " </]td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].hsa_draw_amt * -1)      + " </td> " +
                  '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].hsa_gain_amt)       + " </td> " +
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].hsa_ann_dep_amt) + " </td> " +   
                  '<td align = "right"> ' + addcomma(simulation_scenario[i].hsa_end_bal_amt)    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].ira_distribution_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].pension_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].socsec_taxable_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].socsec_taxable_pct  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].brkrg_taxable_dist_amt  + " </td> " +    
                  '<td align = "right"> ' + simulation_scenario[i].actual_qcd_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].adjusted_gross_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].std_deduct_nbr  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].std_deduct_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].senior_deduct_nbr  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].senior_deduct_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].curyr_taxable_income  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].curyr_inc_tax_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].top_tax_pct  + " </td> " +   
                  '<td align = "right"> ' + simulation_scenario[i].taxtablemarried0    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablemarried1    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablemarried2    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablemarried3    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablemarried4    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablemarried5    + " </td> " +
                  '<td align = "right"> ' + 'unlimited'    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablesingle0    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablesingle1    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablesingle2    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablesingle3    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablesingle4    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].taxtablesingle5    + " </td> " +
                  '<td align = "right"> ' + 'unlimited'    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].adjusted_gross_amt    + " </td> " +    
                  '<td align = "right"> ' + simulation_scenario[i].std_deduct_nbr  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].std_deduct_amt  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].senior_deduct_nbr  + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].senior_deduct_amt  + " </td> " +
                  '<td align = "right"> ' + (simulation_scenario[i].brkrg_draw_amt * -1) + " </td> " +       
                  '<td align = "right"> ' + simulation_scenario[i].brkrg_adj_cost_basis_amt + " </]td> " +
                  '<td align = "right"> ' + simulation_scenario[i].curyr_capgains_amt + " </]td> " +
                  '<td align = "right"> ' + simulation_scenario[i].curyr_capgains_tax_amt + " </]td> " +
                  '<td align = "right"> ' + simulation_scenario[i].captaxtable0_thru    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].captaxtable1_thru    + " </td> " +
                  '<td align = "right"> ' + 'unlimited'   + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].captaxtable3_thru    + " </td> " +
                  '<td align = "right"> ' + simulation_scenario[i].captaxtable4_thru    + " </td> " +
                  '<td align = "right"> ' + 'unlimited'    + " </td> ";
              }
            TableResults = TableResults +   
                 " </tr>" ;


          }
       }      

      TableResults = TableResults + "</table>";
       
      return TableResults;
 }
</script>

<script type="text/javascript">
 function show_scenario_summary(TableResults, scenario_summary, fFrm_You_Retire_End_Age, fNbr_Years,fWorst_Year, fBest_Year, fMedian_Year,fMost_Recent_Year) {
//***********************************************************************
//* show scenario summary
//***********************************************************************

      scenario_summary.sort(function(a, b){return a.scenario_year - b.scenario_year});      

      fscenario_summary_len = scenario_summary.length;

      TableResults = TableResults + '<table id = "Scenario_Results">' + 
                     '<thead>' +
                     '<tr>' + '<th colspan="10" style="background-color:#000000; text-align:center">Simulation Sample Results </th> ' +
                    '<tr> ' + 
                    '<th style="background-color:#000000">Simulated Scenario</th> ' +
                    '<th style="background-color:#000000">Scenario Status</th> ' +
                    '<th style="background-color:#000000">Simulation Result</th> ' +
                    '<th style="background-color:#000000">Budget Spent</th> ' +
                    '<th style="background-color:#000000">Variable Draw</th> ' +
                    '<th style="background-color:#000000">Avg Variable </th> ' +
                    '<th style="background-color:#000000">Last Year Withdraw </th> ' +
                    '<th style="background-color:#000000">End Bal </th> ' +
                    '<th style="background-color:#000000">End Home Equity </th> ' +
                    " </tr> " ;
     
      fFailed_Case_Shown = "N";
      fHE_Case_Shown = "N";
    
     for (var i=0; i<fscenario_summary_len; i++)
       
      {
           fScenario_Status = "Success";
           fShow = "N";
           
           if (scenario_summary[i].end_bal == 0 &&  
               scenario_summary[i].infadj_home_equity_amt == 0 && 
               fFailed_Case_Shown == "N")
                   {fScenario_Status = "Failed Case"; 
                    fShow = "Y";
                    fFailed_Case_Shown = "Y";
                   }
        
          if (scenario_summary[i].end_bal == 0 &&  
              scenario_summary[i].home_equity_amt > 0 && 
              fHE_Case_Shown == "N")
                   {fScenario_Status = "Success"; 
                    fShow = "Y";
                    fHE_Case_Shown == "Y";
                   }
           if (scenario_summary[i].scenario_year == fWorst_Year) {fScenario_Status = "Worst Case"; fShow="Y";}
           if (scenario_summary[i].scenario_year == fBest_Year) {fScenario_Status = "Best Case"; fShow="Y";}
           if (scenario_summary[i].scenario_year == fMedian_Year) {fScenario_Status = "Median Case"; fShow="Y";}
           if (scenario_summary[i].scenario_year == 1) {fScenario_Status = "Minimum Base"; fShow="Y";}
           if (scenario_summary[i].scenario_year == 101) {fScenario_Status = "Average Rates"; fShow="Y";}
           if (scenario_summary[i].scenario_year == fMost_Recent_Year) {fScenario_Status = "Recent Case"; fShow="Y";}
           
           if (fShow == "Y")
            {   
              
              fYears_Remain = "unknown";  
              if (scenario_summary[i].total_draw_amt > 0)     
                  {fYears_Remain = Math.round(scenario_summary[i].end_bal / scenario_summary[i].total_draw_amt);}
                
              fBackGround = 'style="background-color:#66ff99">'; // default green 
              if (scenario_summary[i].end_bal == 0) 
               {fBackGround = 'style="background-color:#ffff00">'};  // set to yellow "background-color:#FF0000"

              fScenarioRange = scenario_summary[i].scenario_year + " thru " + (scenario_summary[i].scenario_year + fNbr_Years);
              if (scenario_summary[i].scenario_year == 1) {fScenarioRange = "Base";}
              if (scenario_summary[i].scenario_year == 101) {fScenarioRange = "Average";}    
           
              fResult = "Success!" 
              
              if (scenario_summary[i].end_bal == 0) 
                 {if (scenario_summary[i].infadj_home_equity_amt == 0)
                   {fResult = "Net worth exhausted at age " + (scenario_summary[i].you_age);}
                  else
                   {fResult = "Home equity used at age " + scenario_summary[i].first_home_draw_age ;}
                 }


              TableResults = TableResults + "<tr " +  
                ">" + 
           
              '<td align = "center"> ' + fScenarioRange  + " </td> " +
              '<td align = "center" ' + fBackGround + fScenario_Status  + " </td> " +
              
              '<td align = "center"> ' + fResult  + " </td> " +             
              
              '<td align = "center"> '  + addcomma(scenario_summary[i].infadj_budget_running_total) + "</td> " +
              '<td align = "center"> '  + addcomma(scenario_summary[i].bonus_running_total) + "</td> " +
              '<td align = "center"> '  + Math.round((scenario_summary[i].bonus_running_total /
                                                   scenario_summary[i].infadj_budget_running_total)*100) + "%"      
                                                     + "</td> " +  
                  
              '<td align = "center"> '  + addcomma(scenario_summary[i].total_draw_amt) + "</td> " +
              '<td align = "center"> '  + addcomma(scenario_summary[i].end_bal) + "</td> " +
              '<td align = "center"> '  + addcomma(scenario_summary[i].infadj_home_equity_amt) + "</td> " +
              " </tr>" ;
            }

       }      

      TableResults = TableResults + "</table>";
       
      return TableResults;
 }	
</script>

 <script type="text/javascript">
 function set_table_style() {
//****************************************************
//* set table style
//****************************************************

  fTable_Style = "<style> " +
               '#Scenario_Results {font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;  font-size: 14px; border-collapse: collapse; width: 100%; }' +
               '#Scenario_Results td, #Scenario_Results th {border: 1px solid #ddd;padding: 6px; }' +
               '#Scenario_Results tr:nth-child(even){background-color: #f2f2f2;}' +
               '#Scenario_Results tr:hover {background-color: #ddd;}' +
               '#Scenario_Results th {padding-top: 6px;padding-bottom: 6px;text-align: center;background-color: #4CAF50;color: white;}' +
               'thead tr:nth-child(1) th { position: sticky; top: 0; }' +
               'thead tr:nth-child(2) th { position: sticky; top: 27px; }' +
               '</style>';
  return fTable_Style;
}
</script>

    
     
<script type="text/javascript">
 function download_simulation_result_summary(scenario_summary, fFrm_You_Retire_End_Age, fNbr_Years) {

     scenario_summary.sort(function(a, b){return a.scenario_year - b.scenario_year});      

     fscenario_summary_len = scenario_summary.length;

     csv = "Scenario Year, Simulation Result, Budget Spent, Variable Draw, Avg Variable Draw, Last Year Budget, End Bal, Home Equity, First Year Home Equity Years, Years Remain, Fed Tax, Score \r\n";   
     
     for (var i=0; i<fscenario_summary_len; i++)
       
      {
           fScenario_Status = "Success";
             
           fYears_Remain = Math.round(scenario_summary[i].end_bal / scenario_summary[i].infadj_budget_amt); 
           fAvg_Bonus = Math.round((scenario_summary[i].bonus_running_total / scenario_summary[i].infadj_budget_running_total)*100);
           
              fScenarioRange = scenario_summary[i].scenario_year + " thru " + (scenario_summary[i].scenario_year + fNbr_Years);
              if (scenario_summary[i].scenario_year == 1) {fScenarioRange = "Minimum";}
              if (scenario_summary[i].scenario_year == 101) {fScenarioRange = "Average";}           
              fResult = "Success!";

              if (scenario_summary[i].end_bal == 0 &&
                  scenario_summary[i].infadj_home_equity_amt == 0)
                   {fResult = "Net worth exhausted age " + (scenario_summary[i].you_age);}

              if (scenario_summary[i].end_bal == 0 &&  
                  scenario_summary[i].infadj_home_equity_amt > 0)
                   {fResult = "Success - home equity used age " + scenario_summary[i].first_home_draw_age ;}
                 
                 csv = csv + fScenarioRange + "," + 
                    fResult + "," + scenario_summary[i].infadj_budget_running_total + 
                  "," + scenario_summary[i].bonus_running_total + 
                  "," + fAvg_Bonus + "%" + 
                  "," + scenario_summary[i].infadj_budget_amt + 
                  "," + scenario_summary[i].end_bal + 
                  "," + scenario_summary[i].infadj_home_equity_amt + 
                  "," + scenario_summary[i].first_home_draw_age +
                  "," + fYears_Remain  +
                  "," + scenario_summary[i].fed_tax_running_total + 
                  "," + scenario_summary[i].scenario_score + 
                  " \r\n" ;
    
       } 
     
     fileName1 = fFrm_Plan_Id.concat("_");
     fileName = fileName1.concat("RPS_sim_result_smry");
     let csvData = new Blob([csv], { type: 'text/csv' });  
     let csvUrl = URL.createObjectURL(csvData);
 
     let hiddenElement = document.createElement('a');
     hiddenElement.href = csvUrl;
     hiddenElement.target = '_blank';
     hiddenElement.download = fileName + '.csv';
     hiddenElement.click();

     
 }	
</script>    

<script type="text/javascript"> 
    function download_simulation_result_detail(simulation_scenario) {
 
      csv =  ",,Age,,Spend Plan,,,,,,Total Income,,,,,Withdraw Strategy,,,,,,Summary Account Activity,,,,,,,,,," + 
               "You IRA Account Activity,,,,,,Spouse IRA Account Activity,,,,,,Brokerage Account Activity,,,,,,,," + 
               "Roth Account Activity,,,,,,,HSA Account Activity,,,,,Federal Income Tax Calculations,,,,,,,,,,," + 
               "Federal Tax Brackets,,,,,,,,,,,,,,Capital Gains Tax Calculation,,,,,,,,," + 
               "Capital Gains Tax Brackets,,,,,," + 
               " \r\n" ;
                         
      csv = csv +  
               "Scenario, Year, You, Spouse, Budget, Mortgage,Variable, Inc Tax, Cap Gains Tax, Med B Prem, You Soc Sec, " +
               "Spouse Soc Sec, You Pension, Spouse Pension, Withdraw From Savings, You IRA, Spouse IRA," +
               "Brokerage, Roth, HSA, Home Equity, Beg Bal, Withdraw, Gain(Loss), Deposit, End Bal, Home Equity," +
               "Base, Stock Ret, Bond Ret, Inf Rate," +
               "Beg Bal, Draw RMD ,Draw Addl, Gain / Loss, Deposit, End Bal," +
               "Beg Bal, Draw RMD, Draw Addl, Gain / Loss, Deposit, End Bal," +
               "Beg Bal, Draw / Deposit, Gain / Loss, Deposit, End Bal," +
               "Beg Cost Basis, Adj Cost Basis, End Cost Basis," +
               "Beg Bal , Draw / Deposit, Gain / Loss, Deposit, End Bal, Conv You, Conv Spouse," +
               "Beg Bal , Draw, Gain / Loss, Deposit, End Bal," +
               "IRA Draw, Pension, SS Taxable Amt, SS Taxable Pct, Brkrg Taxable Dist, QCD, Adjusted Gross, Std Deduct Nbr, Std Deduct Amt," +
               "Sr Deduct Nbr, Sr Deduct Amt, Taxable Income, Est Tax," +   
               "Tax Married 10% , Tax Married 12%, Tax Married 22%, Tax Married 24%, " +
               "Tax Married 32%, Tax Married 35% , Tax Married 37% , Tax Single 10%, " +
               "Tax Single 12% , Tax Single 22% , Tax Single 24%, Tax Single 32%, " +
               "Tax Single 35% , Tax Single 37%, Adj Gross, Std Ded Nbr, Std Ded Amt, " + 
               "Sr Ded Nbr , Sr Ded Amt, Brkg Withdraw, Adj Cost Basis, Cap Gains, Cap Gains Tax, " +  
               "Tax Married 0%, Tax Married 15%, Tax Married 20%, Tax Single 0%, Tax Single 15%, Tax Single 20%, " +
               " \r\n";     

       var fsimulation_scenarioLen = simulation_scenario.length;
        
for (var i=0; i<fsimulation_scenarioLen; i++)
   
  {
         
     fYou_IRA_Draw_Amt = simulation_scenario[i].you_rmd_draw_amt + simulation_scenario[i].you_ira_addl_draw_amt;
     fSpo_IRA_Draw_Amt = simulation_scenario[i].spo_rmd_draw_amt + simulation_scenario[i].spo_ira_addl_draw_amt;
     
     csv = csv + simulation_scenario[i].scenario_year + 
       "," + simulation_scenario[i].year + "," + simulation_scenario[i].you_age + "," + simulation_scenario[i].spouse_age +
       "," + simulation_scenario[i].infadj_budget_amt + "," + simulation_scenario[i].mortgage_budget_amt + "," + simulation_scenario[i].bonus_amt +
       "," + simulation_scenario[i].inc_tax_amt + "," +  simulation_scenario[i].capgains_tax_amt + 
       "," +  simulation_scenario[i].medb_premium_amt +
       "," +  simulation_scenario[i].you_socsec_amt +
       "," + simulation_scenario[i].spo_socsec_amt + "," + simulation_scenario[i].you_pension_amt + "," +  simulation_scenario[i].spo_pension_amt +
       "," + simulation_scenario[i].total_need_amt + 
       "," + (fYou_IRA_Draw_Amt * -1) + "," + (fSpo_IRA_Draw_Amt * -1) + "," + (simulation_scenario[i].brkrg_draw_amt * -1) +  
       "," + (simulation_scenario[i].roth_draw_amt * -1) + "," + (simulation_scenario[i].hsa_draw_amt * -1) + "," + (simulation_scenario[i].home_draw_amt * -1) + 
       "," +  simulation_scenario[i].beg_bal + "," +  (simulation_scenario[i].total_draw_amt * -1)  +
       "," + simulation_scenario[i].total_gain_amt + "," +  simulation_scenario[i].total_ann_dep_amt  + "," +  simulation_scenario[i].end_bal  +
       "," +  simulation_scenario[i].infadj_home_equity_amt  +
       "," + simulation_scenario[i].bas_end_bal  + "," +  (Math.round(simulation_scenario[i].stockret * 10000)/100) + "%" + 
       "," + (Math.round(simulation_scenario[i].bondret * 10000)/100) + "%" + "," +  (Math.round(simulation_scenario[i].infrate * 10000)/100) + "%" +
       "," + simulation_scenario[i].you_ira_beg_bal_amt + "," +  (simulation_scenario[i].you_rmd_draw_amt * -1) + "," + (simulation_scenario[i].you_ira_addl_draw_amt * -1) +
       "," + simulation_scenario[i].you_ira_gain_amt + "," +  simulation_scenario[i].you_ira_ann_dep_amt + "," +  simulation_scenario[i].you_ira_end_bal_amt +
       "," + simulation_scenario[i].spo_ira_beg_bal_amt + "," +  (simulation_scenario[i].spo_rmd_draw_amt * -1) + "," +  (simulation_scenario[i].spo_ira_addl_draw_amt * -1) +
       "," + simulation_scenario[i].spo_ira_gain_amt +  "," +  simulation_scenario[i].spo_ira_ann_dep_amt + "," +  simulation_scenario[i].spo_ira_end_bal_amt +
       "," + simulation_scenario[i].brkrg_beg_bal_amt + "," +  (simulation_scenario[i].brkrg_draw_amt * -1) + "," +  simulation_scenario[i].brkrg_gain_amt +
       "," + simulation_scenario[i].brkrg_ann_dep_amt + "," +  simulation_scenario[i].brkrg_end_bal_amt + "," +  simulation_scenario[i].brkrg_beg_cost_basis_amt + 
       "," +  simulation_scenario[i].brkrg_adj_cost_basis_amt + "," +  simulation_scenario[i].brkrg_end_cost_basis_amt + "," +  simulation_scenario[i].roth_beg_bal_amt  + 
       "," +  (simulation_scenario[i].roth_draw_amt * -1)  + "," +  simulation_scenario[i].roth_gain_amt + "," +  simulation_scenario[i].roth_ann_dep_amt +  
       "," +  simulation_scenario[i].roth_end_bal_amt  + "," +  simulation_scenario[i].you_roth_conv_amt + "," +  simulation_scenario[i].spo_roth_conv_amt +
       "," + simulation_scenario[i].hsa_beg_bal_amt  + 
       "," +  (simulation_scenario[i].hsa_draw_amt * -1)  + "," +  simulation_scenario[i].hsa_gain_amt + "," +  simulation_scenario[i].hsa_ann_dep_amt +  
       "," +  simulation_scenario[i].hsa_end_bal_amt  + 
       "," +  simulation_scenario[i].ira_distribution_amt + "," +  simulation_scenario[i].pension_amt + "," +  simulation_scenario[i].socsec_taxable_amt +
       "," +  simulation_scenario[i].socsec_taxable_pct +
       "," +  simulation_scenario[i].brkrg_taxable_dist_amt +
        "," +  simulation_scenario[i].actual_qcd_amt +     
       "," +  simulation_scenario[i].adjusted_gross_amt + "," +  simulation_scenario[i].std_deduct_nbr +
       "," +  simulation_scenario[i].std_deduct_amt + "," +  simulation_scenario[i].senior_deduct_nbr + "," +  simulation_scenario[i].senior_deduct_amt +
       "," +  simulation_scenario[i].curyr_taxable_income + "," +  simulation_scenario[i].curyr_inc_tax_amt + "," +  simulation_scenario[i].taxtablemarried0  +
       "," +  simulation_scenario[i].taxtablemarried1  + "," +  simulation_scenario[i].taxtablemarried2 + "," +  simulation_scenario[i].taxtablemarried3  +
       "," +  simulation_scenario[i].taxtablemarried4  + "," +  simulation_scenario[i].taxtablemarried5  +  "," +  "unlimited"  +
       "," +  simulation_scenario[i].taxtablesingle0  + "," +  simulation_scenario[i].taxtablesingle1  + "," +  simulation_scenario[i].taxtablesingle2  +
       "," +  simulation_scenario[i].taxtablesingle3  + "," +  simulation_scenario[i].taxtablesingle4  + "," +  simulation_scenario[i].taxtablesingle5  +
       "," +  "unlimited"  + "," +  simulation_scenario[i].adjusted_gross_amt  + "," +  simulation_scenario[i].std_deduct_nbr + "," +  simulation_scenario[i].std_deduct_amt +
       "," +  simulation_scenario[i].senior_deduct_nbr + "," +  simulation_scenario[i].senior_deduct_amt + "," +  (simulation_scenario[i].brkrg_draw_amt * -1) +   
       "," +  simulation_scenario[i].brkrg_adj_cost_basis_amt + "," +  simulation_scenario[i].curyr_capgains_amt + "," +  simulation_scenario[i].curyr_capgains_tax_amt + 
       "," +  simulation_scenario[i].captaxtable0_thru  + "," +  simulation_scenario[i].captaxtable1_thru  + "," +  "unlimited"  +
       "," +  simulation_scenario[i].captaxtable3_thru  + "," +  simulation_scenario[i].captaxtable4_thru  + "," +  "unlimited"  +
      " \r\n"; 

   }
        
        
     fileName1 = fFrm_Plan_Id.concat("_");
     fileName = fileName1.concat("RPS_sim_result_dtl");
     
     let csvData = new Blob([csv], { type: 'text/csv' });  
     let csvUrl = URL.createObjectURL(csvData);
 
     let hiddenElement = document.createElement('a');
     hiddenElement.href = csvUrl;
     hiddenElement.target = '_blank';
     hiddenElement.download = fileName + '.csv';
     hiddenElement.click();

     
 }	
</script> 
    
<script type="text/javascript">
 function download_simulation_input_variables (form) {

   csv="fFrm_Plan_Id" +  ","  +  fFrm_Plan_Id      +  "\r\n";
    csv=csv  +  "form.sim_start_yr.value" +  ","  + form.sim_start_yr.value     +  "\r\n";
    csv=csv  +  "form.plan_dsc.value" +  ","  + form.plan_dsc.value     +  "\r\n";

    csv=csv  +  "form.you_birth_yr.value" +  ","  + form.you_birth_yr.value     +  "\r\n";
    csv=csv  +  "form.you_birth_mth.value" +  ","  + form.you_birth_mth.value     +  "\r\n";
    csv=csv  +  "form.you_retire_age.value" +  ","  + form.you_retire_age.value     +  "\r\n";
    csv=csv  +  "form.you_retire_end_age.value" +  ","  + form.you_retire_end_age.value     +  "\r\n";
    csv=csv  +  "form.you_socsec_age.value" +  ","  + form.you_socsec_age.value     +  "\r\n";
    csv=csv  +  "form.you_socsec_amt.value" +  ","  + form.you_socsec_amt.value     +  "\r\n";
    csv=csv  +  "form.you_ira_start_bal_amt.value" +  ","  + form.you_ira_start_bal_amt.value     +  "\r\n";
    csv=csv  +  "form.you_ira_ann_dep_amt.value" +  ","  + form.you_ira_ann_dep_amt.value     +  "\r\n";
    csv=csv  +  "form.you_pension_amt.value" +  ","  + form.you_pension_amt.value     +  "\r\n";
    csv=csv  +  "form.you_pension_begin_age.value" +  ","  + form.you_pension_begin_age.value     +  "\r\n";
    csv=csv  +  "form.you_pension_inf_pct.value" +  ","  + form.you_pension_inf_pct.value     +  "\r\n";
    csv=csv  +  "form.you_pension_survivor_pct.value" +  ","  + form.you_pension_survivor_pct.value     +  "\r\n";

    csv=csv  +  "form.spo_birth_yr.value" +  ","  + form.spo_birth_yr.value     +  "\r\n";
    csv=csv  +  "form.spo_birth_mth.value" +  ","  + form.spo_birth_mth.value     +  "\r\n";
    csv=csv  +  "form.spo_retire_age.value" +  ","  + form.spo_retire_age.value     +  "\r\n";
    csv=csv  +  "form.spo_retire_end_age.value" +  ","  + form.spo_retire_end_age.value     +  "\r\n";
    csv=csv  +  "form.spo_socsec_age.value" +  ","  + form.spo_socsec_age.value     +  "\r\n";
    csv=csv  +  "form.spo_socsec_amt.value" +  ","  + form.spo_socsec_amt.value     +  "\r\n";
    csv=csv  +  "form.spo_ira_start_bal_amt.value" +  ","  + form.spo_ira_start_bal_amt.value     +  "\r\n";
    csv=csv  +  "form.spo_ira_ann_dep_amt.value" +  ","  + form.spo_ira_ann_dep_amt.value     +  "\r\n";
    csv=csv  +  "form.spo_pension_amt.value" +  ","  + form.spo_pension_amt.value     +  "\r\n";
    csv=csv  +  "form.spo_pension_begin_age.value" +  ","  + form.spo_pension_begin_age.value     +  "\r\n";
    csv=csv  +  "form.spo_pension_inf_pct.value" +  ","  + form.spo_pension_inf_pct.value     +  "\r\n";
    csv=csv  +  "form.spo_pension_survivor_pct.value" +  ","  + form.spo_pension_survivor_pct.value     +  "\r\n";

    csv=csv  +  "form.brkrg_start_bal_amt.value" +  ","  + form.brkrg_start_bal_amt.value     +  "\r\n";
    csv=csv  +  "form.brkrg_cost_basis_amt.value" +  ","  + form.brkrg_cost_basis_amt.value     +  "\r\n";
    csv=csv  +  "form.brkrg_ann_dep_amt.value" +  ","  + form.brkrg_ann_dep_amt.value     +  "\r\n";
    csv=csv  +  "form.brkrg_taxable_dist_pct.value" +  ","  + form.brkrg_taxable_dist_pct.value     +  "\r\n";
    csv=csv  +  "form.home_equity_amt.value" +  ","  + form.home_equity_amt.value     +  "\r\n";

    csv=csv  +  "form.roth_start_bal_amt.value" +  ","  + form.roth_start_bal_amt.value     +  "\r\n";
    csv=csv  +  "form.roth_ann_dep_amt.value" +  ","  + form.roth_ann_dep_amt.value     +  "\r\n";
    csv=csv  +  "form.roth_conv_pct.value" +  ","  + form.roth_conv_pct.value     +  "\r\n";
     csv=csv  +  "form.roth_conv_end_age.value" +  ","  + form.roth_conv_end_age.value     +  "\r\n";
    csv=csv  +  "form.roth_draw_begin_age.value" +  ","  + form.roth_draw_begin_age.value     +  "\r\n";
    csv=csv  +  "form.pre_roth_ftb_pct.value" +  ","  + form.pre_roth_ftb_pct.value     +  "\r\n";

    csv=csv  +  "form.hsa_start_bal_amt.value" +  ","  + form.hsa_start_bal_amt.value     +  "\r\n";
    csv=csv  +  "form.hsa_ann_dep_amt.value" +  ","  + form.hsa_ann_dep_amt.value     +  "\r\n";
    csv=csv  +  "form.hsa_flat_draw_amt.value" +  ","  + form.hsa_flat_draw_amt.value     +  "\r\n";
    csv=csv  +  "form.hsa_draw_begin_age.value" +  ","  + form.hsa_draw_begin_age.value     +  "\r\n";
    csv=csv  +  "form.hsa_draw_end_age.value" +  ","  + form.hsa_draw_end_age.value     +  "\r\n";
    csv=csv  +  "form.hsa_use_flag.value" +  ","  + form.hsa_use_flag.value     +  "\r\n";

    csv=csv  +  "form.trans_budget_amt.value" +  ","  + form.trans_budget_amt.value     +  "\r\n";
    csv=csv  +  "form.full_budget_amt.value" +  ","  + form.full_budget_amt.value     +  "\r\n";
    csv=csv  +  "form.lastx_budget_amt.value" +  ","  + form.lastx_budget_amt.value     +  "\r\n";
    csv=csv  +  "form.lastx_years.value" +  ","  + form.lastx_years.value     +  "\r\n";
     
    csv=csv  +  "form.mortgage_budget_amt.value" +  ","  + form.mortgage_budget_amt.value     +  "\r\n";
    csv=csv  +  "form.mortgage_end_age.value" +  ","  + form.mortgage_end_age.value     +  "\r\n";

    csv=csv  +  "form.gogo_reduce_pct.value" +  ","  + form.gogo_reduce_pct.value     +  "\r\n";
    csv=csv  +  "form.nogo_reduce_pct.value" +  ","  + form.nogo_reduce_pct.value     +  "\r\n";
    csv=csv  +  "form.slogo_reduce_pct.value" +  ","  + form.slogo_reduce_pct.value     +  "\r\n";

    csv=csv  +  "form.gogo_stock_pct.value" +  ","  + form.gogo_stock_pct.value     +  "\r\n";
    csv=csv  +  "form.slogo_stock_pct.value" +  ","  + form.slogo_stock_pct.value     +  "\r\n";
    csv=csv  +  "form.nogo_stock_pct.value" +  ","  + form.nogo_stock_pct.value     +  "\r\n";
    csv=csv  +  "form.lastx_stock_pct.value" +  ","  + form.lastx_stock_pct.value     +  "\r\n";

    csv=csv  +  "form.bonus_pct.value" +  ","  + form.bonus_pct.value     +  "\r\n";
    csv=csv  +  "form.baseline_stock_return_pct.value" +  ","  + form.baseline_stock_return_pct.value     +  "\r\n";
    csv=csv  +  "form.baseline_bond_return_pct.value" +  ","  + form.baseline_bond_return_pct.value     +  "\r\n";
    csv=csv  +  "form.baseline_inf_pct.value" +  ","  + form.baseline_inf_pct.value     +  "\r\n";

    csv=csv  +  "form.medb_flag.value" +  ","  + form.medb_flag.value     +  "\r\n";
    csv=csv  +  "form.qcd_pct.value" +  ","  + form.qcd_pct.value     +  "\r\n";
    csv=csv  +  "form.early_death_pct.value" +  ","  + form.early_death_pct.value     +  "\r\n";
    csv=csv  +  "form.rpt_fmt_flag.value" +  ","  + form.rpt_fmt_flag.value     +  "\r\n";


     fileName1 = fFrm_Plan_Id.concat("_");
     fileName = fileName1.concat("RPS_sim_input_var");
     
     let csvData = new Blob([csv], { type: 'text/csv' });  
     let csvUrl = URL.createObjectURL(csvData);
 
     let hiddenElement = document.createElement('a');
     hiddenElement.href = csvUrl;
     hiddenElement.target = '_blank';
     hiddenElement.download = fileName + '.csv';
     hiddenElement.click();


}	
</script> 
         
    
<script type="text/javascript">
 function downloadrates () {

                csv = "col1,, col3,, col5 \r\n";
                csv = csv + "col1,col2,col3,col4,col5"
                fileName = "RPS_scenario_result_summary";   
            let csvData = new Blob([csv], { type: 'text/csv' });  
            let csvUrl = URL.createObjectURL(csvData);
 
            let hiddenElement = document.createElement('a');
            hiddenElement.href = csvUrl;
            hiddenElement.target = '_blank';
            hiddenElement.download = fileName + '.csv';
            hiddenElement.click();
       }
</script>

<script type="text/javascript">
 function setcolor (fInput) {

    fColor='style="color:black;"';   
    if (fInput < 0)
      {fColor = 'style="color:red;"';}
 
    return fColor;
       }
</script>

<script type="text/javascript">
 function setbackgroundcolor (fInput) {

    fBackground_Color=' align = "right" ';   
    if (fInput < 0)
      {fBackground_Color = ' style="background-color:#e6ffee" align = "right" ';}
 
    return fBackground_Color;
       }
</script>
    
<script type="text/javascript">
 function addcomma (fInput) {
	
    fWithComma = fInput.toLocaleString(); 
    return fWithComma;

       }
</script>
          
    
<script type="text/javascript">
 function addsign (fInput) {
	     
    fWithSign = fInput;
    if (fInput > "0") {fWithSign = "+" + fInput} 
    return fWithSign;

       }
</script>

<script>
function getcurrentyear() {
  var d = new Date();
  var n = d.getFullYear();
  return n;
}
</script>


<! ************************************ -- >
<! adjst tax variables by inflation rate -- >
<! ************************************* -- >
<script>
function infadj_tax_variables_func(infrate) {
    
   infadj_std_deduct_married = Math.round(infadj_std_deduct_married * (1+infrate));
   infadj_std_deduct_single  = Math.round(infadj_std_deduct_single * (1+infrate));
   infadj_senior_deduct_amt  = Math.round(infadj_senior_deduct_amt * (1+infrate));

   infadj_from = 0;
   for (ri=0; ri < TaxTableMarriedLen; ri++)
    {infadj_taxtable_married[ri].from = infadj_from; 
     infadj_taxtable_married[ri].thru = Math.round(infadj_taxtable_married[ri].thru*(1+infrate));
     infadj_from = infadj_taxtable_married[ri].thru + 1;    
    }

  infadj_from = 0;
  for (ri=0; ri < TaxTableSingleLen; ri++)
    {infadj_taxtable_single[ri].from = infadj_from;
     infadj_taxtable_single[ri].thru = Math.round(infadj_taxtable_single[ri].thru*(1+infrate));
     infadj_from = infadj_taxtable_single[ri].thru + 1;
    }

  lFile_Status = "single";
  infadj_from = 0;
  for (ri=0; ri < capgains_taxtable_len; ri++)
    {if (capgains_taxtable[ri].file_status == lFile_Status)
        {infadj_capgains_taxtable[ri].from = infadj_from;
         infadj_capgains_taxtable[ri].thru = Math.round(infadj_capgains_taxtable[ri].thru*(1+infrate));
         infadj_from = infadj_capgains_taxtable[ri].thru + 1;
        }
    }

  lFile_Status = "married";
  infadj_from = 0;
  for (ri=0; ri < capgains_taxtable_len; ri++)
    {if (capgains_taxtable[ri].file_status == lFile_Status)
        {infadj_capgains_taxtable[ri].from = infadj_from;
         infadj_capgains_taxtable[ri].thru = Math.round(infadj_capgains_taxtable[ri].thru*(1+infrate));
         infadj_from = infadj_capgains_taxtable[ri].thru + 1;
        }
    } 
    
  lFile_Status = "single";
  infadj_from = 0;
  for (ri=0; ri < medb_premium_table_len; ri++)
    {if (medb_premium_table[ri].file_status == lFile_Status)
        {infadj_medb_premium_table[ri].adj_gross_from = infadj_from;
         infadj_medb_premium_table[ri].adj_gross_thru = Math.round(infadj_medb_premium_table[ri].adj_gross_thru*(1+infrate));
         infadj_medb_premium_table[ri].mthly_rate = Math.round(infadj_medb_premium_table[ri].mthly_rate*(1+infrate));
         infadj_from = infadj_medb_premium_table[ri].adj_gross_thru + 1;
        }
    } 
  
  lFile_Status = "married";
  infadj_from = 0;
  for (ri=0; ri < medb_premium_table_len; ri++)
    {if (medb_premium_table[ri].file_status == lFile_Status)
        {infadj_medb_premium_table[ri].adj_gross_from = infadj_from;
         infadj_medb_premium_table[ri].adj_gross_thru = Math.round(infadj_medb_premium_table[ri].adj_gross_thru*(1+infrate));
         infadj_medb_premium_table[ri].mthly_rate = Math.round(infadj_medb_premium_table[ri].mthly_rate*(1+infrate));
         infadj_from = infadj_medb_premium_table[ri].adj_gross_thru + 1;
        }
    } 
  return; 
}
</script>


<script>
function calc_rmd_age(fCurrent_Year, fCurrent_Age) {
//******************************************************** 
// calculate rmd age 
// If turn age 70 in 2019 or earlier, must start taking RMD at age 70.
// Otherwise, must start taking RMD age 72
//********************************************************          
          
    fYear_Born = fCurrent_Year - fCurrent_Age;
    fRMD_Age = 75;
    
    if (fYear_Born <= 1949) {fRMD_Age = 70};
    if (fYear_Born >= 1950 && fYear_Born <= 1950) {fRMD_Age = 72};
    if (fYear_Born >= 1951 && fYear_Born <= 1959) {fRMD_Age = 73};

    return fRMD_Age;
}
</script>
    

<script>
function calc_rmd(fAge, fIRA_Bal_Amt, fRMD_Age) {
//******************************************************** 
// calculate rmd function 
//********************************************************
    
  fRMD_Amt = 0;
         
  if(fAge < fRMD_Age) {return fRMD_Amt};
    
  if(fAge > 114) {return fRMD_Amt};

  if (fIRA_Bal_Amt <= 0) {return fRMD_Amt};

  var ri = fAge - 72;

  var fFactor = rmdtable[ri].factor * 1;
  
  fRMD_Amt = Math.round(fIRA_Bal_Amt / fFactor);
 
  return fRMD_Amt;

}
</script>
 

<! ********************** -- >
<! calculate social security taxable -- >
<! ********************** -- >
<script>
function calc_socsec_taxable_func(fAdjusted_Gross_Amt, fSocSec_Amt, fExemptions) {

   var line1_amt = fSocSec_Amt; 
   var line2_amt = Math.round(line1_amt * .50);
   var line3_amt = fAdjusted_Gross_Amt;
   var line4_amt = 0;
   var line5_amt = line2_amt + line3_amt + line4_amt;
   var line6_amt = 0;
   var line7_amt = line5_amt - line6_amt;
   var line8_amt = 25000;
   if (fExemptions==2) {line8_amt=32000};
   var line9_amt = line7_amt - line8_amt;
   if (line9_amt < 0) {line9_amt = 0};
   var line10_amt = 9000;
   if (fExemptions==2) {line10_amt = 12000};
   var line11_amt = line9_amt - line10_amt;
   if (line11_amt < 0) {line11_amt = 0};
   var line12_amt = Math.min(line9_amt, line10_amt);
   var line13_amt = Math.round(line12_amt * .50);
   var line14_amt = Math.min(line2_amt, line13_amt);
   var line15_amt = Math.round(line11_amt * .85);
   var line16_amt = line14_amt + line15_amt;
   var line17_amt = Math.round(line1_amt * .85);
   var line18_amt = Math.min(line16_amt, line17_amt);

   var fSocSec_Taxable_Amt = line18_amt;
   
   return fSocSec_Taxable_Amt;

}
</script>   



<script>
function calc_income_tax(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fSpo_Age) {
//****************************************************************
//* calculate income tax function
//****************************************************************
   
   var fThru=0;
   var fTax_Amt=0;
   var fSenior_Deduct_Nbr = 0;
   var fUsed_Std_Deduct_Amt = 0;
   var fTaxable_Income_Pre = 0;
   var fTaxable_Income = 0;    

   if (fYou_Age >= 65) {fSenior_Deduct_Nbr++;}
   if (fSpo_Age >=65) {fSenior_Deduct_Nbr++};
    
   if (fLast_Alive == "you" && fYou_Age >= fLastx_Start_Age) {fAdjusted_Gross_Amt = 0;}
   if (fLast_Alive == "spouse" && fSpo_Age >= fLastx_Start_Age) {fAdjusted_Gross_Amt = 0;}    
   
   fSenior_Deduct_Nbr = Math.min(fSenior_Deduct_Nbr, fExemptions);
  
   fSenior_Deduct_Amt = infadj_senior_deduct_amt * fSenior_Deduct_Nbr;

   if (fExemptions == 1)
     {
       fUsed_Std_Deduct_Amt = infadj_std_deduct_single;
       fTaxable_Income_Pre = fAdjusted_Gross_Amt - infadj_std_deduct_single - infadj_senior_deduct_amt;
       fTaxable_Income = Math.max(0,fTaxable_Income_Pre);
       for (ri=0; ri < TaxTableSingleLen; ri++)
        {fThru = Math.min(fTaxable_Income, infadj_taxtable_single[ri].thru);
         fTax_Amt = fTax_Amt + Math.round((fThru - infadj_taxtable_single[ri].from) * taxtablesingle[ri].pct);
         if (fThru == fTaxable_Income) 
              {   fTax_Top_Pct = taxtablesingle[ri].pct;
                  fTax_Top_Amt = taxtablesingle[ri].thru;
                  break;
              }
        } 
    }

   if (fExemptions != 1)
     {
       fUsed_Std_Deduct_Amt = infadj_std_deduct_married;
       fTaxable_Income_Pre = fAdjusted_Gross_Amt - infadj_std_deduct_married - fSenior_Deduct_Amt;
       fTaxable_Income = Math.max(0,fTaxable_Income_Pre);
       if (fTaxable_Income < 0) {fTaxable_Income = 0};
       for (ri=0; ri < TaxTableMarriedLen; ri++)
        {fThru = Math.min(fTaxable_Income, infadj_taxtable_married[ri].thru);
         fTax_Amt = fTax_Amt + Math.round((fThru - infadj_taxtable_married[ri].from) * taxtablemarried[ri].pct);
         if (fThru == fTaxable_Income)
         {
            fTax_Top_Pct = taxtablemarried[ri].pct;
            fTax_Top_Amt = taxtablemarried[ri].thru;
            break;
         }
        } 
    }

    oTax_Results = {taxable_income    : fTaxable_Income,
                    taxable_income_pre : fTaxable_Income_Pre,
                    inc_tax_amt       : fTax_Amt,
                    senior_deduct_nbr : fSenior_Deduct_Nbr,
                    senior_deduct_amt : fSenior_Deduct_Amt,
                    std_deduct_amt    : fUsed_Std_Deduct_Amt,
                    top_pct           : fTax_Top_Pct,
                    top_amt           : fTax_Top_Amt};
  
    return oTax_Results  
  
}
</script>

<script>
function calc_capgains_tax(fAdjusted_Gross_Amt, fDeductions_Amt, fCapgains_Amt, fExemptions) {
//****************************************************************
//* calculate capital gains tax
//****************************************************************
   
   var fThru=0;
   var fTax_Amt=0;
  
   fFile_Status = "married";
   if (fExemptions == 1) {lFile_Status = "single";}

   if (fLast_Alive == "you" && fYou_Age >= fLastx_Start_Age) {fAdjusted_Gross_Amt = 0;}
   if (fLast_Alive == "spouse" && fSpo_Age >= fLastx_Start_Age) {fAdjusted_Gross_Amt = 0;}    
       
   fTaxable_Income_With_CapGains = fAdjusted_Gross_Amt -fDeductions_Amt + fCapgains_Amt;       
   
   fTaxable_Income_No_CapGains = fAdjusted_Gross_Amt -fDeductions_Amt;       
  
   if (fTaxable_Income_With_CapGains < 0)  {fTaxable_Income_With_CapGains = 0;}

   if (fTaxable_Income_No_CapGains < 0)  {fTaxable_Income_No_Capgains = 0;}    
    
   var fBracket_Nbr = 1;
   var fRemaining_To_Tax = 0;
   var fElig_To_Tax_Accum = 0;
   var fTax_Amt_Accum = 0;
   
   for (ri=0; ri < capgains_taxtable_len; ri++)
        {
         if (fFile_Status == capgains_taxtable[ri].file_status) 
            {
            fThis_Bracket_Amt = infadj_capgains_taxtable[ri].thru - infadj_capgains_taxtable[ri].from;
            
            fElig_To_Tax = Math.min(fThis_Bracket_Amt,fRemaining_To_Tax);
            if (fBracket_Nbr == 1) {fElig_To_Tax = Math.min(fTaxable_Income_With_CapGains, infadj_capgains_taxtable[ri].thru)};
            
            fAmt_Over_Inc = 0;
            if (fBracket_Nbr == 1) {fAmt_Over_Inc = fElig_To_Tax - fTaxable_Income_No_CapGains};
            
            fAmt_To_Tax = fElig_To_Tax;
            if (fBracket_Nbr == 1) {fAmt_To_Tax = Math.min(infadj_capgains_taxtable[ri].thru, fAmt_Over_Inc)};
            
            fTax_Amt_This_Bracket = Math.round(fAmt_To_Tax * capgains_taxtable[ri].pct);
            
            fTax_Amt_Accum += fTax_Amt_This_Bracket;
            
            fElig_To_Tax_Accum += fElig_To_Tax;
            
            fRemaining_To_Tax = Math.max(0,(fTaxable_Income_With_CapGains - fElig_To_Tax_Accum));
            
            fBracket_Nbr++;
            
           }
        } 

    oCapgains_Tax_Results = {total_income    : fTaxable_Income_With_CapGains,
                             tax_amt         : fTax_Amt_Accum};

    return oCapgains_Tax_Results;  
  
}
</script>

<script>
function calc_ftb_amt (fExemptions, fFrm_Pre_Roth_FTB_Pct, fYou_RMD_Draw_Amt, fSpo_RMD_Draw_Amt, fPension_Amt, fYou_Age, fSpo_Age, fSocSec_Total_Amt,fPotential_QCD_Amt) {

//****************************************************************
//* calculate fill the bucket amount 
//****************************************************************

          fFTB_Taxable_Income = 0;
          
          if (fExemptions ==2)
             {      
              if (fFrm_Pre_Roth_FTB_Pct == 10) fFTB_Taxable_Income = infadj_taxtable_married[0].thru;   
              if (fFrm_Pre_Roth_FTB_Pct == 12) fFTB_Taxable_Income = infadj_taxtable_married[1].thru;
              if (fFrm_Pre_Roth_FTB_Pct == 22) fFTB_Taxable_Income = infadj_taxtable_married[2].thru;
              if (fFrm_Pre_Roth_FTB_Pct == 24) fFTB_Taxable_Income = infadj_taxtable_married[3].thru;       
             }
        
           if (fExemptions ==1)
             {      
              if (fFrm_Pre_Roth_FTB_Pct == 10) fFTB_Taxable_Income = infadj_taxtable_single[0].thru;   
              if (fFrm_Pre_Roth_FTB_Pct == 12) fFTB_Taxable_Income = infadj_taxtable_single[1].thru;
              if (fFrm_Pre_Roth_FTB_Pct == 22) fFTB_Taxable_Income = infadj_taxtable_single[2].thru;       
              if (fFrm_Pre_Roth_FTB_Pct == 24) fFTB_Taxable_Income = infadj_taxtable_single[3].thru;              
             }
        
          fIRA_Distribution_Amt = fYou_RMD_Draw_Amt + fSpo_RMD_Draw_Amt;
    
          fIncome_Less_SS = fIRA_Distribution_Amt + fPension_Amt - fPotential_QCD_Amt;

          fSocSec_Taxable_Amt = calc_socsec_taxable_func(fIncome_Less_SS, fSocSec_Total_Amt, fExemptions);                 
          
          fAdjusted_Gross_Amt = fIncome_Less_SS + fSocSec_Taxable_Amt;

          oTax_Results =          calc_income_tax(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fSpo_Age);
          
          fFTB_Amt = Math.max(fFTB_Taxable_Income - oTax_Results.taxable_income_pre,0);

//****************************************************************
//* loop reduce FTB_Amt until get to the right tax bracket 
//****************************************************************
    
          fIRA_Distribution_Amt += fFTB_Amt;

          do {
              fIncome_Less_SS = fIRA_Distribution_Amt + fPension_Amt;

              fSocSec_Taxable_Amt = calc_socsec_taxable_func(fIncome_Less_SS, fSocSec_Total_Amt, fExemptions);                 
          
              fAdjusted_Gross_Amt = fIncome_Less_SS + fSocSec_Taxable_Amt;

              oTax_Results =          calc_income_tax(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fSpo_Age);
    
              if (oTax_Results.taxable_income_pre >= fFTB_Taxable_Income)
                 {fFTB_Amt -= 1000;
                  fIRA_Distribution_Amt -= 1000;
                 }
            } while (fFTB_Amt > 0 && oTax_Results.taxable_income_pre >= fFTB_Taxable_Income);
    
            fFTB_Amt = Math.max(fFTB_Amt,0);
            return fFTB_Amt;
}
    
</script>
        
<script>
function calc_gain(fEnd_Bal_Amt, fStock_Alloc_Pct, fStock_Ret_Pct, fBond_Ret_Pct)
//****************************************************************
//* calculate stock and bond returns
//****************************************************************
    
    { 

          fStock_Alloc_Amt = Math.round(fEnd_Bal_Amt * fStock_Alloc_Pct);
          fBond_Alloc_Amt = fEnd_Bal_Amt - fStock_Alloc_Amt;
          fStock_Gain_Amt = Math.round(fStock_Alloc_Amt * fStock_Ret_Pct);
          fBond_Gain_Amt  = Math.round(fBond_Alloc_Amt * fBond_Ret_Pct);
          fTotal_Gain_Amt = fStock_Gain_Amt + fBond_Gain_Amt;
          return fTotal_Gain_Amt;
    }
</script>

<script>
function calc_medb_premium (fAdjusted_Gross_Amt, fExemptions, fYou_Age, fYou_Retire_End_Age, fSpo_Age, fSpo_Retire_End_Age, fFrm_Spo_Current_Age) {
//****************************************************************
//* calculate medicare b premium
//****************************************************************
   
   var fMedb_Premium_Amt=0;
  
   fFile_Status = "married";
   if (fExemptions == 1) {lFile_Status = "single";}

   fMedb_Factor = 0;    
   if (fYou_Age >= 65 && fYou_Age <= fYou_Retire_End_Age) {fMedb_Factor++;}
   if (fFrm_Spo_Current_Age > 0 && fSpo_Age >= 65 && fSpo_Age <= fSpo_Retire_End_Age) {fMedb_Factor++;}
    
   for (ri=0; ri < medb_premium_table_len; ri++)
        {if (fFile_Status == medb_premium_table[ri].file_status) 
         
           {if (infadj_medb_premium_table[ri].adj_gross_from <= fAdjusted_Gross_Amt)
             {if (infadj_medb_premium_table[ri].adj_gross_thru >= fAdjusted_Gross_Amt) 
                {fMedb_Premium_Amt = Math.round(infadj_medb_premium_table[ri].mthly_rate * 12); 
                 break;
                }
             }
          } 
        }
    
    fMedb_Premium_Amt = Math.round(fMedb_Premium_Amt * fMedb_Factor
                                  );
    return fMedb_Premium_Amt;  
  
}
</script>

<script>
function get_baseline (fFroz_Bas_Index) 
{
//****************************************************************
//* get baseline end balance
//****************************************************************
    fFrozBas_Amt = 999999999; 
    
    if (fFroz_Bas_Index >= 0) 
       {
        if(fFroz_Bas_Index <= frozbas_end_bal_len)
            {fFrozBas_Amt = frozbas_end_bal[fFroz_Bas_Index];}
       };
    
    return fFrozBas_Amt;
}
        
</script>

<! ********************************* -- >
<! define constants tables -- >
<! ********************************* -- >
<script type="text/javascript">

//********************
//* constants
//********************

var myWindow;

var stddeductmarried = 30000;
var stddeductsingle = 22500;

var senior_deduct_amt = 1600;

var taxtablemarried = new Array( );
taxtablemarried[0] = {pct:.10, from:0, thru:23850};
taxtablemarried[1] = {pct:.12, from:23851,  thru:96950};
taxtablemarried[2] = {pct:.22, from:96951,  thru:206700};
taxtablemarried[3] = {pct:.24, from:206701, thru:394600};
taxtablemarried[4] = {pct:.32, from:394601, thru:501050};
taxtablemarried[5] = {pct:.35, from:501051, thru:751600};
taxtablemarried[6] = {pct:.37, from:751601, thru:9999999999};
var TaxTableMarriedLen = taxtablemarried.length;

var taxtablesingle = new Array( );
taxtablesingle[0] = {pct:.10, from:0, thru:11925};
taxtablesingle[1] = {pct:.12, from:11926, thru:48475};
taxtablesingle[2] = {pct:.22, from:48476, thru:103350};
taxtablesingle[3] = {pct:.24, from:103351, thru:197300};
taxtablesingle[4] = {pct:.32, from:197301, thru:250525};
taxtablesingle[5] = {pct:.35, from:250526, thru:626350};
taxtablesingle[6] = {pct:.37, from:626351, thru:9999999999};
var TaxTableSingleLen = taxtablesingle.length;

var infadj_taxtable_married = new Array();
var infadj_taxtable_single = new Array();

var capgains_taxtable = new Array( );
capgains_taxtable[0] = {file_status: "married", pct:.0,  from:0, thru: 96700};
capgains_taxtable[1] = {file_status: "married", pct:.15, from:96701, thru: 600050};
capgains_taxtable[2] = {file_status: "married", pct:.20, from:600051, thru: 999999999};
capgains_taxtable[3] = {file_status: "single", pct:.0, from:0, thru: 48350};
capgains_taxtable[4] = {file_status: "single", pct:.15, from:48351, thru: 533400};
capgains_taxtable[5] = {file_status: "single", pct:.20, from:533401, thru: 999999999};
var infadj_capgains_taxtable = new Array();
var capgains_taxtable_len = capgains_taxtable.length;

var medb_premium_table = new Array( );
medb_premium_table[0] = {file_status: "married", adj_gross_from:0,      adj_gross_thru:212000,    mthly_rate:185.00};
medb_premium_table[1] = {file_status: "married", adj_gross_from:212001, adj_gross_thru:266000,    mthly_rate:259.00};
medb_premium_table[2] = {file_status: "married", adj_gross_from:266001, adj_gross_thru:334000,    mthly_rate:370.00};
medb_premium_table[3] = {file_status: "married", adj_gross_from:334001, adj_gross_thru:400000,    mthly_rate:480.90};
medb_premium_table[4] = {file_status: "married", adj_gross_from:400001, adj_gross_thru:750000,    mthly_rate:591.90};
medb_premium_table[5] = {file_status: "married", adj_gross_from:750001, adj_gross_thru:999999999, mthly_rate:628.90};
medb_premium_table[6] =  {file_status: "single", adj_gross_from:0,      adj_gross_thru:106000,    mthly_rate:185.00};
medb_premium_table[7] =  {file_status: "single", adj_gross_from:106001, adj_gross_thru:133000,    mthly_rate:259.00};
medb_premium_table[8] =  {file_status: "single", adj_gross_from:133001, adj_gross_thru:167000,    mthly_rate:370.00};
medb_premium_table[9] =  {file_status: "single", adj_gross_from:167001, adj_gross_thru:200000,    mthly_rate:480.90};
medb_premium_table[10] = {file_status: "single", adj_gross_from:200001, adj_gross_thru:500000,    mthly_rate:591.90};
medb_premium_table[11] = {file_status: "single", adj_gross_from:500001, adj_gross_thru:999999999, mthly_rate:628.90};
var infadj_medb_premium_table = new Array();
var medb_premium_table_len = medb_premium_table.length;
    
var rmdtable = new Array( );
rmdtable[0]={age:72,factor:27.4};
rmdtable[1]={age:73,factor:27.4};
rmdtable[2]={age:74,factor:26.5};
rmdtable[3]={age:75,factor:25.6};
rmdtable[4]={age:76,factor:24.7};
rmdtable[5]={age:77,factor:23.8};
rmdtable[6]={age:78,factor:22.9};
rmdtable[7]={age:79,factor:22};
rmdtable[8]={age:80,factor:21.2};
rmdtable[9]={age:81,factor:20.3};
rmdtable[10]={age:82,factor:19.5};
rmdtable[11]={age:83,factor:18.7};
rmdtable[12]={age:84,factor:17.9};
rmdtable[13]={age:85,factor:17.1};
rmdtable[14]={age:86,factor:16.3};
rmdtable[15]={age:87,factor:15.5};
rmdtable[16]={age:88,factor:14.8};
rmdtable[17]={age:89,factor:14.1};
rmdtable[18]={age:90,factor:13.4};
rmdtable[19]={age:91,factor:12.7};
rmdtable[20]={age:92,factor:12};
rmdtable[21]={age:93,factor:11.4};
rmdtable[22]={age:94,factor:10.8};
rmdtable[23]={age:95,factor:10.2};
rmdtable[24]={age:96,factor:9.6};
rmdtable[25]={age:97,factor:9.1};
rmdtable[26]={age:98,factor:8.6};1
rmdtable[27]={age:99,factor:8.1};
rmdtable[28]={age:100,factor:7.6};
rmdtable[29]={age:101,factor:7.1};
rmdtable[30]={age:102,factor:6.7};
rmdtable[31]={age:103,factor:6.3};
rmdtable[32]={age:104,factor:5.9};
rmdtable[33]={age:105,factor:5.5};
rmdtable[34]={age:106,factor:5.2};
rmdtable[35]={age:107,factor:4.9};
rmdtable[36]={age:108,factor:4.5};
rmdtable[37]={age:109,factor:4.2};
rmdtable[38]={age:110,factor:3.9};
rmdtable[39]={age:111,factor:3.7};
rmdtable[40]={age:112,factor:3.4};
rmdtable[41]={age:113,factor:3.1};
rmdtable[42]={age:114,factor:2.9};
rmdtable[43]={age:115,factor:2.6};
rmdtable[44]={age:116,factor:2.4};
rmdtable[45]={age:117,factor:2.1};

var vpwtable = new Array( );    
vpwtable[0]={age:40, factor:0.036};
vpwtable[1]={age:41, factor:0.036};
vpwtable[2]={age:42, factor:0.037};
vpwtable[3]={age:43, factor:0.037};
vpwtable[4]={age:44, factor:0.037};
vpwtable[5]={age:45, factor:0.037};
vpwtable[6]={age:46, factor:0.038};
vpwtable[7]={age:47, factor:0.038};
vpwtable[8]={age:48, factor:0.038};
vpwtable[9]={age:49, factor:0.038};
vpwtable[10]={age:50, factor:0.039};
vpwtable[11]={age:51, factor:0.039};
vpwtable[12]={age:52, factor:0.039};
vpwtable[13]={age:53, factor:0.04};
vpwtable[14]={age:54, factor:0.04};
vpwtable[15]={age:55, factor:0.041};
vpwtable[16]={age:56, factor:0.041};
vpwtable[17]={age:57, factor:0.041};
vpwtable[18]={age:58, factor:0.042};
vpwtable[19]={age:59, factor:0.042};
vpwtable[20]={age:60, factor:0.043};
vpwtable[21]={age:61, factor:0.043};
vpwtable[22]={age:62, factor:0.044};
vpwtable[23]={age:63, factor:0.045};
vpwtable[24]={age:64, factor:0.045};
vpwtable[25]={age:65, factor:0.046};
vpwtable[26]={age:66, factor:0.047};
vpwtable[27]={age:67, factor:0.048};
vpwtable[28]={age:68, factor:0.048};
vpwtable[29]={age:69, factor:0.049};
vpwtable[30]={age:70, factor:0.05};
vpwtable[31]={age:71, factor:0.051};
vpwtable[32]={age:72, factor:0.053};
vpwtable[33]={age:73, factor:0.054};
vpwtable[34]={age:74, factor:0.055};
vpwtable[35]={age:75, factor:0.057};
vpwtable[36]={age:76, factor:0.058};
vpwtable[37]={age:77, factor:0.06};
vpwtable[38]={age:78, factor:0.062};
vpwtable[39]={age:79, factor:0.064};
vpwtable[40]={age:80, factor:0.066};
vpwtable[41]={age:81, factor:0.069};
vpwtable[42]={age:82, factor:0.071};
vpwtable[43]={age:83, factor:0.074};
vpwtable[44]={age:84, factor:0.078};
vpwtable[45]={age:85, factor:0.082};
vpwtable[46]={age:86, factor:0.087};
vpwtable[47]={age:87, factor:0.092};
vpwtable[48]={age:88, factor:0.098};
vpwtable[49]={age:89, factor:0.106};
vpwtable[50]={age:90, factor:0.114};
vpwtable[51]={age:91, factor:0.125};
vpwtable[52]={age:92, factor:0.139};
vpwtable[53]={age:93, factor:0.156};
vpwtable[54]={age:94, factor:0.18};
vpwtable[55]={age:95, factor:0.213};
vpwtable[56]={age:96, factor:0.262};
vpwtable[57]={age:97, factor:0.344};
vpwtable[58]={age:98, factor:0.508};
vpwtable[59]={age:99, factor:1};

var ratehistory = new Array( );
ratehistory[0]={year:1,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[1]={year:2,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[2]={year:3,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[3]={year:4,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[4]={year:5,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[5]={year:6,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[6]={year:7,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[7]={year:8,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[8]={year:9,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[9]={year:10,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[10]={year:11,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[11]={year:12,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[12]={year:13,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[13]={year:14,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[14]={year:15,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[15]={year:16,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[16]={year:17,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[17]={year:18,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[18]={year:19,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[19]={year:20,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[20]={year:21,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[21]={year:22,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[22]={year:23,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[23]={year:24,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[24]={year:25,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[25]={year:26,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[26]={year:27,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[27]={year:28,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[28]={year:29,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[29]={year:30,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[30]={year:31,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[31]={year:32,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[32]={year:33,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[33]={year:34,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[34]={year:35,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[35]={year:36,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[36]={year:37,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[37]={year:38,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[38]={year:39,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[39]={year:40,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[40]={year:41,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[41]={year:42,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[42]={year:43,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[43]={year:44,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[44]={year:45,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[45]={year:46,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[46]={year:47,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[47]={year:48,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[48]={year:49,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[49]={year:50,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[50]={year:51,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[51]={year:52,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[52]={year:53,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[53]={year:54,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[54]={year:55,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[55]={year:56,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[56]={year:57,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[57]={year:58,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[58]={year:59,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[59]={year:60,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[60]={year:61,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[61]={year:62,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[62]={year:63,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[63]={year:64,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[64]={year:65,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[65]={year:66,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[66]={year:67,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[67]={year:68,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[68]={year:69,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[69]={year:70,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[70]={year:71,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[71]={year:72,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[72]={year:73,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[73]={year:74,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[74]={year:75,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[75]={year:76,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[76]={year:77,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[77]={year:78,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[78]={year:79,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[79]={year:80,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[80]={year:81,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[81]={year:82,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[82]={year:83,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[83]={year:84,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[84]={year:85,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[85]={year:86,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[86]={year:87,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[87]={year:88,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[88]={year:89,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[89]={year:90,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[90]={year:91,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[91]={year:92,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[92]={year:93,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[93]={year:94,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[94]={year:95,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[95]={year:96,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[96]={year:97,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[97]={year:98,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[98]={year:99,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[99]={year:100,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[100]={year:101,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[101]={year:102,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[102]={year:103,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[103]={year:104,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[104]={year:105,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[105]={year:106,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[106]={year:107,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[107]={year:108,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[108]={year:109,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[109]={year:110,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[110]={year:111,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[111]={year:112,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[112]={year:113,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[113]={year:114,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[114]={year:115,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[115]={year:116,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[116]={year:117,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[117]={year:118,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[118]={year:119,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[119]={year:120,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[120]={year:121,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[121]={year:122,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[122]={year:123,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[123]={year:124,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[124]={year:125,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[125]={year:126,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[126]={year:127,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[127]={year:128,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[128]={year:129,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[129]={year:130,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[130]={year:131,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[131]={year:132,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[132]={year:133,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[133]={year:134,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[134]={year:135,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[135]={year:136,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[136]={year:137,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[137]={year:138,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[138]={year:139,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[139]={year:140,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[140]={year:141,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[141]={year:142,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[142]={year:143,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[143]={year:144,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[144]={year:145,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[145]={year:146,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[146]={year:147,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[147]={year:148,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[148]={year:149,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[149]={year:150,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[150]={year:151,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[151]={year:152,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[152]={year:153,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[153]={year:154,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[154]={year:155,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[155]={year:156,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[156]={year:157,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[157]={year:158,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[158]={year:159,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[159]={year:160,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[160]={year:161,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[161]={year:162,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[162]={year:163,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[163]={year:164,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[164]={year:165,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[165]={year:166,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[166]={year:167,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[167]={year:168,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[168]={year:169,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[169]={year:170,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[170]={year:171,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[171]={year:172,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[172]={year:173,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[173]={year:174,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[174]={year:175,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[175]={year:176,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[176]={year:177,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[177]={year:178,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[178]={year:179,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[179]={year:180,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[180]={year:181,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[181]={year:182,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[182]={year:183,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[183]={year:184,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[184]={year:185,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[185]={year:186,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[186]={year:187,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[187]={year:188,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[188]={year:189,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[189]={year:190,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[190]={year:191,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[191]={year:192,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[192]={year:193,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[193]={year:194,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[194]={year:195,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[195]={year:196,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[196]={year:197,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[197]={year:198,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[198]={year:199,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[199]={year:200,stockret:0.08,bondret:0.04,stret:0.02,infrate:0.0225};
ratehistory[200]={year:1871,stockret:0.1531,bondret:0.0504,stret:0.001,infrate:0.0152};
ratehistory[201]={year:1872,stockret:0.1049,bondret:0.0384,stret:0.001,infrate:0.023};
ratehistory[202]={year:1873,stockret:-0.0294,bondret:0.0635,stret:0.001,infrate:-0.044};
ratehistory[203]={year:1874,stockret:0.0451,bondret:0.083,stret:0.001,infrate:-0.0695};
ratehistory[204]={year:1875,stockret:0.0551,bondret:0.0854,stret:0.001,infrate:-0.0574};
ratehistory[205]={year:1876,stockret:-0.1368,bondret:0.0561,stret:0.001,infrate:0.0083};
ratehistory[206]={year:1877,stockret:-0.0028,bondret:0.0526,stret:0.001,infrate:-0.1563};
ratehistory[207]={year:1878,stockret:0.16,bondret:0.0522,stret:0.001,infrate:-0.103};
ratehistory[208]={year:1879,stockret:0.4776,bondret:0.0571,stret:0.001,infrate:0.2066};
ratehistory[209]={year:1880,stockret:0.2505,bondret:0.0643,stret:0.001,infrate:-0.0571};
ratehistory[210]={year:1881,stockret:-0.0016,bondret:0.0431,stret:0.001,infrate:0.0807};
ratehistory[211]={year:1882,stockret:0.0355,bondret:0.0354,stret:0.001,infrate:-0.0186};
ratehistory[212]={year:1883,stockret:-0.0534,bondret:0.0371,stret:0.001,infrate:-0.0761};
ratehistory[213]={year:1884,stockret:-0.1178,bondret:0.0438,stret:0.001,infrate:-0.103};
ratehistory[214]={year:1885,stockret:0.2972,bondret:0.0467,stret:0.001,infrate:-0.0349};
ratehistory[215]={year:1886,stockret:0.1192,bondret:0.0223,stret:0.001,infrate:0};
ratehistory[216]={year:1887,stockret:-0.009,bondret:0.0239,stret:0.001,infrate:0.0474};
ratehistory[217]={year:1888,stockret:0.0339,bondret:0.0535,stret:0.001,infrate:-0.0453};
ratehistory[218]={year:1889,stockret:0.0706,bondret:0.0368,stret:0.001,infrate:-0.0476};
ratehistory[219]={year:1890,stockret:-0.0595,bondret:0.0191,stret:0.001,infrate:0.0249};
ratehistory[220]={year:1891,stockret:0.1839,bondret:0.0377,stret:0.001,infrate:-0.0602};
ratehistory[221]={year:1892,stockret:0.0581,bondret:0.0247,stret:0.001,infrate:0.0777};
ratehistory[222]={year:1893,stockret:-0.1872,bondret:0.0413,stret:0.001,infrate:-0.1328};
ratehistory[223]={year:1894,stockret:0.0417,bondret:0.0553,stret:0.001,infrate:-0.0409};
ratehistory[224]={year:1895,stockret:0.0541,bondret:0.024,stret:0.001,infrate:0.0137};
ratehistory[225]={year:1896,stockret:0.0328,bondret:0.0513,stret:0.001,infrate:-0.0284};
ratehistory[226]={year:1897,stockret:0.1991,bondret:0.0378,stret:0.001,infrate:0.0293};
ratehistory[227]={year:1898,stockret:0.2828,bondret:0.0529,stret:0.001,infrate:0.015};
ratehistory[228]={year:1899,stockret:0.0362,bondret:0.0271,stret:0.001,infrate:0.1687};
ratehistory[229]={year:1900,stockret:0.1951,bondret:0.0354,stret:0.001,infrate:-0.024};
ratehistory[230]={year:1901,stockret:0.1909,bondret:0.0248,stret:0.001,infrate:0.0247};
ratehistory[231]={year:1902,stockret:0.0813,bondret:0.0226,stret:0.001,infrate:0.0963};
ratehistory[232]={year:1903,stockret:-0.1714,bondret:0.0254,stret:0.001,infrate:-0.0439};
ratehistory[233]={year:1904,stockret:0.3144,bondret:0.0279,stret:0.001,infrate:0.0229};
ratehistory[234]={year:1905,stockret:0.2076,bondret:0.0386,stret:0.001,infrate:0};
ratehistory[235]={year:1906,stockret:0.003,bondret:0.0162,stret:0.001,infrate:0.0448};
ratehistory[236]={year:1907,stockret:-0.2416,bondret:0.0217,stret:0.001,infrate:-0.0214};
ratehistory[237]={year:1908,stockret:0.3869,bondret:0.047,stret:0.001,infrate:0.0323};
ratehistory[238]={year:1909,stockret:0.1567,bondret:0.0264,stret:0.001,infrate:0.1075};
ratehistory[239]={year:1910,stockret:-0.0367,bondret:0.0339,stret:0.001,infrate:-0.0677};
ratehistory[240]={year:1911,stockret:0.0345,bondret:0.0376,stret:0.001,infrate:-0.0108};
ratehistory[241]={year:1912,stockret:0.0713,bondret:0.008,stret:0.001,infrate:0.0734};
ratehistory[242]={year:1913,stockret:-0.0484,bondret:0.0659,stret:0.001,infrate:0.0204};
ratehistory[243]={year:1914,stockret:-0.049,bondret:0.0357,stret:0.001,infrate:0.01};
ratehistory[244]={year:1915,stockret:0.3035,bondret:0.0565,stret:0.001,infrate:0.0297};
ratehistory[245]={year:1916,stockret:0.0729,bondret:0.0273,stret:0.001,infrate:0.125};
ratehistory[246]={year:1917,stockret:-0.187,bondret:0.0177,stret:0.001,infrate:0.1966};
ratehistory[247]={year:1918,stockret:0.1831,bondret:0.0508,stret:0.001,infrate:0.1786};
ratehistory[248]={year:1919,stockret:0.1975,bondret:0.0115,stret:0.001,infrate:0.1697};
ratehistory[249]={year:1920,stockret:-0.1348,bondret:0.0412,stret:0.001,infrate:-0.0155};
ratehistory[250]={year:1921,stockret:0.0984,bondret:0.1088,stret:0.001,infrate:-0.1106};
ratehistory[251]={year:1922,stockret:0.2822,bondret:0.0386,stret:0.001,infrate:-0.0059};
ratehistory[252]={year:1923,stockret:0.0494,bondret:0.0658,stret:0.001,infrate:0.0298};
ratehistory[253]={year:1924,stockret:0.2582,bondret:0.0556,stret:0.001,infrate:0};
ratehistory[254]={year:1925,stockret:0.2476,bondret:0.0522,stret:0.001,infrate:0.0347};
ratehistory[255]={year:1926,stockret:0.1075,bondret:0.0629,stret:0.001,infrate:-0.0224};
ratehistory[256]={year:1927,stockret:0.3604,bondret:0.0342,stret:0.001,infrate:-0.0114};
ratehistory[257]={year:1928,stockret:0.4626,bondret:0.0129,stret:0.001,infrate:-0.0116};
ratehistory[258]={year:1929,stockret:-0.0921,bondret:0.0598,stret:0.001,infrate:0};
ratehistory[259]={year:1930,stockret:-0.2193,bondret:0.0291,stret:0.001,infrate:-0.0702};
ratehistory[260]={year:1931,stockret:-0.4199,bondret:0.0077,stret:0.001,infrate:-0.1006};
ratehistory[261]={year:1932,stockret:-0.0506,bondret:0.0652,stret:0.001,infrate:-0.0979};
ratehistory[262]={year:1933,stockret:0.5571,bondret:0.0478,stret:0.001,infrate:0.0232};
ratehistory[263]={year:1934,stockret:-0.0797,bondret:0.0571,stret:0.001,infrate:0.0304};
ratehistory[264]={year:1935,stockret:0.5346,bondret:0.039,stret:0.001,infrate:0.0147};
ratehistory[265]={year:1936,stockret:0.3132,bondret:0.0241,stret:0.001,infrate:0.0218};
ratehistory[266]={year:1937,stockret:-0.3155,bondret:0.0363,stret:0.001,infrate:0.0071};
ratehistory[267]={year:1938,stockret:0.1751,bondret:0.0416,stret:0.001,infrate:-0.0141};
ratehistory[268]={year:1939,stockret:0.0248,bondret:0.0357,stret:0.001,infrate:-0.0071};
ratehistory[269]={year:1940,stockret:-0.0919,bondret:0.0434,stret:0.001,infrate:0.0144};
ratehistory[270]={year:1941,stockret:-0.09,bondret:-0.0212,stret:0.001,infrate:0.1134};
ratehistory[271]={year:1942,stockret:0.2083,bondret:0.0238,stret:0.001,infrate:0.0764};
ratehistory[272]={year:1943,stockret:0.2329,bondret:0.0239,stret:0.001,infrate:0.0296};
ratehistory[273]={year:1944,stockret:0.1899,bondret:0.0336,stret:0.001,infrate:0.023};
ratehistory[274]={year:1945,stockret:0.3832,bondret:0.0383,stret:0.001,infrate:0.0225};
ratehistory[275]={year:1946,stockret:-0.1188,bondret:0.0171,stret:0.001,infrate:0.1813};
ratehistory[276]={year:1947,stockret:0.0217,bondret:0.0073,stret:0.001,infrate:0.1024};
ratehistory[277]={year:1948,stockret:0.0924,bondret:0.0349,stret:0.001,infrate:0.0126};
ratehistory[278]={year:1949,stockret:0.1608,bondret:0.0223,stret:0.001,infrate:-0.0209};
ratehistory[279]={year:1950,stockret:0.3246,bondret:0.0033,stret:0.001,infrate:0.0809};
ratehistory[280]={year:1951,stockret:0.2107,bondret:0.017,stret:0.001,infrate:0.0433};
ratehistory[281]={year:1952,stockret:0.1406,bondret:0.015,stret:0.001,infrate:0.0038};
ratehistory[282]={year:1953,stockret:0.0264,bondret:0.0562,stret:0.001,infrate:0.0113};
ratehistory[283]={year:1954,stockret:0.4556,bondret:0.0145,stret:0.001,infrate:-0.0075};
ratehistory[284]={year:1955,stockret:0.2837,bondret:0.0034,stret:0.001,infrate:0.0037};
ratehistory[285]={year:1956,stockret:0.0668,bondret:-0.0137,stret:0.001,infrate:0.0299};
ratehistory[286]={year:1957,stockret:-0.0566,bondret:0.0633,stret:0.001,infrate:0.0362};
ratehistory[287]={year:1958,stockret:0.3959,bondret:-0.0382,stret:0.001,infrate:0.014};
ratehistory[288]={year:1959,stockret:0.075,bondret:-0.0102,stret:0.001,infrate:0.0104};
ratehistory[289]={year:1960,stockret:0.0613,bondret:0.1131,stret:0.001,infrate:0.017};
ratehistory[290]={year:1961,stockret:0.1892,bondret:0.0206,stret:0.001,infrate:0.0067};
ratehistory[291]={year:1962,stockret:-0.0287,bondret:0.0595,stret:0.001,infrate:0.0133};
ratehistory[292]={year:1963,stockret:0.208,bondret:0.0132,stret:0.001,infrate:0.0165};
ratehistory[293]={year:1964,stockret:0.1566,bondret:0.0402,stret:0.001,infrate:0.0097};
ratehistory[294]={year:1965,stockret:0.1129,bondret:0.0115,stret:0.001,infrate:0.0192};
ratehistory[295]={year:1966,stockret:-0.0657,bondret:0.0483,stret:0.001,infrate:0.0346};
ratehistory[296]={year:1967,stockret:0.1595,bondret:-0.0202,stret:0.001,infrate:0.0365};
ratehistory[297]={year:1968,stockret:0.1041,bondret:0.0207,stret:0.001,infrate:0.044};
ratehistory[298]={year:1969,stockret:-0.0844,bondret:-0.0499,stret:0.001,infrate:0.0618};
ratehistory[299]={year:1970,stockret:0.0702,bondret:0.1822,stret:0.001,infrate:0.0529};
ratehistory[300]={year:1971,stockret:0.1384,bondret:0.0822,stret:0.001,infrate:0.0327};
ratehistory[301]={year:1972,stockret:0.1759,bondret:0.0255,stret:0.001,infrate:0.0365};
ratehistory[302]={year:1973,stockret:-0.1616,bondret:0.0301,stret:0.001,infrate:0.0939};
ratehistory[303]={year:1974,stockret:-0.2097,bondret:0.0374,stret:0.001,infrate:0.118};
ratehistory[304]={year:1975,stockret:0.3848,bondret:0.0598,stret:0.001,infrate:0.0671};
ratehistory[305]={year:1976,stockret:0.1096,bondret:0.1116,stret:0.001,infrate:0.0522};
ratehistory[306]={year:1977,stockret:-0.091,bondret:0.0252,stret:0.001,infrate:0.0684};
ratehistory[307]={year:1978,stockret:0.157,bondret:0.0115,stret:0.001,infrate:0.0928};
ratehistory[308]={year:1979,stockret:0.1635,bondret:-0.0039,stret:0.001,infrate:0.1391};
ratehistory[309]={year:1980,stockret:0.2507,bondret:0.0157,stret:0.001,infrate:0.1183};
ratehistory[310]={year:1981,stockret:-0.0714,bondret:0.0279,stret:0.001,infrate:0.0839};
ratehistory[311]={year:1982,stockret:0.287,bondret:0.3795,stret:0.001,infrate:0.0371};
ratehistory[312]={year:1983,stockret:0.2008,bondret:0.0393,stret:0.001,infrate:0.0419};
ratehistory[313]={year:1984,stockret:0.074,bondret:0.1325,stret:0.001,infrate:0.0353};
ratehistory[314]={year:1985,stockret:0.2574,bondret:0.2441,stret:0.001,infrate:0.0388};
ratehistory[315]={year:1986,stockret:0.3085,bondret:0.2289,stret:0.001,infrate:0.0146};
ratehistory[316]={year:1987,stockret:-0.0216,bondret:-0.0258,stret:0.001,infrate:0.0405};
ratehistory[317]={year:1988,stockret:0.1747,bondret:0.0616,stret:0.001,infrate:0.0467};
ratehistory[318]={year:1989,stockret:0.2256,bondret:0.1454,stret:0.001,infrate:0.052};
ratehistory[319]={year:1990,stockret:-0.0098,bondret:0.0896,stret:0.001,infrate:0.0565};
ratehistory[320]={year:1991,stockret:0.3155,bondret:0.1499,stret:0.001,infrate:0.026};
ratehistory[321]={year:1992,stockret:0.0754,bondret:0.0988,stret:0.001,infrate:0.0326};
ratehistory[322]={year:1993,stockret:0.1153,bondret:0.1244,stret:0.001,infrate:0.0252};
ratehistory[323]={year:1994,stockret:0.0103,bondret:-0.0705,stret:0.001,infrate:0.028};
ratehistory[324]={year:1995,stockret:0.3489,bondret:0.2249,stret:0.001,infrate:0.0273};
ratehistory[325]={year:1996,stockret:0.2697,bondret:-0.0052,stret:0.001,infrate:0.0304};
ratehistory[326]={year:1997,stockret:0.2768,bondret:0.138,stret:0.001,infrate:0.0157};
ratehistory[327]={year:1998,stockret:0.3124,bondret:0.1144,stret:0.001,infrate:0.0167};
ratehistory[328]={year:1999,stockret:0.1546,bondret:-0.081,stret:0.001,infrate:0.0274};
ratehistory[329]={year:2000,stockret:-0.0514,bondret:0.1725,stret:0.001,infrate:0.0373};
ratehistory[330]={year:2001,stockret:-0.1342,bondret:0.0601,stret:0.001,infrate:0.0114};
ratehistory[331]={year:2002,stockret:-0.2005,bondret:0.1238,stret:0.001,infrate:0.026};
ratehistory[332]={year:2003,stockret:0.2822,bondret:0.0331,stret:0.001,infrate:0.0193};
ratehistory[333]={year:2004,stockret:0.0587,bondret:0.0363,stret:0.001,infrate:0.0297};
ratehistory[334]={year:2005,stockret:0.0991,bondret:0.0276,stret:0.001,infrate:0.0398};
ratehistory[335]={year:2006,stockret:0.1313,bondret:0.0198,stret:0.001,infrate:0.0208};
ratehistory[336]={year:2007,stockret:-0.0143,bondret:0.1243,stret:0.001,infrate:0.0428};
ratehistory[337]={year:2008,stockret:-0.3519,bondret:0.1346,stret:0.001,infrate:0.0003};
ratehistory[338]={year:2009,stockret:0.3304,bondret:-0.0659,stret:0.001,infrate:0.0263};
ratehistory[339]={year:2010,stockret:0.1613,bondret:0.0633,stret:0.001,infrate:0.0163};
ratehistory[340]={year:2011,stockret:0.0319,bondret:0.15,stret:0.001,infrate:0.0293};
ratehistory[341]={year:2012,stockret:0.1588,bondret:0.0246,stret:0.001,infrate:0.016};
ratehistory[342]={year:2013,stockret:0.2523,bondret:-0.0554,stret:0.001,infrate:0.0159};
ratehistory[343]={year:2014,stockret:0.1324,bondret:0.109,stret:0.001,infrate:-0.0009};
ratehistory[344]={year:2015,stockret:-0.0344,bondret:0.0017,stret:0.001,infrate:0.0138};
ratehistory[345]={year:2016,stockret:0.2085,bondret:-0.0063,stret:0.001,infrate:0.0192};
ratehistory[346]={year:2017,stockret:0.2463,bondret:0.0124,stret:0.001,infrate:0.0265};
ratehistory[347]={year:2018,stockret:-0.0477,bondret:0.0155,stret:0.001,infrate:0.0155};
ratehistory[348]={year:2019,stockret:0.278,bondret:0.1055,stret:0.001,infrate:0.0249};
ratehistory[349]={year:2020,stockret:0.1752,bondret:0.0756,stret:0.001,infrate:0.014};
ratehistory[350]={year:2021,stockret:0.221,bondret:-0.0453,stret:0.02,infrate:0.0748};
ratehistory[351]={year:2022,stockret:-0.149,bondret:0.0176,stret:0.02,infrate:0.0711};
ratehistory[352]={year:2023,stockret:0.2612,bondret:0.0555,stret:0.02,infrate:0.031};
ratehistory[353]={year:2024,stockret:0.19,bondret:0.05,stret:0.02,infrate:0.025};
ratehistory[354]={year:2025,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[355]={year:2026,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[356]={year:2027,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[357]={year:2028,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[358]={year:2029,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[359]={year:2030,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[360]={year:2031,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[361]={year:2032,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[362]={year:2033,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[363]={year:2034,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[364]={year:2035,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[365]={year:2036,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[366]={year:2037,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[367]={year:2038,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[368]={year:2039,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[369]={year:2040,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[370]={year:2041,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[371]={year:2042,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[372]={year:2043,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[373]={year:2044,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[374]={year:2045,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[375]={year:2046,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[376]={year:2047,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[377]={year:2048,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[378]={year:2049,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[379]={year:2050,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[380]={year:2051,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[381]={year:2052,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[382]={year:2053,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[383]={year:2054,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[384]={year:2055,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[385]={year:2056,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[386]={year:2057,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[387]={year:2058,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[388]={year:2059,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[389]={year:2060,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[390]={year:2061,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[391]={year:2062,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[392]={year:2063,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[393]={year:2064,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[394]={year:2065,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[395]={year:2066,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[396]={year:2067,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[397]={year:2068,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[398]={year:2069,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[399]={year:2070,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[400]={year:2071,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[401]={year:2072,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[402]={year:2073,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[403]={year:2074,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[404]={year:2075,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[405]={year:2076,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[406]={year:2077,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[407]={year:2078,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[408]={year:2079,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[409]={year:2080,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[410]={year:2081,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[411]={year:2082,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[412]={year:2083,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[413]={year:2084,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[414]={year:2085,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[415]={year:2086,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[416]={year:2087,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[417]={year:2088,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[418]={year:2089,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[419]={year:2090,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[420]={year:2091,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[421]={year:2092,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[422]={year:2093,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[423]={year:2094,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[424]={year:2095,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[425]={year:2096,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[426]={year:2097,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[427]={year:2098,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[428]={year:2099,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[429]={year:2100,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[430]={year:2101,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[431]={year:2102,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[432]={year:2103,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[433]={year:2104,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[434]={year:2105,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[435]={year:2106,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[436]={year:2107,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[437]={year:2108,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[438]={year:2109,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[439]={year:2110,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[440]={year:2111,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[441]={year:2112,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[442]={year:2113,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[443]={year:2114,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[444]={year:2115,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[445]={year:2116,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[446]={year:2117,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[447]={year:2118,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[448]={year:2119,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[449]={year:2120,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[450]={year:2121,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[451]={year:2122,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[452]={year:2123,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[453]={year:2124,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[454]={year:2125,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[455]={year:2126,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[456]={year:2127,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[457]={year:2128,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[458]={year:2129,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[459]={year:2130,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[460]={year:2131,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[461]={year:2132,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[462]={year:2133,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[463]={year:2134,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[464]={year:2135,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[465]={year:2136,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[466]={year:2137,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[467]={year:2138,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[468]={year:2139,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[469]={year:2140,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[470]={year:2141,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[471]={year:2142,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[472]={year:2143,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[473]={year:2144,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[474]={year:2145,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[475]={year:2146,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[476]={year:2147,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[477]={year:2148,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[478]={year:2149,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[479]={year:2150,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[480]={year:2151,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[481]={year:2152,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[482]={year:2153,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[483]={year:2154,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[484]={year:2155,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[485]={year:2156,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[486]={year:2157,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[487]={year:2158,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[488]={year:2159,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[489]={year:2160,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[490]={year:2161,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[491]={year:2162,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[492]={year:2163,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[493]={year:2164,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[494]={year:2165,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[495]={year:2166,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[496]={year:2167,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[497]={year:2168,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};

var frozbas_end_bal = new Array();
frozbas_end_bal[0]={year:2023,amt:1843779};
frozbas_end_bal[1]={year:2024,amt:1856641};
frozbas_end_bal[2]={year:2025,amt:1774109};
frozbas_end_bal[3]={year:2026,amt:1681638};
frozbas_end_bal[4]={year:2027,amt:1573577};
frozbas_end_bal[5]={year:2028,amt:1461384};
frozbas_end_bal[6]={year:2029,amt:1370856};
frozbas_end_bal[7]={year:2030,amt:1297720};
frozbas_end_bal[8]={year:2031,amt:1236910};
frozbas_end_bal[9]={year:2032,amt:1224749};
frozbas_end_bal[10]={year:2033,amt:1219384};
frozbas_end_bal[11]={year:2034,amt:1215974};
frozbas_end_bal[12]={year:2035,amt:1214325};
frozbas_end_bal[13]={year:2036,amt:1214498};
frozbas_end_bal[14]={year:2037,amt:1215898};
frozbas_end_bal[15]={year:2038,amt:1218486};
frozbas_end_bal[16]={year:2039,amt:1222356};
frozbas_end_bal[17]={year:2040,amt:1227619};
frozbas_end_bal[18]={year:2041,amt:1234367};
frozbas_end_bal[19]={year:2042,amt:1242746};
frozbas_end_bal[20]={year:2043,amt:1252828};
frozbas_end_bal[21]={year:2044,amt:1264795};
frozbas_end_bal[22]={year:2045,amt:1277891};
frozbas_end_bal[23]={year:2046,amt:1292214};
frozbas_end_bal[24]={year:2047,amt:1307861};
frozbas_end_bal[25]={year:2048,amt:1324964};
frozbas_end_bal[26]={year:2049,amt:1343635};
frozbas_end_bal[27]={year:2050,amt:1364063};
frozbas_end_bal[28]={year:2051,amt:1386389};
frozbas_end_bal[29]={year:2052,amt:1410769};
frozbas_end_bal[30]={year:2053,amt:1437400};
frozbas_end_bal[31]={year:2054,amt:1193209};
frozbas_end_bal[32]={year:2055,amt:951728};
frozbas_end_bal[33]={year:2056,amt:699437};
frozbas_end_bal[34]={year:2057,amt:699437};    
frozbas_end_bal[35]={year:2058,amt:699437};
frozbas_end_bal[36]={year:2059,amt:699437};
frozbas_end_bal[37]={year:2060,amt:699437};
frozbas_end_bal[38]={year:2061,amt:699437};

var frozbas_end_bal_len = frozbas_end_bal.length;
        
    
</script>
 </body>
</html>

