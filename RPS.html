<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
<html>
<style>
#myHeader {
  background-color: lightblue;
  color: black;
  padding: 20px;
  text-align: center;
} 
</style>
<style>
div.b {
  line-height: .5;
}

</style>

 <head>
  <title>Back Test Retirement Plan</title>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
 </head>

<h1 id="myHeader">Retirement Plan Simulator</h1>

<body style="background-color:whitesmoke;"

<div class="w3-bar w3-black">
   <a href="RPS_Disclaimer.html" >Disclaimer</a>
   &nbsp;&nbsp;&nbsp;
   <a href="RPS_User_Guide.html" >User Guide</a> 
   &nbsp;&nbsp;&nbsp;
   <a href="Recent_Changes.html" >Recent Changes</a> 
   &nbsp;&nbsp;&nbsp;
   <a href="mailto:josephnagy72@gmail.com" >Contact Me</a>   
</div>

<form onsubmit=" ">
<div align="left">
<p> If you have used RPS on this computer before: 
<input type="button" value="Get Your Previously Processed Plan" onclick="getprev(this.form)">
</p>

<p>
<fieldset>
  <legend> <b> Your Information </b> </legend>
     <label for="you_cur_age">Age: </label> 
     <input id='youcurage' type="number" name="you_cur_age" min="20" max="99" style="width: 50px;"> 

     <label for="you_retire_age">Retire Begin Age:</label> 
     <input type="number" name="you_retire_age" value="65" min="20" max="99" style="width: 50px;"> 

     <label for="you_retire_end_age">Retire End Age:</label>  
     <input type="number" name="you_retire_end_age" value="94" min="20" max="99" style="width: 50px;">

     <label for="you_socsec_age">Soc Sec Start Age:</label> 	
     <input type="number" name="you_socsec_age" value="70" min="62" max="70" style="width: 50px;">

     <label for="you_socsec_amt">Annual Soc Sec:</label> 	
     <input type="number" name="you_socsec_amt" value=0 min="0" max="100000" style="width: 75px;"     >
    
     <label for="you_ira_start_bal_amt">IRA/401K Balance:</label>
     <input type="number" name="you_ira_start_bal_amt" value=0 min="0" max="999999999" style="width: 100px;">

     <label for="you_ira_ann_dep_amt">IRA/401K Annual Deposit:</label>
     <input type="number" name="you_ira_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

      <div class="b"><br> </div>
     <label for="you_pension_amt">Annual Pension:</label> 
     <input type="number" name="you_pension_amt" value=0 min="0" max="999999" style="width: 75px;">

     <label for="you_pension_beg_age">Pension Begin Age:</label> 
     <input type="number" name="you_pension_begin_age" value=0 min="0" max="99" style="width: 50px;"	>

    <label for="you_pension_inf_pct">Annual Pension Inflation Adjustment %:</label> 
    <input type="number" name="you_pension_inf_pct" value=0 min="0" max="10" style="width: 50px;">

    <label for="you_pension_survivor_pct">Pension Survivor %:</label> 
    <input type="number" name="you_pension_survivor_pct" value=0 min="0" max="100" style="width: 50px;">

</fieldset>
<br>
<fieldset>
  <legend><b> Spouse Information </b> </legend>
     <label for="spo_cur_age">Age: </label>
     <input type="number" name="spo_cur_age" value=0 min="20" max="99" style="width: 50px;"> 

     <label for="spo_retire_age">Retire Begin Age:</label> 
     <input type="number" name="spo_retire_age" value=0 min="20" max="99" style="width: 50px;"> 

     <label for="spo_retire_end_age">Retire End Age:</label> 
     <input type="number" name="spo_retire_end_age" value=0 min="20" max="99" style="width: 50px;">
     
     <label for="spo_socsec_age">Soc Sec Start Age:</label>  	
     <input type="number" name="spo_socsec_age" value=0 min="62" max="70" style="width: 50px;">
     
     <label for="spo_socsec_amt">Annual Soc Sec:</label>
     <input type="number" name="spo_socsec_amt" value=0 min="0" max="100000" style="width: 75px;">       

     <label for="spo_ira_start_bal_amt">IRA/401k Balance:</label> 
     <input type="number" name="spo_ira_start_bal_amt" value=0 min="0" max="999999999" style="width: 100px;">

     <label for="spo_ira_ann_dep_amt">IRA/401k Annual Deposit:</label> 
     <input type="number" name="spo_ira_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

     <div class="b"><br> </div>

     <label for="spo_pension_amt">Annual Pension:</label> 
     <input type="number" name="spo_pension_amt" value=0 min="0" max="999999" style="width: 75px;">

     <label for="spo_pension_beg_age">Pension Begin Age:</label> 
     <input type="number" name="spo_pension_begin_age" value=0 min="0" max="99" style="width: 50px;">

    <label for="spo_pension_inf_pct">Annual Pension Inflation Adjustment %:</label> 
    <input type="number" name="spo_pension_inf_pct" value=0 min="0" max="10" style="width: 50px;">

    <label for="spo_pension_survivor_pct">Pension Survivor %:</label>  
    <input type="number" name="spo_pension_survivor_pct" value=0 min="0" max="100" style="width: 50px;">

</fieldset>
<br>
<fieldset>
  <legend><b> Brokerage Account Information </b> </legend>

    <label for="brkrg_start_bal_amt">Current Balance:</label>
    <input type="number" name="brkrg_start_bal_amt" value=0 min="0" max="999999999" style="width: 100px;">

    <label for="brkrg_cost_basis_amt">Cost Basis:</label>
    <input type="number" name="brkrg_cost_basis_amt" value=0 min="0" max="999999999" style="width: 100px;">

     <label for="brkrg_ann_dep_amt">Annual Deposit:</label> 
     <input type="number" name="brkrg_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

     <label for="brkrg_taxable_dist_pct">Taxable Distribution %:</label>  
        <input type="number" name="brkrg_taxable_dist_pct" value=2 min="0" max="10" style="width: 50px;">
</fieldset> 
<br>

<fieldset>
  <legend><b> Roth / HSA Account Information </b> </legend>

    <label for="roth_start_bal_amt">Current Balance:</label> 
    <input type="number" name="roth_start_bal_amt" value=0 min="0" max="999999999" style="width: 100px;">

     <label for="roth_ann_dep_amt">Annual Deposit:</label> 
     <input type="number" name="roth_ann_dep_amt" value=0 min="0" max="999999" style="width: 75px;">

    <label for="roth_conv_pct">Backdoor Conversion Max Tax Bracket:</label>
         <select name="roth_conv_pct" id="roth_conv_pct">
           <option value="none">None</option>
           <option value="0">0%</option>
           <option value="10">10%</option>
           <option value="12">12%</option>
          </select>

</fieldset> 
<br>
<fieldset>
  <legend><b> Annual Budget </b> </legend>
    
    <label for="gogo_budget_amt">Go Go Years (< 75):</label> 
    <input type="number" name="gogo_budget_amt" value=0 min="0" max="999999" style="width: 75px;">

    <label for="slowgo_budget_amt">Slow Go Years (< 85):</label> 
    <input type="number" name="slowgo_budget_amt" value=0 min="0" max="999999" style="width: 75px;">

    <label for="nogo_budget_amt">No Go Years (> 85):</label> 
    <input type="number" name="nogo_budget_amt" value=0 min="0" max="999999" style="width: 75px;">

    <label for="last3_budget_amt">Assisted Living Years (Last 3):</label> 
    <input type="number" name="last3_budget_amt" value=0 min="0" max="9999999" style="width: 75px;">

    <label for="mortgage_budget_amt">Mortgage Amount:</label> 
    <input type="number" name="mortgage_budget_amt" value=0 min="0" max="999999" style="width: 75px;">

    <label for="mortgage_end_age">Age Mortgage Ends:</label> 
    <input type="number" name="mortgage_end_age" value=0 min="0" max="99" style="width: 50px;">

</fieldset> 
<br>
<fieldset>
  <legend><b> Other Information </b> </legend>
    
    <label for="stock_pct">Stock Allocation %:</label> 
    <input type="number" name="stock_pct" value=60 min="0" max="100" style="width: 50px;" >

    <label for="bonus_pct">Retirement Bonus %:</label>
    <input type="number" name="bonus_pct" value=0 min="0" max="100" style="width: 50px;">

    <label for="baseline_stock_return_pct">Baseline Stock Return %:</label>
    <input type="number" name="baseline_stock_return_pct" value=6 min="0" max="10" style="width: 50px;">

    <label for="baseline_bond_return_pct">Baseline Bond Return %:</label>
    <input type="number" name="baseline_bond_return_pct" value=3 min="0" max="10" style="width: 50px;">

    <label for="medb_flag">Enroll Medicare B:</label>
         <select name="medb_flag" id="medb_flag">
           <option value="NO">No</option>
           <option value="YES">Yes</option>
         </select>

</fieldset> 
<br>
<input type="button" value="Run Simulation" onclick="calcdraw(this.form,'NO')">

<input type="button" value="Download Detail Results" onclick="calcdraw(this.form,'YES')">

<p id="showresults">


</div>
</form>

<script type="text/javascript">
 function getprev(form) 
  { 
   form.spo_cur_age.value = localStorage.getItem("SimpSim_spo_cur_age");
   form.spo_cur_age.value = localStorage.getItem("SimpSim_spo_cur_age");
   form.you_cur_age.value = localStorage.getItem("SimpSim_you_cur_age");
   form.spo_pension_begin_age.value = localStorage.getItem("SimpSim_spo_pension_begin_age");
   form.spo_pension_inf_pct.value = localStorage.getItem("SimpSim_spo_pension_inf_pct");
   form.spo_pension_survivor_pct.value = localStorage.getItem("SimpSim_spo_pension_survivor_pct");
   form.spo_retire_age.value = localStorage.getItem("SimpSim_spo_retire_age");
   form.spo_socsec_age.value = localStorage.getItem("SimpSim_spo_socsec_age");
   form.you_pension_begin_age.value = localStorage.getItem("SimpSim_you_pension_begin_age");
   form.you_pension_inf_pct.value = localStorage.getItem("SimpSim_you_pension_inf_pct");
   form.you_pension_survivor_pct.value = localStorage.getItem("SimpSim_you_pension_survivor_pct");
   form.you_retire_age.value = localStorage.getItem("SimpSim_you_retire_age");
   form.you_socsec_age.value = localStorage.getItem("SimpSim_you_socsec_age");
   form.brkrg_start_bal_amt.value = localStorage.getItem("SimpSim_brkrg_start_bal_amt");
   form.brkrg_cost_basis_amt.value = localStorage.getItem("SimpSim_brkrg_cost_basis_amt");

   form.gogo_budget_amt.value = localStorage.getItem("SimpSim_gogo_budget_amt");
   form.slowgo_budget_amt.value = localStorage.getItem("SimpSim_slowgo_budget_amt");
   form.nogo_budget_amt.value = localStorage.getItem("SimpSim_nogo_budget_amt");
   form.last3_budget_amt.value = localStorage.getItem("SimpSim_last3_budget_amt");
   form.mortgage_budget_amt.value = localStorage.getItem("SimpSim_mortgage_budget_amt");
   form.mortgage_end_age.value = localStorage.getItem("SimpSim_mortgage_end_age");

   form.spo_ira_start_bal_amt.value = localStorage.getItem("SimpSim_spo_ira_start_bal_amt");
   form.spo_pension_amt.value = localStorage.getItem("SimpSim_spo_pension_amt");
   form.spo_socsec_amt.value = localStorage.getItem("SimpSim_spo_socsec_amt");
   form.you_ira_start_bal_amt.value = localStorage.getItem("SimpSim_you_ira_start_bal_amt");
   form.you_pension_amt.value = localStorage.getItem("SimpSim_you_pension_amt");
   form.you_socsec_amt.value = localStorage.getItem("SimpSim_you_socsec_amt");
   form.stock_pct.value = localStorage.getItem("SimpSim_stock_pct");
  
   form.bonus_pct.value = localStorage.getItem("SimpSim_bonus_pct");
   form.medb_flag.value = localStorage.getItem("SimpSim_medb_flag");
   if (form.medb_flag.value == "") {form.medb_flag.value = "YES";}

   form.spo_retire_end_age.value = localStorage.getItem("SimpSim_spo_retire_end_age");
   form.you_retire_end_age.value = localStorage.getItem("SimpSim_you_retire_end_age");
   form.roth_start_bal_amt.value = localStorage.getItem("SimpSim_roth_start_bal_amt");
   form.roth_conv_pct.value = localStorage.getItem("SimpSim_roth_conv_pct");

   form.you_ira_ann_dep_amt.value = localStorage.getItem("SimpSim_you_ira_ann_dep_amt");
   form.spo_ira_ann_dep_amt.value = localStorage.getItem("SimpSim_spo_ira_ann_dep_amt");
   form.brkrg_ann_dep_amt.value = localStorage.getItem("SimpSim_brkrg_ann_dep_amt");
   form.roth_ann_dep_amt.value = localStorage.getItem("SimpSim_roth_ann_dep_amt");
   
   form.brkrg_taxable_dist_pct.value = localStorage.getItem("SimpSim_brkrg_taxable_dist_pct");

   form.baseline_stock_return_pct.value = localStorage.getItem("SimpSim_baseline_stock_return_pct");
   form.baseline_bond_return_pct.value = localStorage.getItem("SimpSim_baseline_bond_return_pct");

  }  
</script>

<script type="text/javascript">
 function calcdraw(form, fDownload_Results) {

      error_message = '';
      error_message1 = '<p> Ooops.  Errors found on input</p>';

      if (form.you_cur_age.value > 99) 
          {error_message = error_message + "<p> Your Current Age must be between 20 and 99. </p> ";  }
  
      if (form.you_cur_age.value < 20) 
        {error_message = error_message + "<p> Your Current Age must be between 20 and 99. </p> "; }

      if (form.you_retire_age.value > 99) 
        {error_message = error_message + "<p> Your Retire Age must be between 20 and 99. </p>"; }
  
      if (form.you_retire_age.value < 20) 
        {error_message = error_message + "<p> Your Retire Age must be between 20 and 99. </p>"; }

      if (form.you_retire_end_age.value > 99) 
        {error_message = error_message + "<p> Your Retire End Age must be between 60 and 99. </p> "; }
  
      if (form.you_retire_end_age.value < 60) 
        {error_message = error_message + "<p> Your Retire End Age must be between 60 and 99. </p>"; }

      if (form.you_socsec_age.value < 62) 
        {error_message = error_message + "<p> Your Social Security Start Age must be between 62 and 70. </p> "; }

      if (form.you_socsec_age.value > 70) 
        {error_message = error_message + "<p> Your Social Security Start Age must be between 62 and 70. </p>"; }

      if (form.you_socsec_amt.value > 100000) 
          {error_message = error_message + "<p> Your Social Security Amount must be betwen 0 and 100000. </p>"; }
      
      if (form.you_socsec_amt.value < 0) 
          {error_message = error_message + "<p> Your Social Security Amount must be between 0 and 100000. </p> "; }

      if (form.you_ira_start_bal_amt.value < 0) 
          {error_message = error_message + "<p> Your IRA Amount must be between 0 and 1000000000. </p> "; }

      if (form.you_ira_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> Your IRA Amount must be between 0 and 1000000000.  </p>"; }

      if (form.you_ira_ann_dep_amt.value < 0) 
         {error_message = error_message + "<p> Your Annual IRA Deposit must be between 0 and 1000000. </p>"; }

      if (form.you_ira_ann_dep_amt.value > 1000000) 
         {error_message = error_message + "<p> Your Annual IRA Deposit must be between 0 and 1000000. </p>"; }

      if (form.you_pension_amt.value < 0) 
         {error_message = error_message + "<p> Your Pension must be between 0 and 1000000.  </p>"; }

      if (form.you_pension_amt.value > 1000000) 
         {error_message = error_message + "<p> Your Pension must be between 0 and 1000000.  </p>"; }

      if (form.you_pension_begin_age.value < 0) 
         {error_message = error_message + "<p> Your Pension Begin Age must be between 0 and 99. </p>"; }

      if (form.you_pension_begin_age.value > 99) 
         {error_message = error_message + "<p> Your Pension Begin Age must be between 0 and 99.  </p>"; }

      if (form.you_pension_inf_pct.value < 0) 
         {error_message = error_message + "<p> Your Pension Inflation Adjustment must be between 0 and 10.  </p>"; }

      if (form.you_pension_inf_pct.value > 10) 
         {error_message = error_message + "<p> Your Pension Inflation Adjustment must be between 0 and 10.  </p>"; }

      if (form.you_pension_survivor_pct.value < 0) 
         {error_message = error_message + "<p> Your Pension Survivor Percent must be between 0 and 100.  </p>"; }

      if (form.you_pension_survivor_pct.value > 100) 
         {error_message = error_message + "<p> Your Pension Survivor Percent must be between 0 and 100.  </p>"; }

      if (form.spo_cur_age.value > 0)
          {error_message = edit_spouse_form(form, error_message);}

        if (form.spo_cur_age.value == 0)
             {error_message = edit_spouse_form2(form, error_message);}

       if (form.brkrg_start_bal_amt.value < 0) 
         {error_message = error_message + "<p> Brokerage Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> Brokerage Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_cost_basis_amt.value < 0) 
         {error_message = error_message + "<p> Brokerage Cost Basis must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_cost_basis_amt.value > 1000000000) 
         {error_message = error_message + "<p> Brokerage Cost Basis must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_ann_dep_amt.value < 0) 
         {error_message = error_message + "<p> Brokerage Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_ann_dep_amt.value > 1000000000) 
         {error_message = error_message + "<p> Brokerage Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.brkrg_taxable_dist_pct.value < 0) 
         {error_message = error_message + "<p> Brokerage Annual Deposit must be between 0 and 10.  </p>"; }
      
       if (form.brkrg_taxable_dist_pct.value > 10) 
         {error_message = error_message + "<p> Brokerage Annual Deposit must be between 0 and 10.  </p>"; }
      
       if (form.roth_start_bal_amt.value < 0) 
         {error_message = error_message + "<p> Roth Start Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.roth_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> Roth Start Balance must be between 0 and 1000000000.  </p>"; }
      
       if (form.roth_ann_dep_amt.value < 0) 
         {error_message = error_message + "<p> Roth Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.roth_ann_dep_amt.value > 1000000000) 
         {error_message = error_message + "<p> Roth Annual Deposit must be between 0 and 1000000000.  </p>"; }
      
       if (form.gogo_budget_amt.value < 0) 
         {error_message = error_message + "<p> Go Go Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.gogo_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> Go Go Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.slowgo_budget_amt.value < 0) 
         {error_message = error_message + "<p> Slow Go Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.slowgo_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> Slow Go Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.nogo_budget_amt.value < 0) 
         {error_message = error_message + "<p> No Go Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.nogo_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> No Go Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.last3_budget_amt.value < 0) 
         {error_message = error_message + "<p> Last 3 Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.last3_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> Last 3 Budget must be between 0 and 1000000000.  </p>"; }
     
       if (form.mortgage_budget_amt.value < 0) 
         {error_message = error_message + "<p> Mortgage Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.mortgage_budget_amt.value > 1000000000) 
         {error_message = error_message + "<p> Mortgage Budget must be between 0 and 1000000000.  </p>"; }
      
       if (form.mortgage_end_age.value < 0) 
         {error_message = error_message + "<p> Mortgage End Age must be between 0 and 99.  </p>"; }
      
       if (form.mortgage_end_age.value > 99) 
         {error_message = error_message + "<p> Mortgage End Age must be between 0 and 99.  </p>"; }
      
       if (form.stock_pct.value < 0) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.stock_pct.value > 100) 
         {error_message = error_message + "<p> Stock Pct must be between 0 and 100.  </p>"; }
      
       if (form.bonus_pct.value < 0) 
         {error_message = error_message + "<p> Bonus Pct must be between 0 and 100.  </p>"; }
      
       if (form.bonus_pct.value > 100) 
         {error_message = error_message + "<p> Bonus Pct must be between 0 and 100.  </p>"; }

       if (form.baseline_stock_return_pct.value < 0) 
         {error_message = error_message + "<p> Baseline Stock Return Pct must be between 0 and 10.  </p>"; }
      
       if (form.baseline_stock_return_pct.value > 10) 
         {error_message = error_message + "<p> Baseline Stock Return Pct must be between 0 and 10.  </p>"; }
      
       if (form.baseline_bond_return_pct.value < 0) 
         {error_message = error_message + "<p> Baseline Bond Return Pct must be between 0 and 10.  </p>"; }
      
       if (form.baseline_bond_return_pct.value > 10) 
         {error_message = error_message + "<p> Baseline Bond Return Pct must be between 0 and 10.  </p>"; }
      
      if (error_message == '')
         {process_form(form,fDownload_Results)};
      
      if (error_message != '')
         {
           document.getElementById("showresults").innerHTML = error_message1 + error_message;
           window.scrollTo(0, 200);
         }
 
  }  
</script>


<script type="text/javascript">
 function edit_spouse_form (form, error_message) {

      if (form.spo_cur_age.value > 99) 
          {error_message = error_message + "<p> Spouse Current Age must be between 20 and 99. </p> ";  }
  
      if (form.spo_cur_age.value < 20) 
        {error_message = error_message + "<p> Spouse Current Age must be between 20 and 99. </p> "; }
      
      if (form.spo_retire_age.value > 99) 
        {error_message = error_message + "<p> Spouse Retire Age must be between 20 and 99. </p>"; }
  
      if (form.spo_retire_age.value < 20) 
        {error_message = error_message + "<p> Spouse Retire Age must be between 20 and 99. </p>"; }

      if (form.spo_retire_end_age.value > 99) 
        {error_message = error_message + "<p> Spouse Retire End Age must be between 60 and 99. </p> "; }
  
      if (form.spo_retire_end_age.value < 60) 
        {error_message = error_message + "<p> Spouse Retire End Age must be between 60 and 99. </p>"; }

      if (form.spo_socsec_age.value < 62) 
         {error_message = error_message + "<p> Spouse Social Security Start Age must be between 62 and 70. </p> "; }

      if (form.spo_socsec_age.value > 70) 
        {error_message = error_message + "<p> Spouse Social Security Start Age must be between 62 and 70. </p>"; }

      if (form.spo_socsec_amt.value > 100000) 
          {error_message = error_message + "<p> Spouse Social Security Amount must be betwen 0 and 100000. </p>"; }
      
      if (form.spo_socsec_amt.value < 0) 
          {error_message = error_message + "<p> Spouse Social Security Amount must be between 0 and 100000. </p> "; }

      if (form.spo_ira_start_bal_amt.value < 0) 
          {error_message = error_message + "<p> Spouse IRA Amount must be between 0 and 1000000000. </p> "; }

      if (form.spo_ira_start_bal_amt.value > 1000000000) 
         {error_message = error_message + "<p> Spouse IRA Amount must be between 0 and 1000000000.  </p>"; }

      if (form.spo_ira_ann_dep_amt.value < 0) 
          {error_message = error_message + "<p> Spouse Annual IRA Deposit must be between 0 and 1000000. </p>"; }

      if (form.spo_ira_ann_dep_amt.value > 1000000) 
         {error_message = error_message + "<p> Spouse Annual IRA Deposit must be between 0 and 1000000. </p>"; }

      if (form.spo_pension_amt.value < 0) 
         {error_message = error_message + "<p> Spouse Pension must be between 0 and 1000000.  </p>"; }

      if (form.spo_pension_amt.value > 1000000) 
         {error_message = error_message + "<p> Spouse Pension must be between 0 and 1000000.  </p>"; }

      if (form.spo_pension_begin_age.value < 0) 
         {error_message = error_message + "<p> Spouse Pension Begin Age must be between 0 and 99. </p>"; }

      if (form.spo_pension_begin_age.value > 99) 
         {error_message = error_message + "<p> Spouse Pension Begin Age must be between 0 and 99.  </p>"; }

      if (form.spo_pension_inf_pct.value < 0) 
         {error_message = error_message + "<p> Spouse Pension Inflation Adjustment must be between 0 and 10.  </p>"; }

      if (form.spo_pension_inf_pct.value > 10) 
         {error_message = error_message + "<p> Spouse Pension Inflation Adjustment must be between 0 and 10.  </p>"; }

      if (form.spo_pension_survivor_pct.value < 0) 
         {error_message = error_message + "<p> Spouse Pension Survivor Percent must be between 0 and 100.  </p>"; }

      if (form.spo_pension_survivor_pct.value > 100) 
         {error_message = error_message + "<p> Spouse Pension Survivor Percent must be between 0 and 100.  </p>"; }

      
       return error_message; 
  }  

</script>
          
<script type="text/javascript">
 function edit_spouse_form2 (form, error_message) {

      if (form.spo_retire_age.value != 0) 
        {error_message = error_message + "<p> Spouse Retire Age entered - Spouse Current Age must be between 20 and 99. </p>"; }
  
      if (form.spo_retire_end_age.value != 0) 
        {error_message = error_message + "<p> Spouse Retire End entered - Spouse Current Age must be between 20 and 99. </p> "; }
  
     if (form.spo_socsec_age.value != 0) 
         {error_message = error_message + "<p> Spouse Social Security Age entered - Spouse Current Age must be between 20 and 99.  </p> "; }

     if (form.spo_socsec_amt.value != 0) 
          {error_message = error_message + "<p> Spouse Social Security Amount entered - Spouse Current Age must be between 20 and 99.   </p>"; }
      
      if (form.spo_ira_start_bal_amt.value != 0) 
          {error_message = error_message + "<p> Spouse IRA Amount entered - Spouse Current Age must be between 20 and 99.    </p> "; }

      if (form.spo_ira_ann_dep_amt.value != 0) 
         {error_message = error_message + "<p> Spouse Annual IRA Deposit entered - Spouse Current Age must be between 20 and 99.  </p>"; }

      if (form.spo_pension_amt.value != 0) 
         {error_message = error_message + "<p> Spouse Pension Spouse Annual IRA Deposit entered - Spouse Current Age must be between 20 and 99. </p>"; }

      if (form.spo_pension_begin_age.value != 0) 
         {error_message = error_message + "<p> Spouse Pension Begin Age entered - Spouse Current Age must be between 20 and 99. </p>"; }

      if (form.spo_pension_inf_pct.value != 0) 
         {error_message = error_message + "<p> Spouse Pension Inflation Adjustment entered - Spouse Current Age must be between 20 and 99. </p>"; }

      if (form.spo_pension_survivor_pct.value != 0) 
         {error_message = error_message + "<p> Spouse Pension Survivor Percent entered - Spouse Current Age must be between 20 and 99. </p>"; }

       return error_message; 
  }  
</script>

<script type="text/javascript">
 function process_form(form, fDownload_Results) {

   localStorage.setItem("SimpSim_spo_cur_age", form.spo_cur_age.value);
   localStorage.setItem("SimpSim_you_cur_age", form.you_cur_age.value);
   localStorage.setItem("SimpSim_spo_pension_begin_age", form.spo_pension_begin_age.value);
   localStorage.setItem("SimpSim_spo_pension_inf_pct", form.spo_pension_inf_pct.value);
   localStorage.setItem("SimpSim_spo_pension_survivor_pct", form.spo_pension_survivor_pct.value);
   localStorage.setItem("SimpSim_spo_retire_age", form.spo_retire_age.value);
   localStorage.setItem("SimpSim_spo_socsec_age", form.spo_socsec_age.value);
   localStorage.setItem("SimpSim_you_pension_begin_age", form.you_pension_begin_age.value);
   localStorage.setItem("SimpSim_you_pension_inf_pct", form.you_pension_inf_pct.value);
   localStorage.setItem("SimpSim_you_pension_survivor_pct", form.you_pension_survivor_pct.value);
   localStorage.setItem("SimpSim_you_retire_age", form.you_retire_age.value);
   localStorage.setItem("SimpSim_you_socsec_age", form.you_socsec_age.value);
   localStorage.setItem("SimpSim_brkrg_start_bal_amt", form.brkrg_start_bal_amt.value);
   localStorage.setItem("SimpSim_brkrg_cost_basis_amt", form.brkrg_cost_basis_amt.value);
   localStorage.setItem("SimpSim_gogo_budget_amt", form.gogo_budget_amt.value);
   localStorage.setItem("SimpSim_slowgo_budget_amt", form.slowgo_budget_amt.value);
   localStorage.setItem("SimpSim_nogo_budget_amt", form.nogo_budget_amt.value);

   localStorage.setItem("SimpSim_last3_budget_amt", form.last3_budget_amt.value);
   localStorage.setItem("SimpSim_mortgage_budget_amt", form.mortgage_budget_amt.value);
   localStorage.setItem("SimpSim_mortgage_end_age", form.mortgage_end_age.value);

   localStorage.setItem("SimpSim_spo_ira_start_bal_amt", form.spo_ira_start_bal_amt.value);
   localStorage.setItem("SimpSim_spo_pension_amt", form.spo_pension_amt.value);
   localStorage.setItem("SimpSim_spo_socsec_amt", form.spo_socsec_amt.value);
   localStorage.setItem("SimpSim_you_ira_start_bal_amt", form.you_ira_start_bal_amt.value);
   localStorage.setItem("SimpSim_you_pension_amt", form.you_pension_amt.value);
   localStorage.setItem("SimpSim_you_socsec_amt", form.you_socsec_amt.value);
   localStorage.setItem("SimpSim_bonus_pct", form.bonus_pct.value);
   localStorage.setItem("SimpSim_medb_flag", form.medb_flag.value);
   localStorage.setItem("SimpSim_stock_pct", form.stock_pct.value);
   localStorage.setItem("SimpSim_spo_retire_end_age", form.spo_retire_end_age.value);
   localStorage.setItem("SimpSim_you_retire_end_age", form.you_retire_end_age.value);
   localStorage.setItem("SimpSim_roth_start_bal_amt", form.roth_start_bal_amt.value);
   localStorage.setItem("SimpSim_roth_conv_pct", form.roth_conv_pct.value);

   localStorage.setItem("SimpSim_you_ira_ann_dep_amt", form.you_ira_ann_dep_amt.value);
   localStorage.setItem("SimpSim_spo_ira_ann_dep_amt", form.spo_ira_ann_dep_amt.value);
   localStorage.setItem("SimpSim_brkrg_ann_dep_amt", form.brkrg_ann_dep_amt.value);
   localStorage.setItem("SimpSim_roth_ann_dep_amt", form.roth_ann_dep_amt.value);

   localStorage.setItem("SimpSim_brkrg_taxable_dist_pct", form.brkrg_taxable_dist_pct.value);

   localStorage.setItem("SimpSim_baseline_stock_return_pct", form.baseline_stock_return_pct.value);
   localStorage.setItem("SimpSim_baseline_bond_return_pct", form.baseline_bond_return_pct.value);

    var fRateLen     = ratehistory.length;    

    var simulation_scenario = new Array( );
    var scenario_summary = new Array( );

    var fCurrent_Year = getcurrentyear();

    var fRowNbr      = 0;
    
    fStock_Pct    = form.stock_pct.value / 100;
    fFrm_Bonus_Pct   = form.bonus_pct.value / 100;

    fFrm_Medb_Flag = form.medb_flag.value;

    fBaseline_Stock_Return_Pct = form.baseline_stock_return_pct.value / 100;
    fBaseline_Bond_Return_Pct = form.baseline_bond_return_pct.value / 100;

    fFrm_You_Current_Age           = form.you_cur_age.value * 1;
    fFrm_You_Retire_Age            = form.you_retire_age.value * 1;

    fFrm_Spo_Current_Age           = form.spo_cur_age.value * 1;
    fFrm_Spo_Retire_Age            = form.spo_retire_age.value * 1;

    fFrm_You_Retire_End_Age                  = form.you_retire_end_age.value * 1;
    fFrm_Spo_Retire_End_Age                  = form.spo_retire_end_age.value * 1;

    fFrm_You_IRA_Start_Bal_Amt           = form.you_ira_start_bal_amt.value * 1;
    fFrm_Spo_IRA_Start_Bal_Amt           = form.spo_ira_start_bal_amt.value * 1;
    fFrm_Brkrg_Start_Bal_Amt             = form.brkrg_start_bal_amt.value * 1;
    fFrm_Brkrg_Cost_Basis_Amt            = form.brkrg_cost_basis_amt.value * 1;
    fFrm_Brkrg_Taxable_Dist_Pct          = form.brkrg_taxable_dist_pct.value / 100;
    
    fFrm_Roth_Start_Bal_Amt              = form.roth_start_bal_amt.value * 1;
    fFrm_Roth_Conv_Pct                   = form.roth_conv_pct.value;

    fFrm_You_IRA_Ann_Dep_Amt                 = form.you_ira_ann_dep_amt.value * 1;
    fFrm_Spo_IRA_Ann_Dep_Amt                 = form.spo_ira_ann_dep_amt.value * 1;
    fFrm_Brkrg_Ann_Dep_Amt                   = form.brkrg_ann_dep_amt.value * 1;
    fFrm_Roth_Ann_Dep_Amt                    = form.roth_ann_dep_amt.value * 1;

    fFrm_You_Pension_Amt                 = form.you_pension_amt.value * 1;
    fFrm_You_Pension_Begin_Age           = form.you_pension_begin_age.value * 1;
    fFrm_You_Pension_Inf_Pct             = form.you_pension_inf_pct.value / 100;
    fFrm_You_Pension_Survivor_Pct        = form.you_pension_survivor_pct.value /100;

    fFrm_Spo_Pension_Amt                 = form.spo_pension_amt.value * 1;
    fFrm_Spo_Pension_Begin_Age           = form.spo_pension_begin_age.value * 1;
    fFrm_Spo_Pension_Inf_Pct             = form.spo_pension_inf_pct.value / 100;
    fFrm_Spo_Pension_Survivor_Pct        = form.spo_pension_survivor_pct.value / 100;
 	
    fFrm_You_SocSec_Amt   = form.you_socsec_amt.value * 1;
    fFrm_Spo_SocSec_Amt   = form.spo_socsec_amt.value * 1;
    
    fFrm_You_SocSec_Age   = form.you_socsec_age.value * 1;
    fFrm_Spo_SocSec_Age   = form.spo_socsec_age.value * 1; 

    fFrm_GoGo_Budget_Amt = form.gogo_budget_amt.value * 1;
    fFrm_SlowGo_Budget_Amt = form.slowgo_budget_amt.value * 1;
    fFrm_NoGo_Budget_Amt = form.nogo_budget_amt.value * 1;
    fFrm_Last3_Budget_Amt = form.last3_budget_amt.value * 1;
      
    fFrm_Mortgage_Budget_Amt = form.mortgage_budget_amt.value * 1;
    fFrm_Mortgage_End_Age = form.mortgage_end_age.value * 1;

    fYou_Nbr_Years = fFrm_You_Retire_End_Age - fFrm_You_Current_Age;
    fSpouse_Nbr_Years = fFrm_Spo_Retire_End_Age - fFrm_Spo_Current_Age;	

    fNbr_Years = fYou_Nbr_Years;
    
    if (fSpouse_Nbr_Years > fYou_Nbr_Years) 
            {fNbr_Years = fSpouse_Nbr_Years;}   

    fYou_Remain_Years = fFrm_You_Retire_End_Age - fFrm_You_Current_Age;
    fSpo_Remain_Years = fFrm_Spo_Retire_End_Age - fFrm_Spo_Current_Age; 

    fLast_Alive = "you";
    fLast3_Start_Age = fFrm_You_Retire_End_Age - 2;
    if (fSpo_Remain_Years > fYou_Remain_Years) 
         {fLast_Alive = "spouse";
          fLast3_Start_Age = fFrm_Spo_Retire_End_Age - 2;
         }
             
    var fScenario_Nbr = 0;
    var fFailure_Nbr  = 0; 
    var fSurvive_Cnt = 0;
    
    baseline =  {year : 0, age_runout : 000, years_remain: 0, end_bal : 0};   
    sim_summary = {bl : baseline}; 
     
    fYou_RMD_Age = calc_rmd_age(fCurrent_Year, fFrm_You_Current_Age);
    fSpo_RMD_Age = calc_rmd_age(fCurrent_Year, fFrm_Spo_Current_Age); 
     
    fMax_Year = (fCurrent_Year - fNbr_Years + 10);

    infadj_std_deduct_married = 0;
    infadj_std_deduct_single = 0;
    infadj_senior_deduct_amt = 0;
      
for (var x=0; ratehistory[x].year <= fMax_Year ; x++)
  {
  
//******************************************************************************************
//*** Year 1 simulation will be the baseline plan.  Real simulations will start with year 1871.
//***
//*** Reset inflation adjusted variables back to starting for first year in scenario.
//********************************************************************************************
    if (ratehistory[x].year > 1 && ratehistory[x].year < 1871) {continue;} 

//    fProcess = "no";                                                        
//    if (ratehistory[x].year == 1) {fProcess = "yes";}
//    if (ratehistory[x].year == 1937) {fProcess = "yes";}
//    if (fProcess == "no") {continue;}
                                                              
    fInfAdj_You_SocSec_Amt   = fFrm_You_SocSec_Amt;
    fInfAdj_Spo_SocSec_Amt   = fFrm_Spo_SocSec_Amt;

    fInfAdj_GoGo_Budget_Amt = fFrm_GoGo_Budget_Amt;
    fInfAdj_SlowGo_Budget_Amt = fFrm_SlowGo_Budget_Amt;
    fInfAdj_NoGo_Budget_Amt = fFrm_NoGo_Budget_Amt;
    fInfAdj_Last3_Budget_Amt = fFrm_Last3_Budget_Amt;
      
    fMortgage_Budget_Amt = fFrm_Mortgage_Budget_Amt;
    fMortgage_End_Age = fFrm_Mortgage_End_Age;

    fInfAdj_You_Pension_Amt     = fFrm_You_Pension_Amt;
    fInfAdj_Spo_Pension_Amt     = fFrm_Spo_Pension_Amt;

    fYou_IRA_Beg_Bal_Amt   = fFrm_You_IRA_Start_Bal_Amt;
    fYou_IRA_Stock_Amt = Math.round(fYou_IRA_Beg_Bal_Amt * fStock_Pct);
    fYou_IRA_Bond_Amt = fYou_IRA_Beg_Bal_Amt - fYou_IRA_Stock_Amt;
    
    fSpo_IRA_Beg_Bal_Amt   = fFrm_Spo_IRA_Start_Bal_Amt;
    fSpo_IRA_Stock_Amt = Math.round(fSpo_IRA_Beg_Bal_Amt * fStock_Pct);
    fSpo_IRA_Bond_Amt = fSpo_IRA_Beg_Bal_Amt - fSpo_IRA_Stock_Amt;
    
    fBrkrg_Beg_Bal_Amt        = fFrm_Brkrg_Start_Bal_Amt;
    fBrkrg_Beg_Cost_Basis_Amt = fFrm_Brkrg_Cost_Basis_Amt;
    fBrkrg_Stock_Amt = Math.round(fBrkrg_Beg_Bal_Amt * fStock_Pct);
    fBrkrg_Bond_Amt = fBrkrg_Beg_Bal_Amt - fBrkrg_Stock_Amt;

    fRoth_Beg_Bal_Amt      = fFrm_Roth_Start_Bal_Amt;
    fRoth_Stock_Amt = Math.round(fRoth_Beg_Bal_Amt * fStock_Pct);
    fRoth_Bond_Amt = fRoth_Beg_Bal_Amt - fRoth_Stock_Amt;

    fYou_Age  = fFrm_You_Current_Age;
    fSpo_Age  = fFrm_Spo_Current_Age; 

    var fYear_Cnt        = 0;
    fScenario_Nbr++;

    oTax_Results = {taxable_income    : 0,
                    taxable_income_pre : 0,
                    inc_tax_amt       : 0,
                    senior_deduct_nbr : 0,
                    senior_deduct_amt : 0,
                    std_deduct_amt    : 0,
                    top_pct           : 0,
                    top_amt           : 0};
  
   oCapgains_Tax_Results = {taxable_income    : 0,
                            tax_amt           : 0};                 

   var fIRA_Distribution_Amt = 0;
   var fPension_Amt = 0;
   var fSocSec_Taxable_Amt = 0;
   var fSocSec_Taxable_Pct = 0;            
   var fAdjusted_Gross_Amt = 0;
   var fExemptions = 0; 
   var fStd_Deduct_Amt = 0;
   var fSenior_Deduct_Nbr = 0;
   var fSenior_Deduct_Amt = 0;                   
   var fTaxable_Income = 0;
   var fInc_Tax_Amt = 0;
   var fCapGains_Tax_Amt = 0;
   var fBas_End_Bal = 0;
   var fBonus_Amt = 0;
   var fBonus_Running_Total = 0;
   var fInfAdj_Budget_Running_Total = 0;

//*************************************************************************************************
//* reset inflation adjusted variables for first year in a scenario.  
//*************************************************************************************************
    infadj_std_deduct_married = stddeductmarried;
    infadj_std_deduct_single = stddeductsingle;
    infadj_senior_deduct_amt = senior_deduct_amt;

    for (ri=0; ri < TaxTableMarriedLen; ri++) 
     infadj_taxtable_married[ri] =       
        {from : taxtablemarried[ri].from, 
         thru : taxtablemarried[ri].thru};

    for (ri=0; ri < TaxTableSingleLen; ri++) 
     infadj_taxtable_single[ri] =       
        {from : taxtablesingle[ri].from, 
         thru : taxtablesingle[ri].thru};

    for (ri=0; ri < capgains_taxtable_len; ri++) 
      infadj_capgains_taxtable[ri] =       
        {from : capgains_taxtable[ri].from, 
         thru : capgains_taxtable[ri].thru}; 
    
    for (ri=0; ri < medb_premium_table_len; ri++) 
      infadj_medb_premium_table[ri] =       
        {adj_gross_from : medb_premium_table[ri].adj_gross_from, 
         adj_gross_thru : medb_premium_table[ri].adj_gross_thru,
         mthly_rate     : medb_premium_table[ri].mthly_rate}; 
                                           
                    
    
//***************************************************************************       *
//*
//* The below loop performs one time for each year in a scenario until 
//* until end of retirement or run out of money.
//*
//***************************************************************************
    for (var i=x; i <= x+fNbr_Years; i++)
       
      {
          fYear_Cnt++; 

          fYou_SocSec_Amt = 0;
          fSpo_SocSec_Amt = 0;

//*********************************************************************************************
//* if still alive and greater than social security start age, include social security benefit
//*********************************************************************************************
          if (fYou_Age >= fFrm_You_SocSec_Age)
                {fYou_SocSec_Amt = fInfAdj_You_SocSec_Amt;}
          
          if(fFrm_Spo_Current_Age > 0)
             {if (fSpo_Age >= fFrm_Spo_SocSec_Age) 
                 {fSpo_SocSec_Amt = fInfAdj_Spo_SocSec_Amt;}}
              
//****************************************************************************************************
//* if one pasess away, remaining person gets greater of your social security or spouse social security.
//*****************************************************************************************************     
          if ((fYou_Age > fFrm_You_Retire_End_Age) || (fSpo_Age > fFrm_Spo_Retire_End_Age))
             {if (fYou_SocSec_Amt >= fSpo_SocSec_Amt) 
                  {fSpo_SocSec_Amt = 0;}
              else
                  {fYou_SocSec_Amt = 0;}
             }
              
//****************************************************************************************************
//* if simulation includes a spouse and if one has passed away mid scenario, budget will be reduced to 75%
//*****************************************************************************************************     
          fBudget_Adj_Pct = cBudget_Full * 1;  
          if (fFrm_Spo_Current_Age > 0 && fSpo_Age > fFrm_Spo_Retire_End_Age) {fBudget_Adj_Pct = cBudget_Single_Adj * 1;}
          if (fYou_Age > fFrm_You_Retire_End_Age) {fBudget_Adj_Pct = cBudget_Single_Adj * 1;}

//*******************************************************************************************
//* calculate medb premium.  cannot do for year 1 of scenario because need previous year adjusted gross
//*******************************************************************************************
          fMedb_Premium_Amt = 0;
    
          if (fYear_Cnt > 1)
            {if (fFrm_Medb_Flag == "YES")   
              {fMedb_Premium_Amt = 
                 calc_medb_premium(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fFrm_You_Retire_End_Age, fSpo_Age, fFrm_Spo_Retire_End_Age, fFrm_Spo_Current_Age);}
            }
    
//********************************************************************************************************
//* determine if pension applies
//******************************************************************************************************

          var fUse_You_Pension_Amt = 0; 
          if (fFrm_You_Pension_Begin_Age > 0 && fYou_Age >= fFrm_You_Pension_Begin_Age) 
               {fUse_You_Pension_Amt = fInfAdj_You_Pension_Amt;
                if (fYou_Age > fFrm_You_Retire_End_Age)              
                    { fUse_You_Pension_Amt = 
                      Math.round(fUse_You_Pension_Amt * fFrm_You_Pension_Survivor_Pct);}                
               }

          var fUse_Spo_Pension_Amt = 0; 
          if (fFrm_Spo_Pension_Begin_Age > 0 && fSpo_Age >= fFrm_Spo_Pension_Begin_Age) 
               {fUse_Spo_Pension_Amt = fInfAdj_Spo_Pension_Amt;
                if (fSpo_Age > fFrm_Spo_Retire_End_Age)              
                    { fUse_Spo_Pension_Amt = 
                      Math.round(fUse_Spo_Pension_Amt * fFrm_Spo_Pension_Survivor_Pct);}                
               }

//*******************************************************************************************************************
//* start drawing down when both you and spouse have retired.
//* if drawing down, determine if go-go, slow-go, or no-go budget is being used
//* Total need to draw = Budget + Bonus + Income Tax + Capital gains tax - social security - pension
//********************************************************************************************************************
         fInfAdj_Budget_Amt = 0;
         fTotal_Need_Amt = 0;
         fUse_Mortgage_Budget_Amt = 0;
         fRetired_Flag = "NO";
    
         if (fFrm_Spo_Current_Age > 0)
              {if (fYou_Age >= fFrm_You_Retire_Age && fSpo_Age >= fFrm_Spo_Retire_Age) 
                 {fRetired_Flag = "YES";}}
         
         if (fFrm_Spo_Current_Age == 0)
              {if (fYou_Age >= fFrm_You_Retire_Age) 
                 {fRetired_Flag = "YES";}}
             
         if (fRetired_Flag == "YES")
             {
               if (fYou_Age <= fMortgage_End_Age) {fUse_Mortgage_Budget_Amt = fMortgage_Budget_Amt;}
               
               fInfAdj_Budget_Amt = fInfAdj_GoGo_Budget_Amt;
               if (fYou_Age >= 75) {fInfAdj_Budget_Amt = fInfAdj_SlowGo_Budget_Amt;}
               if (fYou_Age >= 85) {fInfAdj_Budget_Amt = fInfAdj_NoGo_Budget_Amt;}
               if (fLast_Alive == "you" && fYou_Age >= fLast3_Start_Age) {fInfAdj_Budget_Amt = fInfAdj_Last3_Budget_Amt;}
               if (fLast_Alive == "spouse" && fSpo_Age >= fLast3_Start_Age) {fInfAdj_Budget_Amt = fInfAdj_Last3_Budget_Amt;}
               
               fInfAdj_Budget_Amt = Math.round(fInfAdj_Budget_Amt * fBudget_Adj_Pct);  // make adjustment if one if deceased
               fTotal_Need_Amt = fInfAdj_Budget_Amt + fUse_Mortgage_Budget_Amt + fBonus_Amt + fInc_Tax_Amt + fCapGains_Tax_Amt + fMedb_Premium_Amt 
                                 - fYou_SocSec_Amt - fSpo_SocSec_Amt 
                                 - fUse_You_Pension_Amt - fUse_Spo_Pension_Amt;
            }
//***********************************************************
//* determine # exemptions for tax purposes
//***********************************************************
          fExemptions = 1;

          fYou_Years_Deceased = 0;
          if (fYou_Age > fFrm_You_Retire_End_Age) {fYou_Years_Deceased = fYou_Age - fFrm_You_Retire_End_Age;}

          fSpo_Years_Deceased = 0;
          if (fSpo_Age > fFrm_Spo_Retire_End_Age) {fSpo_Years_Deceased = fSpo_Age - fFrm_Spo_Retire_End_Age;}

          if (fYou_Years_Deceased < 2 && fSpo_Years_Deceased <2 && fFrm_Spo_Current_Age > 0)
              {fExemptions++;}
                   
          fPension_Amt = fUse_You_Pension_Amt + fUse_Spo_Pension_Amt;
          fSocSec_Total_Amt = fYou_SocSec_Amt + fSpo_SocSec_Amt;
 
//***************************************************************************
//* determine how much to draw from each account 
//****************************************************************************
                   
          fRemain_Need_Amt = fTotal_Need_Amt;

          fYou_RMD_Draw_Amt = calc_rmd(fYou_Age, fYou_IRA_Beg_Bal_Amt, fYou_RMD_Age);  // you RMD
          fYou_IRA_End_Bal_Amt1 = fYou_IRA_Beg_Bal_Amt - fYou_RMD_Draw_Amt;     
          
          fSpo_RMD_Draw_Amt = calc_rmd(fSpo_Age, fSpo_IRA_Beg_Bal_Amt, fSpo_RMD_Age);  // spouse RMD
          fSpo_IRA_End_Bal_Amt1 = fSpo_IRA_Beg_Bal_Amt - fSpo_RMD_Draw_Amt;
      
          fRemain_Need_Amt = fRemain_Need_Amt - fYou_RMD_Draw_Amt - fSpo_RMD_Draw_Amt;   
        
          fBrkrg_Draw_Amt = Math.min(fRemain_Need_Amt, fBrkrg_Beg_Bal_Amt);
          fBrkrg_End_Bal_Amt1 = fBrkrg_Beg_Bal_Amt - fBrkrg_Draw_Amt;        
          fRemain_Need_Amt = fRemain_Need_Amt - fBrkrg_Draw_Amt;

          fYou_IRA_Addl_Draw_Amt = Math.min(fRemain_Need_Amt, fYou_IRA_End_Bal_Amt1);
          fYou_IRA_End_Bal_Amt1 = fYou_IRA_End_Bal_Amt1 - fYou_IRA_Addl_Draw_Amt; 
          fRemain_Need_Amt = fRemain_Need_Amt - fYou_IRA_Addl_Draw_Amt;    
                   
          fSpo_IRA_Addl_Draw_Amt = Math.min(fRemain_Need_Amt, fSpo_IRA_End_Bal_Amt1);
          fSpo_IRA_End_Bal_Amt1 = fSpo_IRA_End_Bal_Amt1 - fSpo_IRA_Addl_Draw_Amt;
          fRemain_Need_Amt = fRemain_Need_Amt - fSpo_IRA_Addl_Draw_Amt;
                   
          fRoth_Draw_Amt1 = Math.min(fRemain_Need_Amt, fRoth_Beg_Bal_Amt);
          fRoth_End_Bal_Amt1 = fRoth_Beg_Bal_Amt - fRoth_Draw_Amt1;           
          fRemain_Need_Amt = fRemain_Need_Amt - fRoth_Draw_Amt1;    
                   
//***************************************************************************
//* see if roth conversion viable.  
//***************************************************************************                   

          fMax_Taxable_Income = 0;
          if (fExemptions ==2)
             {      
              if (fFrm_Roth_Conv_Pct == 10) fMax_Taxable_Income = infadj_taxtable_married[0].thru;   
              if (fFrm_Roth_Conv_Pct == 12) fMax_Taxable_Income = infadj_taxtable_married[1].thru;
             }
        
           if (fExemptions ==1)
             {      
              if (fFrm_Roth_Conv_Pct == 10) fMax_Taxable_Income = infadj_taxtable_single[0].thru;   
              if (fFrm_Roth_Conv_Pct == 12) fMax_Taxable_Income = infadj_taxtable_single[1].thru;
             }
        
                   
//**********************************************************************
//* preliminary calculate taxes to help determine if roth conversion viable
//**********************************************************************
                   
          fIRA_Distribution_Amt = fYou_RMD_Draw_Amt + fYou_IRA_Addl_Draw_Amt + fSpo_RMD_Draw_Amt + fSpo_IRA_Addl_Draw_Amt;
    
          fBrkrg_Taxable_Dist_Amt = Math.round((fBrkrg_Beg_Bal_Amt - fBrkrg_Draw_Amt) * fFrm_Brkrg_Taxable_Dist_Pct);
                   
          fIncome_Less_SS = fIRA_Distribution_Amt + fPension_Amt + fBrkrg_Taxable_Dist_Amt;

          fSocSec_Taxable_Amt = calc_socsec_taxable_func(fIncome_Less_SS, fSocSec_Total_Amt, fExemptions);                 
          fSocSec_Taxable_Pct = 0;
          if (fSocSec_Total_Amt > 0) {fSocSec_Taxable_Pct = Math.round((fSocSec_Taxable_Amt / fSocSec_Total_Amt)*100);}

          fAdjusted_Gross_Amt = fIncome_Less_SS + fSocSec_Taxable_Amt;

          oTax_Results =          calc_income_tax(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fSpo_Age);
          
          fRoth_Conv_Amt = fMax_Taxable_Income - oTax_Results.taxable_income_pre;
        
          fYou_Roth_Conv_Amt = 0;
          fSpo_Roth_Conv_Amt = 0;
                   
          if (fFrm_Roth_Conv_Pct != 'none' && fRemain_Need_Amt == 0 && fRoth_Conv_Amt > 0 && fInfAdj_Budget_Amt > 0)
             {
              fYou_Roth_Conv_Amt = Math.min(fRoth_Conv_Amt, fYou_IRA_End_Bal_Amt1);
              fYou_IRA_Addl_Draw_Amt = fYou_IRA_Addl_Draw_Amt + fYou_Roth_Conv_Amt;
              fYou_IRA_End_Bal_Amt1 = fYou_IRA_End_Bal_Amt1 - fYou_Roth_Conv_Amt;       
              fRoth_Draw_Amt1 = fRoth_Draw_Amt1 - fYou_Roth_Conv_Amt;       
              fRoth_End_Bal_Amt1 = fRoth_End_Bal_Amt1 + fYou_Roth_Conv_Amt;
                   
              fRoth_Conv_Amt = fRoth_Conv_Amt - fYou_Roth_Conv_Amt;
              
              fSpo_Roth_Conv_Amt = Math.min(fRoth_Conv_Amt, fSpo_IRA_End_Bal_Amt1);
              fSpo_IRA_Addl_Draw_Amt = fSpo_IRA_Addl_Draw_Amt + fSpo_Roth_Conv_Amt;
              fSpo_IRA_End_Bal_Amt1 = fSpo_IRA_End_Bal_Amt1 - fSpo_Roth_Conv_Amt;
              fRoth_Draw_Amt1 = fRoth_Draw_Amt1 - fSpo_Roth_Conv_Amt;       
              fRoth_End_Bal_Amt1 = fRoth_End_Bal_Amt1 + fSpo_Roth_Conv_Amt;
            }

//**********************************************************************
//* final tax calculation.  taxes will be included in the budget for next year.
//**********************************************************************
                   
          fIRA_Distribution_Amt = fYou_RMD_Draw_Amt + fYou_IRA_Addl_Draw_Amt + fSpo_RMD_Draw_Amt + fSpo_IRA_Addl_Draw_Amt;
    
          fBrkrg_Taxable_Dist_Amt = Math.round((fBrkrg_Beg_Bal_Amt - fBrkrg_Draw_Amt) * fFrm_Brkrg_Taxable_Dist_Pct);
                   
          fIncome_Less_SS = fIRA_Distribution_Amt + fPension_Amt + fBrkrg_Taxable_Dist_Amt;

          fSocSec_Taxable_Amt = calc_socsec_taxable_func(fIncome_Less_SS, fSocSec_Total_Amt, fExemptions);                 
          fSocSec_Taxable_Pct = 0;
          if (fSocSec_Total_Amt > 0) {fSocSec_Taxable_Pct = Math.round((fSocSec_Taxable_Amt / fSocSec_Total_Amt)*100);}

          fAdjusted_Gross_Amt = fIncome_Less_SS + fSocSec_Taxable_Amt;

          oTax_Results =          calc_income_tax(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fSpo_Age);
                   
          fCurYr_Taxable_Income = oTax_Results.taxable_income;
          fCurYr_Inc_Tax_Amt = oTax_Results.inc_tax_amt;

          fSenior_Deduct_Nbr = oTax_Results.senior_deduct_nbr; 
          fSenior_Deduct_Amt = oTax_Results.senior_deduct_amt;
          fStd_Deduct_Amt    = oTax_Results.std_deduct_amt;

//**************************************************************************************************************************************             
//*   adjust cost basis if updating brokerage balance       
//************************************************************************************************************************************       
         
          fBrkrg_Adj_Cost_Basis_Amt = 0;

          if (fBrkrg_Beg_Bal_Amt != 0 && fBrkrg_Draw_Amt > 0) 
             {fBrkrg_Adj_Cost_Basis_Amt = (Math.round((fBrkrg_Draw_Amt / fBrkrg_Beg_Bal_Amt) * 
                                           fBrkrg_Beg_Cost_Basis_Amt))*-1;}
          if (fBrkrg_Draw_Amt < 0) 
             {fBrkrg_Adj_Cost_Basis_Amt = fBrkrg_Draw_Amt * -1;}
          
           
//*************************************************************************************
//* calculate capital gains tax
//************************************************************************************
          
          fCapgains_Amt = 0;
          fCurYr_CapGains_Tax_Amt = 0;
          if (fBrkrg_Draw_Amt > 0) 
             {fCapgains_Amt = fBrkrg_Draw_Amt + fBrkrg_Adj_Cost_Basis_Amt;    
              oCapgains_Tax_Results = calc_capgains_tax(fAdjusted_Gross_Amt, 
                                                        fStd_Deduct_Amt + fSenior_Deduct_Amt, 
                                                        fCapgains_Amt, 
                                                        fExemptions);
              fCurYr_CapGains_Tax_Amt = oCapgains_Tax_Results.tax_amt
             }
               

//**************************************************************************************************************************************             
//* calculate gains, add deposits, and rebalance
//************************************************************************************************************************************       
          fYou_IRA_Ann_Dep_Amt = 0;
          fSpo_IRA_Ann_Dep_Amt = 0;
          fBrkrg_Ann_Dep_Amt = 0;
          fRoth_Ann_Dep_Amt = 0;

          if(fYou_Age < fFrm_You_Retire_Age) {fYou_IRA_Ann_Dep_Amt = fFrm_You_IRA_Ann_Dep_Amt;}
          if(fSpo_Age < fFrm_Spo_Retire_Age) {fSpo_IRA_Ann_Dep_Amt = fFrm_Spo_IRA_Ann_Dep_Amt;}
          if(fYou_Age < fFrm_You_Retire_Age) {fBrkrg_Ann_Dep_Amt = fFrm_Brkrg_Ann_Dep_Amt;}
          if(fYou_Age < fFrm_You_Retire_Age) {fRoth_Ann_Dep_Amt = fFrm_Roth_Ann_Dep_Amt;}
                                  
//***********************************************************************************************************************    
//* 1) reallocate 2) calculate gain 3) add deposit and gains 4) reallocate again
//* 
//* if testing year 1 (baseline plan), baseline rates can be overriden by user.
//***********************************************************************************************************************
    
          if (ratehistory[x].year == 1) 
               {
                ratehistory[i].stockret = fBaseline_Stock_Return_Pct;
                ratehistory[i].bondret = fBaseline_Bond_Return_Pct;
               }

// rebalance at beginning of each year 
          fYou_IRA_Stock_Amt = Math.round(fYou_IRA_End_Bal_Amt1 * fStock_Pct);
          fYou_IRA_Bond_Amt = fYou_IRA_End_Bal_Amt1 - fYou_IRA_Stock_Amt;
//calculate return          
          fYou_IRA_Gain_Stock_Amt = Math.round(fYou_IRA_Stock_Amt * ratehistory[i].stockret);
          fYou_IRA_Gain_Bond_Amt  = Math.round(fYou_IRA_Bond_Amt * ratehistory[i].bondret);
          fYou_IRA_End_Bal_Amt2 = fYou_IRA_End_Bal_Amt1 + fYou_IRA_Gain_Stock_Amt + fYou_IRA_Gain_Bond_Amt
                                + fYou_IRA_Ann_Dep_Amt;
// rebalance after return calculated         
          fYou_IRA_Stock_Amt = Math.round(fYou_IRA_End_Bal_Amt2 * fStock_Pct);
          fYou_IRA_Bond_Amt = fYou_IRA_End_Bal_Amt2 - fYou_IRA_Stock_Amt;
                                   
          fSpo_IRA_Stock_Amt = Math.round(fSpo_IRA_End_Bal_Amt1 * fStock_Pct);
          fSpo_IRA_Bond_Amt = fSpo_IRA_End_Bal_Amt1 - fSpo_IRA_Stock_Amt;      
          fSpo_IRA_Gain_Stock_Amt = Math.round(fSpo_IRA_Stock_Amt * ratehistory[i].stockret);
          fSpo_IRA_Gain_Bond_Amt  = Math.round(fSpo_IRA_Bond_Amt * ratehistory[i].bondret);
          fSpo_IRA_End_Bal_Amt2 = fSpo_IRA_End_Bal_Amt1 + fSpo_IRA_Gain_Stock_Amt + fSpo_IRA_Gain_Bond_Amt
                                + fSpo_IRA_Ann_Dep_Amt;
          fSpo_IRA_Stock_Amt = Math.round(fSpo_IRA_End_Bal_Amt2 * fStock_Pct);
          fSpo_IRA_Bond_Amt = fSpo_IRA_End_Bal_Amt2 - fSpo_IRA_Stock_Amt;
      
          fBrkrg_Stock_Amt = Math.round(fBrkrg_End_Bal_Amt1 * fStock_Pct);
          fBrkrg_Bond_Amt = fBrkrg_End_Bal_Amt1 - fBrkrg_Stock_Amt;
          fBrkrg_Gain_Stock_Amt = Math.round(fBrkrg_Stock_Amt * ratehistory[i].stockret);
          fBrkrg_Gain_Bond_Amt  = Math.round(fBrkrg_Bond_Amt * ratehistory[i].bondret);
          fBrkrg_End_Bal_Amt2 = fBrkrg_End_Bal_Amt1 + fBrkrg_Gain_Stock_Amt + fBrkrg_Gain_Bond_Amt
                                + fBrkrg_Ann_Dep_Amt;
          fBrkrg_Stock_Amt = Math.round(fBrkrg_End_Bal_Amt2 * fStock_Pct);
          fBrkrg_Bond_Amt = fBrkrg_End_Bal_Amt2 - fBrkrg_Stock_Amt;
          
          fBrkrg_End_Cost_Basis_Amt = fBrkrg_Beg_Cost_Basis_Amt + fBrkrg_Adj_Cost_Basis_Amt + fBrkrg_Ann_Dep_Amt;                                
                                        
          fRoth_Stock_Amt = Math.round(fRoth_End_Bal_Amt1 * fStock_Pct);
          fRoth_Bond_Amt = fRoth_End_Bal_Amt1 - fRoth_Stock_Amt;      
          fRoth_Gain_Stock_Amt = Math.round(fRoth_Stock_Amt * ratehistory[i].stockret);
          fRoth_Gain_Bond_Amt  = Math.round(fRoth_Bond_Amt * ratehistory[i].bondret);
          fRoth_End_Bal_Amt2 = fRoth_End_Bal_Amt1 + fRoth_Gain_Stock_Amt + fRoth_Gain_Bond_Amt
                                + fRoth_Ann_Dep_Amt;
          fRoth_Stock_Amt = Math.round(fRoth_End_Bal_Amt2 * fStock_Pct);
          fRoth_Bond_Amt = fRoth_End_Bal_Amt2 - fRoth_Stock_Amt;
                
          fBeg_Bal = fYou_IRA_Beg_Bal_Amt + fSpo_IRA_Beg_Bal_Amt + fBrkrg_Beg_Bal_Amt + fRoth_Beg_Bal_Amt;
          fEnd_Bal = fYou_IRA_End_Bal_Amt2 + fSpo_IRA_End_Bal_Amt2 + fBrkrg_End_Bal_Amt2 + fRoth_End_Bal_Amt2;

          fTotal_Draw_Amt = fYou_RMD_Draw_Amt + fYou_IRA_Addl_Draw_Amt + fSpo_RMD_Draw_Amt + fSpo_IRA_Addl_Draw_Amt +
                            fBrkrg_Draw_Amt + fRoth_Draw_Amt1;
                                        
          fTotal_Ann_Dep_Amt = fYou_IRA_Ann_Dep_Amt + fSpo_IRA_Ann_Dep_Amt +
                            fBrkrg_Ann_Dep_Amt + fRoth_Ann_Dep_Amt;

          fTotal_Gain_Amt = fYou_IRA_Gain_Stock_Amt + fYou_IRA_Gain_Bond_Amt + 
                            fSpo_IRA_Gain_Stock_Amt + fSpo_IRA_Gain_Bond_Amt +
                            fBrkrg_Gain_Stock_Amt + fBrkrg_Gain_Bond_Amt + 
                            fRoth_Gain_Stock_Amt + fRoth_Gain_Bond_Amt;  
       
          fBas_End_Bal = 0;
          fBas_Diff = 0;
          if (ratehistory[x].year > 1) 
            {fBas_End_Bal = simulation_scenario[fYear_Cnt-1].end_bal
             if (fEnd_Bal > fBas_End_Bal)
                {fBas_Diff = fEnd_Bal - fBas_End_Bal;}
            }

          fBonus_Running_Total = fBonus_Running_Total + fBonus_Amt;
          fInfAdj_Budget_Running_Total = fInfAdj_Budget_Running_Total + fInfAdj_Budget_Amt + fUse_Mortgage_Budget_Amt;
        
//**********************************************************************************
//* compute a score for the scenario.  used to determine best, worst and median scenarios
//***********************************************************************************
          fScore_Age = (fYou_Age * 1000000000000) 
          
          fScore_Survived = 0;            
          if (fEnd_Bal > 0 ) {fScore_Survived = 1000000000;}
          
          fScore_Bonus = 0;
          if (fInfAdj_Budget_Running_Total > 0) {fScore_Bonus = Math.round((fBonus_Running_Total / fInfAdj_Budget_Running_Total) * 1000000);}
                   
          fScore_Years_Remain = 0;
          if (fTotal_Draw_Amt > 0) {fScore_Years_Remain = Math.round(fEnd_Bal / fTotal_Draw_Amt) * 1000;}
                     
          fScenario_Score =  fScore_Age + fScore_Survived + fScore_Bonus + fScore_Years_Remain;   
                            
//**************************************************************************************
//* save scenario / year calculation results
//**************************************************************************************
          simulation_scenario[fRowNbr] = 
                       {scenario_year :ratehistory[x].year,
                        year:    ratehistory[i].year,
                        you_age: fYou_Age,
                        spouse_age: fSpo_Age,
                        scenario_nbr: fScenario_Nbr,
                        yearcnt: fYear_Cnt,
                        budgetadj : fBudget_Adj_Pct,
                        infadj_budget_amt : fInfAdj_Budget_Amt,
                        infadj_budget_running_total : fInfAdj_Budget_Running_Total,
                        mortgage_budget_amt : fUse_Mortgage_Budget_Amt,

                        you_pension_amt : fUse_You_Pension_Amt,
                        spo_pension_amt : fUse_Spo_Pension_Amt,
                         
                        exemptions: fExemptions, 
                    
                        inc_tax_amt : fInc_Tax_Amt, 
                        capgains_tax_amt : fCapGains_Tax_Amt,
                        
                        curyr_inc_tax_amt : fCurYr_Inc_Tax_Amt,
                        curyr_taxable_income : fCurYr_Taxable_Income, 
                        
                        curyr_capgains_amt : fCapgains_Amt,
    
                        curyr_capgains_tax_amt : fCurYr_CapGains_Tax_Amt,
                    
                        you_socsec_amt: fYou_SocSec_Amt,
                        spo_socsec_amt: fSpo_SocSec_Amt,
    
                        medb_premium_amt: fMedb_Premium_Amt,

                        total_need_amt      : fTotal_Need_Amt,
                        remain_need_amt     : fRemain_Need_Amt,

                        you_ira_beg_bal_amt   : fYou_IRA_Beg_Bal_Amt,
                        you_rmd_draw_amt      : fYou_RMD_Draw_Amt,
                        you_ira_addl_draw_amt : fYou_IRA_Addl_Draw_Amt,
                        you_ira_gain_amt      : fYou_IRA_Gain_Stock_Amt + fYou_IRA_Gain_Bond_Amt,
                        you_ira_ann_dep_amt   : fYou_IRA_Ann_Dep_Amt,
                        you_ira_end_bal_amt   : fYou_IRA_End_Bal_Amt2,

                        spo_ira_beg_bal_amt   : fSpo_IRA_Beg_Bal_Amt,
                        spo_rmd_draw_amt      : fSpo_RMD_Draw_Amt,
                        spo_ira_addl_draw_amt : fSpo_IRA_Addl_Draw_Amt,
                        spo_ira_gain_amt      : fSpo_IRA_Gain_Stock_Amt + fSpo_IRA_Gain_Bond_Amt,
                        spo_ira_ann_dep_amt   : fSpo_IRA_Ann_Dep_Amt,
                        spo_ira_end_bal_amt   : fSpo_IRA_End_Bal_Amt2,

                        brkrg_beg_bal_amt  : fBrkrg_Beg_Bal_Amt,
                        brkrg_draw_amt    : fBrkrg_Draw_Amt,
                        brkrg_gain_amt     : fBrkrg_Gain_Stock_Amt + fBrkrg_Gain_Bond_Amt,
                        brkrg_ann_dep_amt   : fBrkrg_Ann_Dep_Amt,
                        brkrg_end_bal_amt  : fBrkrg_End_Bal_Amt2,
    
                        brkrg_beg_cost_basis_amt : fBrkrg_Beg_Cost_Basis_Amt,
                        brkrg_adj_cost_basis_amt : fBrkrg_Adj_Cost_Basis_Amt,
                        brkrg_end_cost_basis_amt : fBrkrg_End_Cost_Basis_Amt,
          
                        roth_beg_bal_amt  : fRoth_Beg_Bal_Amt,
                        roth_draw_amt1    : fRoth_Draw_Amt1,
                        roth_gain_amt     : fRoth_Gain_Stock_Amt + fRoth_Gain_Bond_Amt,
                        roth_ann_dep_amt   : fRoth_Ann_Dep_Amt,
                        roth_end_bal_amt  : fRoth_End_Bal_Amt2,

                        beg_bal            : fBeg_Bal,  
                        total_draw_amt    : fTotal_Draw_Amt,
                        total_gain_amt    : fTotal_Gain_Amt,
                        total_ann_dep_amt : fTotal_Ann_Dep_Amt,
                        end_bal            : fEnd_Bal,
                        bas_end_bal        : fBas_End_Bal,
                        bonus_amt          : fBonus_Amt,
                        bonus_running_total : fBonus_Running_Total, 
    
                        you_roth_conv_amt : fYou_Roth_Conv_Amt,
                        spo_roth_conv_amt : fSpo_Roth_Conv_Amt,

                        scenario_score      : fScenario_Score,

                        stockret:  ratehistory[i].stockret,
                        bondret:   ratehistory[i].bondret,
                        infrate: ratehistory[i].infrate,

                        
                        ira_distribution_amt: fIRA_Distribution_Amt,
                        pension_amt         : fPension_Amt,
                        socsec_taxable_amt  : fSocSec_Taxable_Amt,
                        socsec_taxable_pct  : fSocSec_Taxable_Pct,            
                        adjusted_gross_amt  : fAdjusted_Gross_Amt,
                        brkrg_taxable_dist_amt : fBrkrg_Taxable_Dist_Amt,
                        std_deduct_nbr      : fExemptions, 
                        std_deduct_amt      : fStd_Deduct_Amt,
                        senior_deduct_nbr  : fSenior_Deduct_Nbr,
                        senior_deduct_amt   : fSenior_Deduct_Amt,                   
                        
                        std_deduct_married : infadj_std_deduct_married,
                        std_deduct_single  : infadj_std_deduct_single,
                        taxtablemarried0 : infadj_taxtable_married[0].thru,
                        taxtablemarried1 : infadj_taxtable_married[1].thru,
                        taxtablemarried2 : infadj_taxtable_married[2].thru,
                        taxtablemarried3 : infadj_taxtable_married[3].thru,
                        taxtablemarried4 : infadj_taxtable_married[4].thru,
                        taxtablemarried5 : infadj_taxtable_married[5].thru,
                        taxtablemarried6 : infadj_taxtable_married[6].thru,
                        taxtablesingle0 : infadj_taxtable_single[0].thru,
                        taxtablesingle1 : infadj_taxtable_single[1].thru,
                        taxtablesingle2 : infadj_taxtable_single[2].thru,
                        taxtablesingle3 : infadj_taxtable_single[3].thru,
                        taxtablesingle4 : infadj_taxtable_single[4].thru,
                        taxtablesingle5 : infadj_taxtable_single[5].thru,
                        taxtablesingle6 : infadj_taxtable_single[6].thru,
                        captaxtable0_file_status : infadj_capgains_taxtable[0].file_status,
                        captaxtable0_thru : infadj_capgains_taxtable[0].thru,
                        captaxtable1_file_status : infadj_capgains_taxtable[1].file_status,
                        captaxtable1_thru : infadj_capgains_taxtable[1].thru,
                        captaxtable2_file_status : infadj_capgains_taxtable[2].file_status,
                        captaxtable2_thru : infadj_capgains_taxtable[2].thru,
                        captaxtable3_file_status : infadj_capgains_taxtable[3].file_status,
                        captaxtable3_thru : infadj_capgains_taxtable[3].thru,
                        captaxtable4_file_status : infadj_capgains_taxtable[4].file_status,
                        captaxtable4_thru : infadj_capgains_taxtable[4].thru,
                        captaxtable5_file_status : infadj_capgains_taxtable[5].file_status,
                        captaxtable5_thru : infadj_capgains_taxtable[5].thru,
                        
                       };

//**********************************************************************************
//* current yr taxes will be included in budget for next year.
//**********************************************************************************

         fInc_Tax_Amt = fCurYr_Inc_Tax_Amt;
         fCapGains_Tax_Amt = fCurYr_CapGains_Tax_Amt;                   
                   
//*************************************************************************************
//* calculate bonus amount
//************************************************************************************
           fBonus_Amt = 0;
           if (fTotal_Need_Amt > 0) {fBonus_Amt = Math.round(fBas_Diff * fFrm_Bonus_Pct);}
   
//************************************************************************
//* inflation adjustments : social security, budget, pension, tax tables 
//************************************************************************

          fInfAdj_You_SocSec_Amt  = Math.round(fInfAdj_You_SocSec_Amt * (1+ratehistory[i].infrate));
          fInfAdj_Spo_SocSec_Amt  = Math.round(fInfAdj_Spo_SocSec_Amt * (1+ratehistory[i].infrate));

          fInfAdj_GoGo_Budget_Amt = Math.round(fInfAdj_GoGo_Budget_Amt  * (1+ratehistory[i].infrate));
          fInfAdj_SlowGo_Budget_Amt = Math.round(fInfAdj_SlowGo_Budget_Amt  * (1+ratehistory[i].infrate));
          fInfAdj_NoGo_Budget_Amt = Math.round(fInfAdj_NoGo_Budget_Amt  * (1+ratehistory[i].infrate));
          fInfAdj_Last3_Budget_Amt = Math.round(fInfAdj_Last3_Budget_Amt  * (1+ratehistory[i].infrate));

          if (fFrm_You_Pension_Begin_Age > 0 && fYou_Age >= fFrm_You_Pension_Begin_Age)  
               {fInfAdj_You_Pension_Amt = Math.round(fInfAdj_You_Pension_Amt * (1+fFrm_You_Pension_Inf_Pct));}

          if (fFrm_Spo_Pension_Begin_Age > 0 && fSpo_Age >= fFrm_Spo_Pension_Begin_Age)
             {fInfAdj_Spo_Pension_Amt = Math.round(fInfAdj_Spo_Pension_Amt * (1+fFrm_Spo_Pension_Inf_Pct));}
       
          infadj_tax_variables_func(ratehistory[i].infrate);          

//************************************************************************
//* set beginning balances for next year from ending balance in current year 
//************************************************************************          
          fYou_IRA_Beg_Bal_Amt = fYou_IRA_End_Bal_Amt2;
          fSpo_IRA_Beg_Bal_Amt = fSpo_IRA_End_Bal_Amt2;
          fBrkrg_Beg_Bal_Amt = fBrkrg_End_Bal_Amt2;
          fBrkrg_Beg_Cost_Basis_Amt = fBrkrg_End_Cost_Basis_Amt;
          fRoth_Beg_Bal_Amt = fRoth_End_Bal_Amt2;
                   
          fRowNbr++;
          fYou_Age++;
          if (fFrm_Spo_Current_Age > 0) {fSpo_Age++};

//***********************************************************************************************
//* if total ending balance for this scneario is <= 0, means scenario failed to reach end of retirement.
//* finish this scenario and go to next scenario.
//************************************************************************************************
          if (fEnd_Bal <= 0)
            {
               scenario_summary[fScenario_Nbr-1] = simulation_scenario[fRowNbr-1];
               fFailure_Nbr = fFailure_Nbr + 1;
               break;
            } 
        
      }
//***********************************************************************************************
//* if falls out of inside loop, means scenario got to retirement end age without running out of money.  
//************************************************************************************************
         fSurvive_Cnt++;
         scenario_summary[fScenario_Nbr-1] = simulation_scenario[fRowNbr-1];   
   }  

//***********************************************************************************************
//* if falls out of outside loop, means all scenarios simulated - now time to report results.
//************************************************************************************************
    
    var today = new Date();
    var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
    var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
    var dateTime = date+' '+time;

    var fSuccessNbr = fScenario_Nbr - fFailure_Nbr;
    var fSuccessRate = Math.round((fSuccessNbr / fScenario_Nbr) * 100);

    var TableResults = "<h3> RPS Simulation Results - " + dateTime + "</h3>";

    TableResults = TableResults + fScenario_Nbr + " scenarios simulated ";  
    TableResults = TableResults + " of which " + fSuccessNbr + " passed for a success rate of ";
    TableResults = TableResults + fSuccessRate + "%.  Scenario test is considered successful if ending balance is greater than zero at the end of the scenario simulation. </p>";   

//*****************************************************************************************
//* sort scenario summary results worst to best
//****************************************************************************************    
    scenario_summary.sort(function(a, b){return a.scenario_score - b.scenario_score});

    fMedian_Scenario = Math.round(fScenario_Nbr / 2);
    if (scenario_summary[fMedian_Scenario].scenario_year == 1) {fMedian_Scenario++;}

    fWorst_Case_Scenario = 0;
    if (scenario_summary[fWorst_Case_Scenario].scenario_year == 1) {fWorst_Case_Scenario++;}
    
    fBest_Case_Scenario = fScenario_Nbr - 1; 
    if (scenario_summary[fBest_Case_Scenario].scenario_year == 1) {fMedian_Scenario--;}

    fWorst_Year=scenario_summary[fWorst_Case_Scenario].scenario_year;
    fBest_Year=scenario_summary[fBest_Case_Scenario].scenario_year;
    fMedian_Year=scenario_summary[fMedian_Scenario].scenario_year;

    fMost_Recent_Year = fCurrent_Year - fNbr_Years - 1;      
    
    TableResults = TableResults + set_table_style();
    
    TableResults = show_scenario_summary(TableResults, scenario_summary, fFrm_You_Retire_End_Age, fNbr_Years,fWorst_Year,fBest_Year,fMedian_Year, fMost_Recent_Year);
    
    if (fDownload_Results == "YES")
         {download_simulation_result_summary(scenario_summary, fFrm_You_Retire_End_Age, fNbr_Years); }
       
    TableResults = showdetails(TableResults,simulation_scenario, 1);

    TableResults = showdetails(TableResults,simulation_scenario, fWorst_Year);
 
    TableResults = showdetails(TableResults,simulation_scenario, fMedian_Year);
  
    TableResults = showdetails(TableResults,simulation_scenario, fBest_Year);
     
    TableResults = showdetails(TableResults,simulation_scenario, fMost_Recent_Year);

    openWin(TableResults);   
   
    document.getElementById("showresults").innerHTML = " ";
    
//    window.scrollTo(0, 700);
    
   if (fDownload_Results == "YES")
        {download_simulation_result_detail(simulation_scenario); }
    
 }
</script>

<script>

function openWin(TableResults) {
try {
  myWindow.close();
 }
  catch (err)
      {   }
  myWindow = window.open("", "myWindow", "scrollbars=yes,width=1500,height=600");
  myWindow.document.write(TableResults);
}

function closeWin() {
  myWindow.close();
}
</script>          
          
          
                   
<script type="text/javascript"> 
    function showdetails(TableResults, simulation_scenario, fYear) {

      var fsimulation_scenarioLen = simulation_scenario.length;

      fCaption =  '<caption style="text-align:left"> <h3> Detail simulation results using Baseline Rates </h3></caption>';
      
      if (fYear != 1) 
	  {fCaption = '<caption style="text-align:left"> <h3> Detail simulation results using rates starting in ' + fYear + '</h3></caption>';}
      
      TableResults = TableResults + fCaption;
        
    
       TableResults = TableResults + '<table id = "Scenario_Results">' + 
                          '<thead>' +
                          '<tr>' +
                          '<th colspan="3" style="background-color:#4d7e80">Age</th> ' +
                          '<th colspan="6" style="background-color:#4da6ff">Spend Plan</th> ' +
                          '<th colspan="4" style="background-color:#ff66ff">Total Income</th> ' +
                          '<th colspan="1"> </th> ' +
                          '<th colspan="4" style="background-color:#666699">Withdraw Strategy </th> ' +
                       
                          '<th colspan="5" style="background-color:#E18973">Summary Account Activity</th> ' +
                          '<th colspan="1" style="background-color:#ff33cc"> </th> ' +
                          '<th colspan="3"> </th> ' +
                          '<th colspan="6" style="background-color:#33C0FF">You IRA Account Activity</th> ' +
                          '<th colspan="6" style="background-color:#D833FF">Spouse IRA Account Activity</th> ' +
                          '<th colspan="8" style="background-color:#000000">Brokerage Account Activity</th> ' +
                          '<th colspan="7" style="background-color:#FF9A33">Roth Account Activity</th> ' +
                          '<th colspan="12" style="background-color:#5F9EA0">Federal Income Tax Calculations</th> ' +
                          '<th colspan="14" style="background-color:#5F9EA0">Federal Tax Brackets</th> ' +
                          '<th colspan="9" style="background-color:#999966">Capital Gains Tax Calculation</th> ' +
                          '<th colspan="6" style="background-color:#999966">Capital Gains Tax Brackets</th> ' +
                          " </tr> " ;
 
      TableResults = TableResults + "<tr> " + 
                         '<th style="background-color:#4d7e80">Year</th> ' +
                         '<th style="background-color:#4d7e80">You</th> ' +
                         '<th style="background-color:#4d7e80">Sp</th> ' +
                         '<th style="background-color:#4da6ff">Budget</th> ' +
                         '<th style="background-color:#4da6ff">Mtge</th> ' +
                         '<th style="background-color:#4da6ff">Bonus</th> ' +
                         
                         '<th style="background-color:#4da6ff">Inc Tax</th> ' + 
                         '<th style="background-color:#4da6ff">Cap Gains Tax</th> ' +
                         '<th style="background-color:#4da6ff">Med B Prem</th> ' +
          
                         '<th style="background-color:#ff66ff">You Soc Sec</th> ' +
                         '<th style="background-color:#ff66ff">Sp Soc Sec</th> ' +
                         '<th style="background-color:#ff66ff">You Pension</th> ' +
                         '<th style="background-color:#ff66ff">Sp Pension</th> ' +
                         '<th>Withdraw From Savings</th> ' +
          
                          '<th style="background-color:#666699">You IRA</th> ' +
                          '<th style="background-color:#666699">Sp IRA</th> ' +
                          '<th style="background-color:#666699">Brkrg</th> ' +
                          '<th style="background-color:#666699">Roth HSA</th> ' +
          
          
// summary account info          
                         '<th style="background-color:#E18973">Beg Bal</th> ' +
                         '<th style="background-color:#E18973">Withdraw</th> ' +
                         '<th style="background-color:#E18973">Gain (Loss)</th> ' +
                         '<th style="background-color:#E18973">Deposit</th> ' +
                         '<th style="background-color:#E18973">End Bal</th> ' +
          
                         '<th style="background-color:#ff33cc">Baseline</th> ' +
	                 "<th>Stock Ret</th> " + 
                         "<th>Bond Ret</th> " +      
                         "<th>Inf Rate</th> " +

// you ira info
                         '<th style="background-color:#33C0FF">Beg Bal </th> ' +
                         '<th style="background-color:#33C0FF">Draw RMD </th> ' +
                         '<th style="background-color:#33C0FF">Draw Addl </th> ' +
                         '<th style="background-color:#33C0FF">Gain / Loss</th> ' +
                         '<th style="background-color:#33C0FF">Deposit </th> ' +
                         '<th style="background-color:#33C0FF">End Bal </th> ' +
// Spouse IRA activity
                         '<th style="background-color:#D833FF">Beg Bal </th> ' +
                         '<th style="background-color:#D833FF">Draw RMD </th> ' +
                         '<th style="background-color:#D833FF">Draw Addl </th> ' +
                         '<th style="background-color:#D833FF">Gain / Loss</th> ' +
                         '<th style="background-color:#D833FF">Deposit </th> ' +
                         '<th style="background-color:#D833FF">End Bal </th> ' +
// brokerage account activity          
                         '<th style="background-color:#000000">Beg Bal </th> ' +
                         '<th style="background-color:#000000">Draw / Deposit</th> ' +
                         '<th style="background-color:#000000">Gain / Loss</th> ' +
                         '<th style="background-color:#000000">Deposit </th> ' +
                         '<th style="background-color:#000000">End Bal </th> ' +

                         '<th style="background-color:#b3b3cc">Beg Cost Basis </th> ' +
                         '<th style="background-color:#b3b3cc">Adj Cost Basis </th> ' +
                         '<th style="background-color:#b3b3cc">End Cost Basis </th> ' +
// Roth account activity                        
                         '<th style="background-color:#FF9A33">Beg Bal </th> ' +
                         '<th style="background-color:#FF9A33">Draw / Deposit </th> ' +
                         '<th style="background-color:#FF9A33">Gain / Loss</th> ' +
                         '<th style="background-color:#FF9A33">Deposit </th> ' +
                         '<th style="background-color:#FF9A33">End Bal </th> ' +
                         '<th style="background-color:#993300">Conv You </th> ' +
                         '<th style="background-color:#993300">Conv Spouse </th> ' +
                                     
// income tax calcultion 
                         '<th style="background-color:#5F9EA0">IRA Draw</th> ' +
                         '<th style="background-color:#5F9EA0">Pension</th> ' +
                         '<th style="background-color:#5F9EA0">SS Taxable Amt </th> ' +
                         '<th style="background-color:#5F9EA0">SS Taxable Pct </th> ' +
                         '<th style="background-color:#5F9EA0">Brkrg Dist Taxable </th> ' +
                         '<th style="background-color:#5F9EA0">Adjusted Gross </th> ' +
                         '<th style="background-color:#5F9EA0">Std Deduct Nbr </th> ' +
                         '<th style="background-color:#5F9EA0">Std Deduct Amt </th> ' +
                         '<th style="background-color:#5F9EA0">Sr Deduct Nbr </th> ' +
                         '<th style="background-color:#5F9EA0">Sr Deduct Amt </th> ' +
                         '<th style="background-color:#5F9EA0">Taxable Income</th> ' +
                         '<th style="background-color:#5F9EA0">Est Tax</th> ' +   

  
                         "<th>Tax Married 10%</th> " +
                         "<th>Tax Married 12%</th> " +
                         "<th>Tax Married 22%</th> " +
                         "<th>Tax Married 24%</th> " +
                         "<th>Tax Married 32%</th> " +
                         "<th>Tax Married 35%</th> " + 
                         "<th>Tax Married 37%</th> " +
                         "<th>Tax Single 10%</th> " +
                         "<th>Tax Single 12%</th> " +
                         "<th>Tax Single 22%</th> " +
                         "<th>Tax Single 24%</th> " +
                         "<th>Tax Single 32%</th> " +
                         "<th>Tax Single 35%</th> " +
                         "<th>Tax Single 37%</th> " +
// capital gains tax calculation
          
                         '<th style="background-color:#999966">Adj Gross</th> ' + 
                         '<th style="background-color:#999966">Std Ded Nbr</th> ' + 
                         '<th style="background-color:#999966">Std Ded Amt</th> ' + 
                         '<th style="background-color:#999966">Sr Ded Nbr</th> ' + 
                         '<th style="background-color:#999966">Sr Ded Amt</th> ' + 
                         '<th style="background-color:#999966">Brkg Withdraw</th> ' + 
                         '<th style="background-color:#999966">Adj Cost Basis</th> ' + 
                         '<th style="background-color:#999966">Cap Gains</th> ' + 
                         '<th style="background-color:#999966">Cap Gains Tax</th> ' +  
                         
                         "<th>Tax Married 0%</th> " +
                         "<th>Tax Married 15%</th> " +
                         "<th>Tax Married 20%</th> " +

                         "<th>Tax Single 0%</th> " +
                         "<th>Tax Single 15%</th> " +
                         "<th>Tax Single 20%</th> " +
          
                         " </tr> " ;
     
      for (var i=0; i<fsimulation_scenarioLen; i++)
       
      {
         if (simulation_scenario[i].scenario_year == fYear)
          {
           fStockColor = setcolor(simulation_scenario[i].stockret);
           fGainColor = setcolor(simulation_scenario[i].total_gain_amt);
           fRoth_Background_Color  = setbackgroundcolor(simulation_scenario[i].roth_draw_amt1);  
           fBrkrg_Background_Color = setbackgroundcolor(simulation_scenario[i].brkrg_draw_amt);     
           
           fYou_IRA_Draw_Amt = simulation_scenario[i].you_rmd_draw_amt + simulation_scenario[i].you_ira_addl_draw_amt;
           fSpo_IRA_Draw_Amt = simulation_scenario[i].spo_rmd_draw_amt + simulation_scenario[i].spo_ira_addl_draw_amt;
              
                         
           TableResults = TableResults + "<tr>" +  
           '<td align = "right"> ' + simulation_scenario[i].year  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].you_age  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].spouse_age  + " </td> " +

// spend plan               
           '<td align = "right"> ' + addcomma(simulation_scenario[i].infadj_budget_amt)  + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].mortgage_budget_amt)  + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].bonus_amt)  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].inc_tax_amt  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].capgains_tax_amt  + " </td> " +      
           '<td align = "right"> ' + simulation_scenario[i].medb_premium_amt  + " </td> " +      
               
                     

// income
           '<td align = "right"> ' + addcomma(simulation_scenario[i].you_socsec_amt)  + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_socsec_amt)  + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].you_pension_amt)  + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_pension_amt)  + " </td> " +
// withdraw need
           '<td align = "right"> ' + addcomma(simulation_scenario[i].total_need_amt)   + " </td> " +

// withdraw strategy               
           '<td align = "right"> ' + addcomma(fYou_IRA_Draw_Amt * -1)+"</td> " +       
           '<td align = "right"> ' + addcomma(fSpo_IRA_Draw_Amt * -1)+"</td> " +       
           '<td ' + fBrkrg_Background_Color + '>' + addsign(addcomma(simulation_scenario[i].brkrg_draw_amt * -1)) + "</td> " +      
           '<td ' + fRoth_Background_Color  + '>' + addsign(addcomma(simulation_scenario[i].roth_draw_amt1 * -1))  + "</td> " +      

// summary account activity                  
           '<td align = "right"> ' + addcomma(simulation_scenario[i].beg_bal)   + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].total_draw_amt * -1)   + " </td> " +
           '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].total_gain_amt) + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].total_ann_dep_amt)   + " </td> " +    
           '<td align = "right"> ' + addcomma(simulation_scenario[i].end_bal)   + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].bas_end_bal)   + " </td> " +
             
           '<td ' + fStockColor + ' align = "right"> ' + (Math.round(simulation_scenario[i].stockret * 10000)/100) + "%"+ " </td> " +
           '<td align = "right"> ' + (Math.round(simulation_scenario[i].bondret * 10000)/100)  + "%"+ " </td> " +
           '<td align = "right"> ' + (Math.round(simulation_scenario[i].infrate * 10000)/100)  + "%"+ " </td> " +


           '<td align = "right"> ' + addcomma(simulation_scenario[i].you_ira_beg_bal_amt) + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].you_rmd_draw_amt * -1) + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].you_ira_addl_draw_amt * -1) + " </td> " +
           '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].you_ira_gain_amt) + " </td> " +
            '<td align = "right"> ' + addcomma(simulation_scenario[i].you_ira_ann_dep_amt) + " </td> " +      
           '<td align = "right"> ' + addcomma(simulation_scenario[i].you_ira_end_bal_amt) + " </td> " +

           '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_beg_bal_amt) + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_rmd_draw_amt * -1) + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_addl_draw_amt * -1) + " </td> " +
           '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_gain_amt) + " </td> " +
            '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_ann_dep_amt) + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_ira_end_bal_amt) + " </td> " +

           '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_beg_bal_amt) + " </]td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_draw_amt * -1) + " </td> " +
           '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].brkrg_gain_amt) + " </td> " +
            '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_ann_dep_amt) + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_end_bal_amt) + " </td> " +

           '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_beg_cost_basis_amt) + " </]td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_adj_cost_basis_amt) + " </]td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].brkrg_end_cost_basis_amt) + " </]td> " +

           '<td align = "right"> ' + addcomma(simulation_scenario[i].roth_beg_bal_amt)    + " </]td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].roth_draw_amt1 * -1)      + " </td> " +
           '<td ' + fGainColor + ' align = "right"> ' + addcomma(simulation_scenario[i].roth_gain_amt)       + " </td> " +
            '<td align = "right"> ' + addcomma(simulation_scenario[i].roth_ann_dep_amt) + " </td> " +   
           '<td align = "right"> ' + addcomma(simulation_scenario[i].roth_end_bal_amt)    + " </td> " +
            '<td align = "right"> ' + addcomma(simulation_scenario[i].you_roth_conv_amt) + " </td> " +
           '<td align = "right"> ' + addcomma(simulation_scenario[i].spo_roth_conv_amt) + " </td> " +
          
           '<td align = "right"> ' + simulation_scenario[i].ira_distribution_amt  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].pension_amt  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].socsec_taxable_amt  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].socsec_taxable_pct  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].brkrg_taxable_dist_amt  + " </td> " +       
           '<td align = "right"> ' + simulation_scenario[i].adjusted_gross_amt  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].std_deduct_nbr  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].std_deduct_amt  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].senior_deduct_nbr  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].senior_deduct_amt  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].curyr_taxable_income  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].curyr_inc_tax_amt  + " </td> " +

           '<td align = "right"> ' + simulation_scenario[i].taxtablemarried0    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablemarried1    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablemarried2    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablemarried3    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablemarried4    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablemarried5    + " </td> " +
           '<td align = "right"> ' + 'unlimited'    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablesingle0    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablesingle1    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablesingle2    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablesingle3    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablesingle4    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].taxtablesingle5    + " </td> " +
           '<td align = "right"> ' + 'unlimited'    + " </td> " +
            
           '<td align = "right"> ' + simulation_scenario[i].adjusted_gross_amt    + " </td> " +    
           '<td align = "right"> ' + simulation_scenario[i].std_deduct_nbr  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].std_deduct_amt  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].senior_deduct_nbr  + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].senior_deduct_amt  + " </td> " +
           '<td align = "right"> ' + (simulation_scenario[i].brkrg_draw_amt * -1) + " </td> " +       
           '<td align = "right"> ' + simulation_scenario[i].brkrg_adj_cost_basis_amt + " </]td> " +
           '<td align = "right"> ' + simulation_scenario[i].curyr_capgains_amt + " </]td> " +
           '<td align = "right"> ' + simulation_scenario[i].curyr_capgains_tax_amt + " </]td> " +
    
           '<td align = "right"> ' + simulation_scenario[i].captaxtable0_thru    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].captaxtable1_thru    + " </td> " +
           '<td align = "right"> ' + 'unlimited'   + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].captaxtable3_thru    + " </td> " +
           '<td align = "right"> ' + simulation_scenario[i].captaxtable4_thru    + " </td> " +
           '<td align = "right"> ' + 'unlimited'    + " </td> " +

           " </tr>" ;


          }
       }      

      TableResults = TableResults + "</table>";
       
      return TableResults;
 }
</script>

<script type="text/javascript">
 function show_scenario_summary(TableResults, scenario_summary, fFrm_You_Retire_End_Age, fNbr_Years,fWorst_Year, fBest_Year, fMedian_Year,fMost_Recent_Year) {
//***********************************************************************
//* show scenario summary
//***********************************************************************

      scenario_summary.sort(function(a, b){return a.scenario_year - b.scenario_year});      

      fscenario_summary_len = scenario_summary.length;

      TableResults = TableResults + '<table id = "Scenario_Results">' + 
                     '<thead>' +
                     '<tr>' + '<th colspan="9" style="background-color:#000000; text-align:center">Simulation Highlights </th> ' +
                    '<tr> ' + 
                    '<th style="background-color:#000000">Simulated Scenario</th> ' +
                    '<th style="background-color:#000000">Scenario Status</th> ' +
                    '<th style="background-color:#000000">Simulation Result</th> ' +
                    '<th style="background-color:#000000">Budget Spent</th> ' +
                    '<th style="background-color:#000000">Bonus Earned</th> ' +
                    '<th style="background-color:#000000">Avg Bonus </th> ' +
                    '<th style="background-color:#000000">Last Year Withdraw </th> ' +
                    '<th style="background-color:#000000">End Bal </th> ' +
                    '<th style="background-color:#000000">Years Remain </th> ' +
                    " </tr> " ;
     
      for (var i=0; i<fscenario_summary_len; i++)
       
      {
           fScenario_Status = "Success";
           fShow = "N";
           if (scenario_summary[i].end_bal == 0) {fScenario_Status = "Failed Case"; fShow = "Y";}
           if (scenario_summary[i].scenario_year == fWorst_Year) {fScenario_Status = "Worst Case"; fShow="Y";}
           if (scenario_summary[i].scenario_year == fBest_Year) {fScenario_Status = "Best Case"; fShow="Y";}
           if (scenario_summary[i].scenario_year == fMedian_Year) {fScenario_Status = "Median Case"; fShow="Y";}
           if (scenario_summary[i].scenario_year == 1) {fScenario_Status = "Baseline Plan"; fShow="Y";}
           if (scenario_summary[i].scenario_year == fMost_Recent_Year) {fScenario_Status = "Recent Case"; fShow="Y";}
           
           if (fShow == "Y")
            {   
              
              fYears_Remain = "unknown";  
              if (scenario_summary[i].total_draw_amt > 0)     
                  {fYears_Remain = Math.round(scenario_summary[i].end_bal / scenario_summary[i].total_draw_amt);}
                
              fBackGround = 'style="background-color:#ffffff">'; // default white 
              if (scenario_summary[i].end_bal == 0) 
               {fBackGround = 'style="background-color:#ffff00">'};  // set to yellow "background-color:#FF0000"

              fScenarioRange = scenario_summary[i].scenario_year + " thru " + (scenario_summary[i].scenario_year + fNbr_Years);
              if (scenario_summary[i].scenario_year == 1) {fScenarioRange = "Baseline";}
           
              fResult = "Success!" 
              if (scenario_summary[i].end_bal == 0) {fResult = "Savings exhausted in " + (scenario_summary[i].year);}

              TableResults = TableResults + "<tr " +  fBackGround + 
           
              '<td align = "center"> ' + fScenarioRange  + " </td> " +
              '<td align = "center"> ' + fScenario_Status  + " </td> " +
              
              '<td align = "center"> ' + fResult  + " </td> " +
              '<td align = "center"> '  + addcomma(scenario_summary[i].infadj_budget_running_total) + "</td> " +
              '<td align = "center"> '  + addcomma(scenario_summary[i].bonus_running_total) + "</td> " +
              '<td align = "center"> '  + Math.round((scenario_summary[i].bonus_running_total /
                                                   scenario_summary[i].infadj_budget_running_total)*100) + "%"      
                                                     + "</td> " +  
              '<td align = "center"> '  + addcomma(scenario_summary[i].total_draw_amt) + "</td> " +
              '<td align = "center"> '  + addcomma(scenario_summary[i].end_bal) + "</td> " +
              '<td align = "center"> ' + fYears_Remain  + " </td> " +
              " </tr>" ;
            }

       }      

      TableResults = TableResults + "</table>";
       
      return TableResults;
 }	
</script>

 <script type="text/javascript">
 function set_table_style() {
//****************************************************
//* set table style
//****************************************************

  fTable_Style = "<style> " +
               '#Scenario_Results {font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;  font-size: 14px; border-collapse: collapse; width: 100%; }' +
               '#Scenario_Results td, #Scenario_Results th {border: 1px solid #ddd;padding: 6px; }' +
               '#Scenario_Results tr:nth-child(even){background-color: #f2f2f2;}' +
               '#Scenario_Results tr:hover {background-color: #ddd;}' +
               '#Scenario_Results th {padding-top: 6px;padding-bottom: 6px;text-align: center;background-color: #4CAF50;color: white;}' +
               'thead tr:nth-child(1) th { position: sticky; top: 0; }' +
               'thead tr:nth-child(2) th { position: sticky; top: 27px; }' +
               '</style>';
  return fTable_Style;
}
</script>

    
     
<script type="text/javascript">
 function download_simulation_result_summary(scenario_summary, fFrm_You_Retire_End_Age, fNbr_Years) {

     scenario_summary.sort(function(a, b){return a.scenario_year - b.scenario_year});      

     fscenario_summary_len = scenario_summary.length;

     csv = "Scenario Year, Simulation Result, Budget Spent, Bonus Earned, Avg Bonus, Last Year Budget, End Bal, Years Remain, Score \r\n";   
     
     for (var i=0; i<fscenario_summary_len; i++)
       
      {
           fScenario_Status = "Success";
             
           fYears_Remain = Math.round(scenario_summary[i].end_bal / scenario_summary[i].infadj_budget_amt); 
           fAvg_Bonus = Math.round((scenario_summary[i].bonus_running_total / scenario_summary[i].infadj_budget_running_total)*100);
           
              fScenarioRange = scenario_summary[i].scenario_year + " thru " + (scenario_summary[i].scenario_year + fNbr_Years);
              if (scenario_summary[i].scenario_year == 1) {fScenarioRange = "Baseline";}
           
              fResult = "Success!" 
              if (scenario_summary[i].end_bal == 0) {fResult = "Savings exhausted in " + (scenario_summary[i].year);}
            
              csv = csv + fScenarioRange + "," + 
                    fResult + "," + scenario_summary[i].infadj_budget_running_total + 
                  "," + scenario_summary[i].bonus_running_total + 
                  "," + fAvg_Bonus + "%" + 
                  "," + scenario_summary[i].infadj_budget_amt + 
                  "," + scenario_summary[i].end_bal + 
                  "," + fYears_Remain  +
                  "," + scenario_summary[i].scenario_score + 
                  " \r\n" ;
    
       } 
     
     fileName = "RPS_sim_result_smry";
     let csvData = new Blob([csv], { type: 'text/csv' });  
     let csvUrl = URL.createObjectURL(csvData);
 
     let hiddenElement = document.createElement('a');
     hiddenElement.href = csvUrl;
     hiddenElement.target = '_blank';
     hiddenElement.download = fileName + '.csv';
     hiddenElement.click();

     
 }	
</script>    

<script type="text/javascript"> 
    function download_simulation_result_detail(simulation_scenario) {
 
      csv =  ",,Age,,Spend Plan,,,,,,Total Income,,,,,Withdraw Strategy,,,,Summary Account Activity,,,,,,,,," + 
               "You IRA Account Activity,,,,,,Spouse IRA Account Activity,,,,,,Brokerage Account Activity,,,,,,,," + 
               "Roth Account Activity,,,,,,,Federal Income Tax Calculations,,,,,,,,,,," + 
               "Federal Tax Brackets,,,,,,,,,,,,,,Capital Gains Tax Calculation,,,,,,,,," + 
               "Capital Gains Tax Brackets,,,,,," + 
               " \r\n" ;
                         
      csv = csv +  
               "Scenario, Year, You, Spouse, Budget, Mortgage,Bonus, Inc Tax, Cap Gains Tax, Med B Prem, You Soc Sec, " +
               "Spouse Soc Sec, You Pension, Spouse Pension, Withdraw From Savings, You IRA, Spouse IRA," +
               "Brokerage, Roth HSA, Beg Bal, Withdraw, Gain(Loss), Deposit, End Bal, " +
               "Baseline, Stock Ret, Bond Ret, Inf Rate," +
               "Beg Bal, Draw RMD ,Draw Addl, Gain / Loss, Deposit, End Bal," +
               "Beg Bal, Draw RMD, Draw Addl, Gain / Loss, Deposit, End Bal," +
               "Beg Bal, Draw / Deposit, Gain / Loss, Deposit, End Bal," +
               "Beg Cost Basis, Adj Cost Basis, End Cost Basis," +
               "Beg Bal , Draw / Deposit, Gain / Loss, Deposit, End Bal, Conv You, Conv Spouse," +
               "IRA Draw, Pension, SS Taxable Amt, SS Taxable Pct, Brkrg Taxable Dist, Adjusted Gross, Std Deduct Nbr, Std Deduct Amt," +
               "Sr Deduct Nbr, Sr Deduct Amt, Taxable Income, Est Tax," +   
               "Tax Married 10% , Tax Married 12%, Tax Married 22%, Tax Married 24%, " +
               "Tax Married 32%, Tax Married 35% , Tax Married 37% , Tax Single 10%, " +
               "Tax Single 12% , Tax Single 22% , Tax Single 24%, Tax Single 32%, " +
               "Tax Single 35% , Tax Single 37%, Adj Gross, Std Ded Nbr, Std Ded Amt, " + 
               "Sr Ded Nbr , Sr Ded Amt, Brkg Withdraw, Adj Cost Basis, Cap Gains, Cap Gains Tax, " +  
               "Tax Married 0%, Tax Married 15%, Tax Married 20%, Tax Single 0%, Tax Single 15%, Tax Single 20%, " +
               " \r\n";     

       var fsimulation_scenarioLen = simulation_scenario.length;
        
for (var i=0; i<fsimulation_scenarioLen; i++)
   
  {
         
     fYou_IRA_Draw_Amt = simulation_scenario[i].you_rmd_draw_amt + simulation_scenario[i].you_ira_addl_draw_amt;
     fSpo_IRA_Draw_Amt = simulation_scenario[i].spo_rmd_draw_amt + simulation_scenario[i].spo_ira_addl_draw_amt;
     
     csv = csv + simulation_scenario[i].scenario_year + 
       "," + simulation_scenario[i].year + "," + simulation_scenario[i].you_age + "," + simulation_scenario[i].spouse_age +
       "," + simulation_scenario[i].infadj_budget_amt + "," + simulation_scenario[i].mortgage_budget_amt + "," + simulation_scenario[i].bonus_amt +
       "," + simulation_scenario[i].inc_tax_amt + "," +  simulation_scenario[i].capgains_tax_amt + 
       "," +  simulation_scenario[i].medb_premium_amt +
       "," +  simulation_scenario[i].you_socsec_amt +
       "," + simulation_scenario[i].spo_socsec_amt + "," + simulation_scenario[i].you_pension_amt + "," +  simulation_scenario[i].spo_pension_amt +
       "," + simulation_scenario[i].total_need_amt + "," + (fYou_IRA_Draw_Amt * -1) + "," + (fSpo_IRA_Draw_Amt * -1) + "," + (simulation_scenario[i].brkrg_draw_amt * -1) +  
       "," + (simulation_scenario[i].roth_draw_amt1 * -1) + "," +  simulation_scenario[i].beg_bal + "," +  (simulation_scenario[i].total_draw_amt * -1)  +
       "," + simulation_scenario[i].total_gain_amt + "," +  simulation_scenario[i].total_ann_dep_amt  + "," +  simulation_scenario[i].end_bal  +
       "," + simulation_scenario[i].bas_end_bal  + "," +  (Math.round(simulation_scenario[i].stockret * 10000)/100) + "%" + 
       "," + (Math.round(simulation_scenario[i].bondret * 10000)/100) + "%" + "," +  (Math.round(simulation_scenario[i].infrate * 10000)/100) + "%" +
       "," + simulation_scenario[i].you_ira_beg_bal_amt + "," +  (simulation_scenario[i].you_rmd_draw_amt * -1) + "," + (simulation_scenario[i].you_ira_addl_draw_amt * -1) +
       "," + simulation_scenario[i].you_ira_gain_amt + "," +  simulation_scenario[i].you_ira_ann_dep_amt + "," +  simulation_scenario[i].you_ira_end_bal_amt +
       "," + simulation_scenario[i].spo_ira_beg_bal_amt + "," +  (simulation_scenario[i].spo_rmd_draw_amt * -1) + "," +  (simulation_scenario[i].spo_ira_addl_draw_amt * -1) +
       "," + simulation_scenario[i].spo_ira_gain_amt +  "," +  simulation_scenario[i].spo_ira_ann_dep_amt + "," +  simulation_scenario[i].spo_ira_end_bal_amt +
       "," + simulation_scenario[i].brkrg_beg_bal_amt + "," +  (simulation_scenario[i].brkrg_draw_amt * -1) + "," +  simulation_scenario[i].brkrg_gain_amt +
       "," + simulation_scenario[i].brkrg_ann_dep_amt + "," +  simulation_scenario[i].brkrg_end_bal_amt + "," +  simulation_scenario[i].brkrg_beg_cost_basis_amt + 
       "," +  simulation_scenario[i].brkrg_adj_cost_basis_amt + "," +  simulation_scenario[i].brkrg_end_cost_basis_amt + "," +  simulation_scenario[i].roth_beg_bal_amt  + 
       "," +  (simulation_scenario[i].roth_draw_amt1 * -1)  + "," +  simulation_scenario[i].roth_gain_amt + "," +  simulation_scenario[i].roth_ann_dep_amt +  
       "," +  simulation_scenario[i].roth_end_bal_amt  + "," +  simulation_scenario[i].you_roth_conv_amt + "," +  simulation_scenario[i].spo_roth_conv_amt +
       "," +  simulation_scenario[i].ira_distribution_amt + "," +  simulation_scenario[i].pension_amt + "," +  simulation_scenario[i].socsec_taxable_amt +
       "," +  simulation_scenario[i].socsec_taxable_pct +
       "," +  simulation_scenario[i].brkrg_taxable_dist_amt +
       "," +  simulation_scenario[i].adjusted_gross_amt + "," +  simulation_scenario[i].std_deduct_nbr +
       "," +  simulation_scenario[i].std_deduct_amt + "," +  simulation_scenario[i].senior_deduct_nbr + "," +  simulation_scenario[i].senior_deduct_amt +
       "," +  simulation_scenario[i].curyr_taxable_income + "," +  simulation_scenario[i].curyr_inc_tax_amt + "," +  simulation_scenario[i].taxtablemarried0  +
       "," +  simulation_scenario[i].taxtablemarried1  + "," +  simulation_scenario[i].taxtablemarried2 + "," +  simulation_scenario[i].taxtablemarried3  +
       "," +  simulation_scenario[i].taxtablemarried4  + "," +  simulation_scenario[i].taxtablemarried5  +  "," +  "unlimited"  +
       "," +  simulation_scenario[i].taxtablesingle0  + "," +  simulation_scenario[i].taxtablesingle1  + "," +  simulation_scenario[i].taxtablesingle2  +
       "," +  simulation_scenario[i].taxtablesingle3  + "," +  simulation_scenario[i].taxtablesingle4  + "," +  simulation_scenario[i].taxtablesingle5  +
       "," +  "unlimited"  + "," +  simulation_scenario[i].adjusted_gross_amt  + "," +  simulation_scenario[i].std_deduct_nbr + "," +  simulation_scenario[i].std_deduct_amt +
       "," +  simulation_scenario[i].senior_deduct_nbr + "," +  simulation_scenario[i].senior_deduct_amt + "," +  (simulation_scenario[i].brkrg_draw_amt * -1) +   
       "," +  simulation_scenario[i].brkrg_adj_cost_basis_amt + "," +  simulation_scenario[i].curyr_capgains_amt + "," +  simulation_scenario[i].curyr_capgains_tax_amt + 
       "," +  simulation_scenario[i].captaxtable0_thru  + "," +  simulation_scenario[i].captaxtable1_thru  + "," +  "unlimited"  +
       "," +  simulation_scenario[i].captaxtable3_thru  + "," +  simulation_scenario[i].captaxtable4_thru  + "," +  "unlimited"  +
      " \r\n"; 

   }
        
        
     fileName = "RPS_sim_result_dtl";
     let csvData = new Blob([csv], { type: 'text/csv' });  
     let csvUrl = URL.createObjectURL(csvData);
 
     let hiddenElement = document.createElement('a');
     hiddenElement.href = csvUrl;
     hiddenElement.target = '_blank';
     hiddenElement.download = fileName + '.csv';
     hiddenElement.click();

     
 }	
</script> 
    
    
<script type="text/javascript">
 function downloadrates () {

                csv = "col1,, col3,, col5 \r\n";
                csv = csv + "col1,col2,col3,col4,col5"
                fileName = "RPS_scenario_result_summary";   
            let csvData = new Blob([csv], { type: 'text/csv' });  
            let csvUrl = URL.createObjectURL(csvData);
 
            let hiddenElement = document.createElement('a');
            hiddenElement.href = csvUrl;
            hiddenElement.target = '_blank';
            hiddenElement.download = fileName + '.csv';
            hiddenElement.click();
       }
</script>

<script type="text/javascript">
 function setcolor (fInput) {

    fColor='style="color:black;"';   
    if (fInput < 0)
      {fColor = 'style="color:red;"';}
 
    return fColor;
       }
</script>

<script type="text/javascript">
 function setbackgroundcolor (fInput) {

    fBackground_Color=' align = "right" ';   
    if (fInput < 0)
      {fBackground_Color = ' style="background-color:#e6ffee" align = "right" ';}
 
    return fBackground_Color;
       }
</script>
    
<script type="text/javascript">
 function addcomma (fInput) {
	
    fWithComma = fInput.toLocaleString(); 
    return fWithComma;

       }
</script>
          
    
<script type="text/javascript">
 function addsign (fInput) {
	     
    fWithSign = fInput;
    if (fInput > "0") {fWithSign = "+" + fInput} 
    return fWithSign;

       }
</script>

<script>
function getcurrentyear() {
  var d = new Date();
  var n = d.getFullYear();
  return n;
}
</script>


<! ************************************ -- >
<! adjst tax variables by inflation rate -- >
<! ************************************* -- >
<script>
function infadj_tax_variables_func(infrate) {
    
   infadj_std_deduct_married = Math.round(infadj_std_deduct_married * (1+infrate));
   infadj_std_deduct_single  = Math.round(infadj_std_deduct_single * (1+infrate));
   infadj_senior_deduct_amt  = Math.round(infadj_senior_deduct_amt * (1+infrate));

   infadj_from = 0;
   for (ri=0; ri < TaxTableMarriedLen; ri++)
    {infadj_taxtable_married[ri].from = infadj_from; 
     infadj_taxtable_married[ri].thru = Math.round(infadj_taxtable_married[ri].thru*(1+infrate));
     infadj_from = infadj_taxtable_married[ri].thru + 1;    
    }

  infadj_from = 0;
  for (ri=0; ri < TaxTableSingleLen; ri++)
    {infadj_taxtable_single[ri].from = infadj_from;
     infadj_taxtable_single[ri].thru = Math.round(infadj_taxtable_single[ri].thru*(1+infrate));
     infadj_from = infadj_taxtable_single[ri].thru + 1;
    }

  lFile_Status = "single";
  infadj_from = 0;
  for (ri=0; ri < capgains_taxtable_len; ri++)
    {if (capgains_taxtable[ri].file_status == lFile_Status)
        {infadj_capgains_taxtable[ri].from = infadj_from;
         infadj_capgains_taxtable[ri].thru = Math.round(infadj_capgains_taxtable[ri].thru*(1+infrate));
         infadj_from = infadj_capgains_taxtable[ri].thru + 1;
        }
    }

  lFile_Status = "married";
  infadj_from = 0;
  for (ri=0; ri < capgains_taxtable_len; ri++)
    {if (capgains_taxtable[ri].file_status == lFile_Status)
        {infadj_capgains_taxtable[ri].from = infadj_from;
         infadj_capgains_taxtable[ri].thru = Math.round(infadj_capgains_taxtable[ri].thru*(1+infrate));
         infadj_from = infadj_capgains_taxtable[ri].thru + 1;
        }
    } 
    
  lFile_Status = "single";
  infadj_from = 0;
  for (ri=0; ri < medb_premium_table_len; ri++)
    {if (medb_premium_table[ri].file_status == lFile_Status)
        {infadj_medb_premium_table[ri].adj_gross_from = infadj_from;
         infadj_medb_premium_table[ri].adj_gross_thru = Math.round(infadj_medb_premium_table[ri].adj_gross_thru*(1+infrate));
         infadj_medb_premium_table[ri].mthly_rate = Math.round(infadj_medb_premium_table[ri].mthly_rate*(1+infrate));
         infadj_from = infadj_medb_premium_table[ri].adj_gross_thru + 1;
        }
    } 
  
  lFile_Status = "married";
  infadj_from = 0;
  for (ri=0; ri < medb_premium_table_len; ri++)
    {if (medb_premium_table[ri].file_status == lFile_Status)
        {infadj_medb_premium_table[ri].adj_gross_from = infadj_from;
         infadj_medb_premium_table[ri].adj_gross_thru = Math.round(infadj_medb_premium_table[ri].adj_gross_thru*(1+infrate));
         infadj_medb_premium_table[ri].mthly_rate = Math.round(infadj_medb_premium_table[ri].mthly_rate*(1+infrate));
         infadj_from = infadj_medb_premium_table[ri].adj_gross_thru + 1;
        }
    } 
  return; 
}
</script>


<script>
function calc_rmd_age(fCurrent_Year, fCurrent_Age) {
//******************************************************** 
// calculate rmd age 
// If turn age 70 in 2019 or earlier, must start taking RMD at age 70.
// Otherwise, must start taking RMD age 72
//********************************************************          
          
    fRMD_Age = 72;
    fYear_Born = fCurrent_Year - fCurrent_Age;   
    fYear_Turn70 = fYear_Born + 70;
    if (fYear_Turn70 <= 2019) {fRMD_Age = 70;}
    return fRMD_Age;
}
</script>
    

<script>
function calc_rmd(fAge, fIRA_Bal_Amt, fRMD_Age) {
//******************************************************** 
// calculate rmd function 
//********************************************************
    
  fRMD_Amt = 0;
         
  if(fAge < fRMD_Age) {return fRMD_Amt};
  if(fAge > 114) {return fRMD_Amt};

  if (fIRA_Bal_Amt <= 0) {return fRMD_Amt};

  var ri = fAge - 70;

  var fFactor = rmdtable[ri].factor * 1;
  
  fRMD_Amt = Math.round(fIRA_Bal_Amt / fFactor);
 
  return fRMD_Amt;

}
</script>
 

<! ********************** -- >
<! calculate social security taxable -- >
<! ********************** -- >
<script>
function calc_socsec_taxable_func(fAdjusted_Gross_Amt, fSocSec_Amt, fExemptions) {

   var line1_amt = fSocSec_Amt; 
   var line2_amt = Math.round(line1_amt * .50);
   var line3_amt = fAdjusted_Gross_Amt;
   var line4_amt = 0;
   var line5_amt = line2_amt + line3_amt + line4_amt;
   var line6_amt = 0;
   var line7_amt = line5_amt - line6_amt;
   var line8_amt = 25000;
   if (fExemptions==2) {line8_amt=32000};
   var line9_amt = line7_amt - line8_amt;
   if (line9_amt < 0) {line9_amt = 0};
   var line10_amt = 9000;
   if (fExemptions==2) {line10_amt = 12000};
   var line11_amt = line9_amt - line10_amt;
   if (line11_amt < 0) {line11_amt = 0};
   var line12_amt = Math.min(line9_amt, line10_amt);
   var line13_amt = Math.round(line12_amt * .50);
   var line14_amt = Math.min(line2_amt, line13_amt);
   var line15_amt = Math.round(line11_amt * .85);
   var line16_amt = line14_amt + line15_amt;
   var line17_amt = Math.round(line1_amt * .85);
   var line18_amt = Math.min(line16_amt, line17_amt);

   var fSocSec_Taxable_Amt = line18_amt;
   
   return fSocSec_Taxable_Amt;

}
</script>   



<script>
function calc_income_tax(fAdjusted_Gross_Amt, fExemptions, fYou_Age, fSpo_Age) {
//****************************************************************
//* calculate income tax function
//****************************************************************
   
   var fThru=0;
   var fTax_Amt=0;
   var fSenior_Deduct_Nbr = 0;
   var fUsed_Std_Deduct_Amt = 0;
   var fTaxable_Income_Pre = 0;
   var fTaxable_Income = 0;    

   if (fYou_Age >= 65) {fSenior_Deduct_Nbr++;}
   if (fSpo_Age >=65) {fSenior_Deduct_Nbr++};
   
   fSenior_Deduct_Nbr = Math.min(fSenior_Deduct_Nbr, fExemptions);
  
   fSenior_Deduct_Amt = infadj_senior_deduct_amt * fSenior_Deduct_Nbr;

   if (fExemptions == 1)
     {
       fUsed_Std_Deduct_Amt = infadj_std_deduct_single;
       fTaxable_Income_Pre = fAdjusted_Gross_Amt - infadj_std_deduct_single - infadj_senior_deduct_amt;
       fTaxable_Income = Math.max(0,fTaxable_Income_Pre);
       for (ri=0; ri < TaxTableSingleLen; ri++)
        {fThru = Math.min(fTaxable_Income, infadj_taxtable_single[ri].thru);
         fTax_Amt = fTax_Amt + Math.round((fThru - infadj_taxtable_single[ri].from) * taxtablesingle[ri].pct);
         if (fThru == fTaxable_Income) 
              {   fTax_Top_Pct = taxtablesingle[ri].pct;
                  fTax_Top_Amt = taxtablesingle[ri].thru;
                  break;
              }
        } 
    }

   if (fExemptions != 1)
     {
       fUsed_Std_Deduct_Amt = infadj_std_deduct_married;
       fTaxable_Income_Pre = fAdjusted_Gross_Amt - infadj_std_deduct_married - fSenior_Deduct_Amt;
       fTaxable_Income = Math.max(0,fTaxable_Income_Pre);
       if (fTaxable_Income < 0) {fTaxable_Income = 0};
       for (ri=0; ri < TaxTableMarriedLen; ri++)
        {fThru = Math.min(fTaxable_Income, infadj_taxtable_married[ri].thru);
         fTax_Amt = fTax_Amt + Math.round((fThru - infadj_taxtable_married[ri].from) * taxtablemarried[ri].pct);
         if (fThru == fTaxable_Income)
         {
            fTax_Top_Pct = taxtablemarried[ri].pct;
            fTax_Top_Amt = taxtablemarried[ri].thru;
            break;
         }
        } 
    }

    oTax_Results = {taxable_income    : fTaxable_Income,
                    taxable_income_pre : fTaxable_Income_Pre,
                    inc_tax_amt       : fTax_Amt,
                    senior_deduct_nbr : fSenior_Deduct_Nbr,
                    senior_deduct_amt : fSenior_Deduct_Amt,
                    std_deduct_amt    : fUsed_Std_Deduct_Amt,
                    top_pct           : fTax_Top_Pct,
                    top_amt           : fTax_Top_Amt};
  
    return oTax_Results  
  
}
</script>

<script>
function calc_capgains_tax(fAdjusted_Gross_Amt, fDeductions_Amt, fCapgains_Amt, fExemptions) {
//****************************************************************
//* calculate capital gains tax
//****************************************************************
   
   var fThru=0;
   var fTax_Amt=0;
  
   fFile_Status = "married";
   if (fExemptions == 1) {lFile_Status = "single";}

   fTaxable_Income = fAdjusted_Gross_Amt -fDeductions_Amt + fCapgains_Amt;       
  
   if (fTaxable_Income < 0)  {fTaxable_Income = 0;}
  
   for (ri=0; ri < capgains_taxtable_len; ri++)
        {
         if (fFile_Status == capgains_taxtable[ri].file_status) 
         
           {fThru = Math.min(fTaxable_Income, infadj_capgains_taxtable[ri].thru);
            fTax_Amt = fTax_Amt + Math.round((fThru - infadj_capgains_taxtable[ri].from) * capgains_taxtable[ri].pct);
            if (fThru == fTaxable_Income) {break;}
           }
        } 

    oCapgains_Tax_Results = {total_income    : fTaxable_Income,
                             tax_amt         : fTax_Amt};

    return oCapgains_Tax_Results;  
  
}
</script>

<script>
function calc_medb_premium (fAdjusted_Gross_Amt, fExemptions, fYou_Age, fYou_Retire_End_Age, fSpo_Age, fSpo_Retire_End_Age, fFrm_Spo_Current_Age) {
//****************************************************************
//* calculate medicare b premium
//****************************************************************
   
   var fMedb_Premium_Amt=0;
  
   fFile_Status = "married";
   if (fExemptions == 1) {lFile_Status = "single";}

   fMedb_Factor = 0;    
   if (fYou_Age >= 65 && fYou_Age <= fYou_Retire_End_Age) {fMedb_Factor++;}
   if (fFrm_Spo_Current_Age > 0 && fSpo_Age >= 65 && fSpo_Age <= fSpo_Retire_End_Age) {fMedb_Factor++;}
    
   for (ri=0; ri < medb_premium_table_len; ri++)
        {if (fFile_Status == medb_premium_table[ri].file_status) 
         
           {if (infadj_medb_premium_table[ri].adj_gross_from <= fAdjusted_Gross_Amt)
             {if (infadj_medb_premium_table[ri].adj_gross_thru >= fAdjusted_Gross_Amt) 
                {fMedb_Premium_Amt = Math.round(infadj_medb_premium_table[ri].mthly_rate * 12); 
                 break;
                }
             }
          } 
        }
    
    fMedb_Premium_Amt = Math.round(fMedb_Premium_Amt * fMedb_Factor
                                  );
    return fMedb_Premium_Amt;  
  
}
</script>

<! ********************************* -- >
<! define internal hard coded tables -- >
<! ********************************* -- >
<script type="text/javascript">

//********************
//* constants
//********************

var myWindow;

// var socsec_taxable_pct = .85;
var cBudget_Single_Adj = .75;
var cBudget_Full = 1;
 
var stddeductmarried = 25100;
var stddeductsingle = 12550;

var senior_deduct_amt = 1350;

var taxtablemarried = new Array( );
taxtablemarried[0] = {pct:.10, from:0, thru:19900};
taxtablemarried[1] = {pct:.12, from:19901, thru:81050};
taxtablemarried[2] = {pct:.22, from:81051, thru:172750};
taxtablemarried[3] = {pct:.24, from:172751, thru:329850};
taxtablemarried[4] = {pct:.32, from:329851, thru:418850};
taxtablemarried[5] = {pct:.35, from:418851, thru:628300};
taxtablemarried[6] = {pct:.37, from:628301, thru:9999999999};
var TaxTableMarriedLen = taxtablemarried.length;

var taxtablesingle = new Array( );
taxtablesingle[0] = {pct:.10, from:0, thru:9950};
taxtablesingle[1] = {pct:.12, from:9951, thru:40525};
taxtablesingle[2] = {pct:.22, from:40526, thru:86375};
taxtablesingle[3] = {pct:.24, from:86376, thru:164925};
taxtablesingle[4] = {pct:.32, from:164926, thru:209425};
taxtablesingle[5] = {pct:.35, from:209426, thru:523600};
taxtablesingle[6] = {pct:.37, from:523601, thru:9999999999};
var TaxTableSingleLen = taxtablesingle.length;

var infadj_taxtable_married = new Array();
var infadj_taxtable_single = new Array();

var capgains_taxtable = new Array( );
capgains_taxtable[0] = {file_status: "married", pct:.0,  from:0, thru: 80800};
capgains_taxtable[1] = {file_status: "married", pct:.15, from:80801, thru: 501600};
capgains_taxtable[2] = {file_status: "married", pct:.20, from:501601, thru: 999999999};
capgains_taxtable[3] = {file_status: "single", pct:.0, from:0, thru: 40400};
capgains_taxtable[4] = {file_status: "single", pct:.15, from:40401, thru: 445850};
capgains_taxtable[5] = {file_status: "single", pct:.20, from:445851, thru: 999999999};
var infadj_capgains_taxtable = new Array();
var capgains_taxtable_len = capgains_taxtable.length;

var medb_premium_table = new Array( );
medb_premium_table[0] = {file_status: "married", adj_gross_from:0,      adj_gross_thru:176000,    mthly_rate:144.60};
medb_premium_table[1] = {file_status: "married", adj_gross_from:176001, adj_gross_thru:222000,    mthly_rate:202.40};
medb_premium_table[2] = {file_status: "married", adj_gross_from:222001, adj_gross_thru:276000,    mthly_rate:289.20};
medb_premium_table[3] = {file_status: "married", adj_gross_from:276001, adj_gross_thru:330000,    mthly_rate:376.00};
medb_premium_table[4] = {file_status: "married", adj_gross_from:330001, adj_gross_thru:749999,    mthly_rate:462.70};
medb_premium_table[5] = {file_status: "married", adj_gross_from:750000, adj_gross_thru:999999999, mthly_rate:491.60};
medb_premium_table[6] =  {file_status: "single", adj_gross_from:0,      adj_gross_thru:88000,     mthly_rate:144.60};
medb_premium_table[7] =  {file_status: "single", adj_gross_from:88001,  adj_gross_thru:111000,    mthly_rate:202.40};
medb_premium_table[8] =  {file_status: "single", adj_gross_from:111001, adj_gross_thru:138000,    mthly_rate:289.20};
medb_premium_table[9] =  {file_status: "single", adj_gross_from:138001, adj_gross_thru:165000,    mthly_rate:376.00};
medb_premium_table[10] = {file_status: "single", adj_gross_from:165001, adj_gross_thru:499999,    mthly_rate:462.70};
medb_premium_table[11] = {file_status: "single", adj_gross_from:500000, adj_gross_thru:999999999, mthly_rate:491.60};
var infadj_medb_premium_table = new Array();
var medb_premium_table_len = medb_premium_table.length;
    
var rmdtable = new Array( );
rmdtable[0]={age:70,factor:27.4};
rmdtable[1]={age:71,factor:26.5};
rmdtable[2]={age:72,factor:25.6};
rmdtable[3]={age:73,factor:24.7};
rmdtable[4]={age:74,factor:23.8};
rmdtable[5]={age:75,factor:22.9};
rmdtable[6]={age:76,factor:22};
rmdtable[7]={age:77,factor:21.2};
rmdtable[8]={age:78,factor:20.3};
rmdtable[9]={age:79,factor:19.5};
rmdtable[10]={age:80,factor:18.7};
rmdtable[11]={age:81,factor:17.9};
rmdtable[12]={age:82,factor:17.1};
rmdtable[13]={age:83,factor:16.3};
rmdtable[14]={age:84,factor:15.5};
rmdtable[15]={age:85,factor:14.8};
rmdtable[16]={age:86,factor:14.1};
rmdtable[17]={age:87,factor:13.4};
rmdtable[18]={age:88,factor:12.7};
rmdtable[19]={age:89,factor:12};
rmdtable[20]={age:90,factor:11.4};
rmdtable[21]={age:91,factor:10.8};
rmdtable[22]={age:92,factor:10.2};
rmdtable[23]={age:93,factor:9.6};
rmdtable[24]={age:94,factor:9.1};
rmdtable[25]={age:95,factor:8.6};1
rmdtable[26]={age:96,factor:8.1};
rmdtable[27]={age:97,factor:7.6};
rmdtable[28]={age:98,factor:7.1};
rmdtable[29]={age:99,factor:6.7};
rmdtable[30]={age:100,factor:6.3};
rmdtable[31]={age:101,factor:5.9};
rmdtable[32]={age:102,factor:5.5};
rmdtable[33]={age:103,factor:5.2};
rmdtable[34]={age:104,factor:4.9};
rmdtable[35]={age:105,factor:4.5};
rmdtable[36]={age:106,factor:4.2};
rmdtable[37]={age:107,factor:3.9};
rmdtable[38]={age:108,factor:3.7};
rmdtable[39]={age:109,factor:3.4};
rmdtable[40]={age:110,factor:3.1};
rmdtable[41]={age:111,factor:2.9};
rmdtable[42]={age:112,factor:2.6};
rmdtable[43]={age:113,factor:2.4};
rmdtable[44]={age:114,factor:2.1};

var ratehistory = new Array( );
ratehistory[0]={year:1,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[1]={year:2,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[2]={year:3,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[3]={year:4,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[4]={year:5,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[5]={year:6,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[6]={year:7,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[7]={year:8,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[8]={year:9,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[9]={year:10,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[10]={year:11,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[11]={year:12,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[12]={year:13,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[13]={year:14,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[14]={year:15,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[15]={year:16,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[16]={year:17,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[17]={year:18,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[18]={year:19,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[19]={year:20,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[20]={year:21,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[21]={year:22,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[22]={year:23,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[23]={year:24,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[24]={year:25,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[25]={year:26,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[26]={year:27,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[27]={year:28,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[28]={year:29,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[29]={year:30,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[30]={year:31,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[31]={year:32,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[32]={year:33,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[33]={year:34,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[34]={year:35,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[35]={year:36,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[36]={year:37,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[37]={year:38,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[38]={year:39,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[39]={year:40,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[40]={year:41,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[41]={year:42,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[42]={year:43,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[43]={year:44,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[44]={year:45,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[45]={year:46,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[46]={year:47,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[47]={year:48,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[48]={year:49,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[49]={year:50,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[50]={year:51,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[51]={year:52,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[52]={year:53,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[53]={year:54,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[54]={year:55,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[55]={year:56,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[56]={year:57,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[57]={year:58,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[58]={year:59,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[59]={year:60,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[60]={year:61,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[61]={year:62,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[62]={year:63,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[63]={year:64,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[64]={year:65,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[65]={year:66,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[66]={year:67,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[67]={year:68,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[68]={year:69,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[69]={year:70,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[70]={year:71,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[71]={year:72,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[72]={year:73,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[73]={year:74,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[74]={year:75,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[75]={year:76,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[76]={year:77,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[77]={year:78,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[78]={year:79,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[79]={year:80,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[80]={year:81,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[81]={year:82,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[82]={year:83,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[83]={year:84,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[84]={year:85,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[85]={year:86,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[86]={year:87,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[87]={year:88,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[88]={year:89,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[89]={year:90,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[90]={year:91,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[91]={year:92,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[92]={year:93,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[93]={year:94,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[94]={year:95,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[95]={year:96,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[96]={year:97,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[97]={year:98,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[98]={year:99,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[99]={year:1871,stockret:0.153153153153153,bondret:0.0212553637532494,stret:0.001,infrate:0.0152703841869837};
ratehistory[100]={year:1872,stockret:0.113168724279835,bondret:0.0288240237798081,stret:0.001,infrate:0.0225546197715387};
ratehistory[101]={year:1873,stockret:-0.0234833659491194,bondret:0.0774599629857013,stret:0.001,infrate:-0.0441205189536444};
ratehistory[102]={year:1874,stockret:0.0450643776824033,bondret:0.0976598620842785,stret:0.001,infrate:-0.0692256608835582};
ratehistory[103]={year:1875,stockret:0.0484581497797356,bondret:0.057911632751384,stret:0.001,infrate:-0.0578560055368655};
ratehistory[104]={year:1876,stockret:-0.136771300448431,bondret:0.052027106248068,stret:0.001,infrate:0.00877373733183062};
ratehistory[105]={year:1877,stockret:-0.0309859154929577,bondret:0.0469414400350844,stret:0.001,infrate:-0.156524529005441};
ratehistory[106]={year:1878,stockret:0.156923076923077,bondret:0.0560331725343479,stret:0.001,infrate:-0.103088177941891};
ratehistory[107]={year:1879,stockret:0.483240223463687,bondret:0.0308435241791622,stret:0.001,infrate:0.20689993389814};
ratehistory[108]={year:1880,stockret:0.262230919765166,bondret:0.0518793123318672,stret:0.001,infrate:-0.0571463370791754};
ratehistory[109]={year:1881,stockret:0.00807754442649422,bondret:0.0258369069071908,stret:0.001,infrate:0.0808075461293276};
ratehistory[110]={year:1882,stockret:0.035472972972973,bondret:0.0276424291862264,stret:0.001,infrate:-0.018687481459799};
ratehistory[111]={year:1883,stockret:-0.0516351118760757,bondret:0.0242199228168512,stret:0.001,infrate:-0.0761978087091533};
ratehistory[112]={year:1884,stockret:-0.121621621621622,bondret:0.0596426626493975,stret:0.001,infrate:-0.103088177941891};
ratehistory[113]={year:1885,stockret:0.283018867924528,bondret:0.0355393139973929,stret:0.001,infrate:-0.0344839646058768};
ratehistory[114]={year:1886,stockret:0.115384615384615,bondret:-0.0105932769191623,stret:0.001,infrate:0};
ratehistory[115]={year:1887,stockret:-0.00358422939068104,bondret:0.0419715580110716,stret:0.001,infrate:0.0476228036470563};
ratehistory[116]={year:1888,stockret:0.0301318267419963,bondret:0.0450218572208278,stret:0.001,infrate:-0.0454579677735809};
ratehistory[117]={year:1889,stockret:0.0687022900763357,bondret:0.0160906761096121,stret:0.001,infrate:-0.0476187622228839};
ratehistory[118]={year:1890,stockret:-0.0594795539033458,bondret:0.00934040970430049,stret:0.001,infrate:0.0249998426754119};
ratehistory[119]={year:1891,stockret:0.183884297520661,bondret:0.0684203519776777,stret:0.001,infrate:-0.0609757544980468};
ratehistory[120]={year:1892,stockret:0.0617059891107079,bondret:-0.0555225949378768,stret:0.001,infrate:0.0779227171496126};
ratehistory[121]={year:1893,stockret:-0.185383244206774,bondret:0.127731066308756,stret:0.001,infrate:-0.132530774527851};
ratehistory[122]={year:1894,stockret:0.0324074074074074,bondret:0.0487013618150021,stret:0.001,infrate:-0.0416658327839196};
ratehistory[123]={year:1895,stockret:0.0494117647058823,bondret:-0.0212513346702084,stret:0.001,infrate:0.014492039697962};
ratehistory[124]={year:1896,stockret:0.0304449648711944,bondret:0.080550180116677,stret:0.001,infrate:-0.0285712574052278};
ratehistory[125]={year:1897,stockret:0.199052132701422,bondret:0.0313949136081484,stret:0.001,infrate:0.0294115833230459};
ratehistory[126]={year:1898,stockret:0.286885245901639,bondret:0.0432300601737456,stret:0.001,infrate:0.0142862367930638};
ratehistory[127]={year:1899,stockret:0.037828947368421,bondret:0.00196844731895423,stret:0.001,infrate:0.169014169155746};
ratehistory[128]={year:1900,stockret:0.208196721311475,bondret:0.033652131443141,stret:0.001,infrate:-0.0240972527213217};
ratehistory[129]={year:1901,stockret:0.193776520509194,bondret:0.0147542876441459,stret:0.001,infrate:0.0246922685570026};
ratehistory[130]={year:1902,stockret:0.0825123152709362,bondret:0.00638161543530338,stret:0.001,infrate:0.0963859211400004};
ratehistory[131]={year:1903,stockret:-0.16903073286052,bondret:0.0441541152816623,stret:0.001,infrate:-0.0439557396033233};
ratehistory[132]={year:1904,stockret:0.308383233532934,bondret:0.029912497920552,stret:0.001,infrate:0.0229834465802512};
ratehistory[133]={year:1905,stockret:0.209964412811388,bondret:0.00753068514054997,stret:0.001,infrate:0};
ratehistory[134]={year:1906,stockret:0.0091185410334349,bondret:0.00395887972979252,stret:0.001,infrate:0.0449437169931834};
ratehistory[135]={year:1907,stockret:-0.23744769874477,bondret:0.0385349869455703,stret:0.001,infrate:-0.0215007520306443};
ratehistory[136]={year:1908,stockret:0.381021897810219,bondret:0.069420543354555,stret:0.001,infrate:0.0329644658952528};
ratehistory[137]={year:1909,stockret:0.161147902869757,bondret:0.000268116170742674,stret:0.001,infrate:0.106387023659985};
ratehistory[138]={year:1910,stockret:-0.0337301587301587,bondret:0.0554753207443843,stret:0.001,infrate:-0.0673132767170651};
ratehistory[139]={year:1911,stockret:0.034519956850054,bondret:0.0299457845122516,stret:0.001,infrate:-0.0103026741760966};
ratehistory[140]={year:1912,stockret:0.0723684210526319,bondret:-0.00173769976795725,stret:0.001,infrate:0.0729137984925561};
ratehistory[141]={year:1913,stockret:-0.0483870967741936,bondret:0.0684629514768394,stret:0.001,infrate:0.0204081632653061};
ratehistory[142]={year:1914,stockret:-0.0561529271206689,bondret:0.0547145092558399,stret:0.001,infrate:0.01};
ratehistory[143]={year:1915,stockret:0.304812834224599,bondret:0.0484786661951609,stret:0.001,infrate:0.0297029702970297};
ratehistory[144]={year:1916,stockret:0.0857449088960345,bondret:0.0219855810711883,stret:0.001,infrate:0.125};
ratehistory[145]={year:1917,stockret:-0.174503657262278,bondret:-0.00294963838637064,stret:0.001,infrate:0.196581196581197};
ratehistory[146]={year:1918,stockret:0.167822468793343,bondret:0.0500912472502583,stret:0.001,infrate:0.178571428571429};
ratehistory[147]={year:1919,stockret:0.192356687898089,bondret:-0.00668849798107463,stret:0.001,infrate:0.16969696969697};
ratehistory[148]={year:1920,stockret:-0.137032842582106,bondret:0.0350329699241148,stret:0.001,infrate:-0.0155440414507773};
ratehistory[149]={year:1921,stockret:0.091420534458509,bondret:0.124977016899033,stret:0.001,infrate:-0.110526315789474};
ratehistory[150]={year:1922,stockret:0.289041095890411,bondret:0.0311212550977657,stret:0.001,infrate:-0.00591715976331353};
ratehistory[151]={year:1923,stockret:0.0516853932584269,bondret:0.0617622484462111,stret:0.001,infrate:0.0297619047619047};
ratehistory[152]={year:1924,stockret:0.260475651189128,bondret:0.0534598219466315,stret:0.001,infrate:0};
ratehistory[153]={year:1925,stockret:0.252362948960303,bondret:0.0348557429858359,stret:0.001,infrate:0.0346820809248554};
ratehistory[154]={year:1926,stockret:0.113833992094862,bondret:0.0451022875953433,stret:0.001,infrate:-0.0223463687150838};
ratehistory[155]={year:1927,stockret:0.350689008325525,bondret:0.0218907129770603,stret:0.001,infrate:-0.0114285714285713};
ratehistory[156]={year:1928,stockret:0.394276447844722,bondret:-0.00692794319205517,stret:0.001,infrate:-0.0115606936416185};
ratehistory[157]={year:1929,stockret:-0.103731294283247,bondret:0.0745419978589835,stret:0.001,infrate:0};
ratehistory[158]={year:1930,stockret:-0.274119363527636,bondret:0.0607005906548342,stret:0.001,infrate:-0.0701754385964913};
ratehistory[159]={year:1931,stockret:-0.427719428788206,bondret:0.00440719285251874,stret:0.001,infrate:-0.10062893081761};
ratehistory[160]={year:1932,stockret:-0.0638348708922421,bondret:0.0870618678173011,stret:0.001,infrate:-0.0979020979020979};
ratehistory[161]={year:1933,stockret:0.585308556856514,bondret:0.0521809033951037,stret:0.001,infrate:0.0232558139534882};
ratehistory[162]={year:1934,stockret:0.0327061598003463,bondret:0.0523179528625882,stret:0.001,infrate:0.0303030303030303};
ratehistory[163]={year:1935,stockret:0.463713877385725,bondret:0.0366419519331466,stret:0.001,infrate:0.0147058823529413};
ratehistory[164]={year:1936,stockret:0.331322091714451,bondret:0.0262233658815844,stret:0.001,infrate:0.0217391304347825};
ratehistory[165]={year:1937,stockret:-0.341506631683092,bondret:0.0341906748607561,stret:0.001,infrate:0.0285714285714287};
ratehistory[166]={year:1938,stockret:0.309261563938269,bondret:0.0421561540270421,stret:0.001,infrate:-0.0277777777777778};
ratehistory[167]={year:1939,stockret:0.00406567339769562,bondret:0.0322804344179993,stret:0.001,infrate:0};
ratehistory[168]={year:1940,stockret:-0.0781291072263155,bondret:0.0351036162080177,stret:0.001,infrate:0.00714285714285712};
ratehistory[169]={year:1941,stockret:-0.10833010600515,bondret:0.00165366653835666,stret:0.001,infrate:0.0992907801418439};
ratehistory[170]={year:1942,stockret:0.168734984385113,bondret:0.0263620239556437,stret:0.001,infrate:0.0903225806451613};
ratehistory[171]={year:1943,stockret:0.279422196671501,bondret:0.026911648218254,stret:0.001,infrate:0.029585798816568};
ratehistory[172]={year:1944,stockret:0.224463323156854,bondret:0.0312739459004057,stret:0.001,infrate:0.0229885057471266};
ratehistory[173]={year:1945,stockret:0.393110437071433,bondret:0.0327490491133885,stret:0.001,infrate:0.0224719101123594};
ratehistory[174]={year:1946,stockret:-0.0561906278487703,bondret:0.0169019779985107,stret:0.001,infrate:0.181318681318681};
ratehistory[175]={year:1947,stockret:0.0387904527472535,bondret:0.0105224701400308,stret:0.001,infrate:0.0883720930232556};
ratehistory[176]={year:1948,stockret:0.0195824087938391,bondret:0.025529097179551,stret:0.001,infrate:0.02991452991453};
ratehistory[177]={year:1949,stockret:0.208917979500585,bondret:0.0282216607736968,stret:0.001,infrate:-0.020746887966805};
ratehistory[178]={year:1950,stockret:0.300221098831054,bondret:-0.000833467706634825,stret:0.001,infrate:0.0593220338983049};
ratehistory[179]={year:1951,stockret:0.227505355301606,bondret:0.0156403118071938,stret:0.001,infrate:0.0600000000000001};
ratehistory[180]={year:1952,stockret:0.143807211323979,bondret:0.0165198757358595,stret:0.001,infrate:0.00754716981132075};
ratehistory[181]={year:1953,stockret:0.00462144207441692,bondret:0.0540113281011815,stret:0.001,infrate:0.00749063670411987};
ratehistory[182]={year:1954,stockret:0.507213750264095,bondret:0.0174280600045754,stret:0.001,infrate:-0.00743494423791824};
ratehistory[183]={year:1955,stockret:0.264257387397203,bondret:0.00115177147146674,stret:0.001,infrate:0.00374531835205993};
ratehistory[184]={year:1956,stockret:0.0828815841631355,bondret:-0.00536849853302352,stret:0.001,infrate:0.0298507462686568};
ratehistory[185]={year:1957,stockret:-0.0973811055881423,bondret:0.061096103261293,stret:0.001,infrate:0.0289855072463767};
ratehistory[186]={year:1958,stockret:0.464358287563684,bondret:-0.0254849210782948,stret:0.001,infrate:0.017605633802817};
ratehistory[187]={year:1959,stockret:0.139932049531493,bondret:-0.00582804131571712,stret:0.001,infrate:0.0173010380622838};
ratehistory[188]={year:1960,stockret:0.0182095695788734,bondret:0.107261707120722,stret:0.001,infrate:0.0136054421768708};
ratehistory[189]={year:1961,stockret:0.265660887598086,bondret:0.0236384444315387,stret:0.001,infrate:0.00671140939597303};
ratehistory[190]={year:1962,stockret:-0.0871890179016051,bondret:0.0569218178458915,stret:0.001,infrate:0.0133333333333332};
ratehistory[191]={year:1963,stockret:0.213814486258914,bondret:0.0142372606557761,stret:0.001,infrate:0.0164473684210527};
ratehistory[192]={year:1964,stockret:0.16349389449103,bondret:0.0389323282884954,stret:0.001,infrate:0.00970873786407767};
ratehistory[193]={year:1965,stockret:0.142877921710299,bondret:0.00736843850475463,stret:0.001,infrate:0.0192307692307694};
ratehistory[194]={year:1966,stockret:-0.086638802197373,bondret:0.048680106791521,stret:0.001,infrate:0.0345911949685533};
ratehistory[195]={year:1967,stockret:0.271971083565984,bondret:-0.00116100619583429,stret:0.001,infrate:0.0303951367781155};
ratehistory[196]={year:1968,stockret:0.14412482868446,bondret:0.0214580405208461,stret:0.001,infrate:0.0471976401179941};
ratehistory[197]={year:1969,stockret:-0.106003158045348,bondret:-0.025619795454562,stret:0.001,infrate:0.0619718309859156};
ratehistory[198]={year:1970,stockret:0,bondret:0.170853925006197,stret:0.001,infrate:0.0557029177718831};
ratehistory[199]={year:1971,stockret:0.1615,bondret:0.0771976236557229,stret:0.001,infrate:0.0326633165829147};
ratehistory[200]={year:1972,stockret:0.1684,bondret:0.0302365033660715,stret:0.001,infrate:0.0340632603406326};
ratehistory[201]={year:1973,stockret:-0.1806,bondret:0.0358100393543043,stret:0.001,infrate:0.0870588235294118};
ratehistory[202]={year:1974,stockret:-0.2704,bondret:0.0438722474438586,stret:0.001,infrate:0.123376623376623};
ratehistory[203]={year:1975,stockret:0.3875,bondret:0.067164855484078,stret:0.001,infrate:0.0693641618497109};
ratehistory[204]={year:1976,stockret:0.2676,bondret:0.113710084116097,stret:0.001,infrate:0.0486486486486486};
ratehistory[205]={year:1977,stockret:-0.0426,bondret:0.0256956793792824,stret:0.001,infrate:0.0670103092783505};
ratehistory[206]={year:1978,stockret:0.0749,bondret:0.016757486317392,stret:0.001,infrate:0.0901771336553945};
ratehistory[207]={year:1979,stockret:0.2262,bondret:0.0171369094108753,stret:0.001,infrate:0.132939438700148};
ratehistory[208]={year:1980,stockret:0.3281,bondret:0.0240185159508059,stret:0.001,infrate:0.1251629726206};
ratehistory[209]={year:1981,stockret:-0.0365,bondret:0.0435888820300159,stret:0.001,infrate:0.0892236384704519};
ratehistory[210]={year:1982,stockret:0.21,bondret:0.351633020317275,stret:0.001,infrate:0.0382978723404255};
ratehistory[211]={year:1983,stockret:0.2198,bondret:0.0517051303447352,stret:0.001,infrate:0.0379098360655739};
ratehistory[212]={year:1984,stockret:0.0451,bondret:0.131544205474741,stret:0.001,infrate:0.0394866732477788};
ratehistory[213]={year:1985,stockret:0.3217,bondret:0.215784954385898,stret:0.001,infrate:0.0379867046533713};
ratehistory[214]={year:1986,stockret:0.1619,bondret:0.191393379350936,stret:0.001,infrate:0.010978956999085};
ratehistory[215]={year:1987,stockret:0.0167,bondret:0.00204337892141823,stret:0.001,infrate:0.044343891402715};
ratehistory[216]={year:1988,stockret:0.1803,bondret:0.0535977976145876,stret:0.001,infrate:0.0441941074523395};
ratehistory[217]={year:1989,stockret:0.2886,bondret:0.133419835618274,stret:0.001,infrate:0.0464730290456432};
ratehistory[218]={year:1990,stockret:-0.0596,bondret:0.094120096117738,stret:0.001,infrate:0.0610626486915149};
ratehistory[219]={year:1991,stockret:0.3467,bondret:0.146132112948595,stret:0.001,infrate:0.0306427503736921};
ratehistory[220]={year:1992,stockret:0.098,bondret:0.0778,stret:0.001,infrate:0.0290065264684554};
ratehistory[221]={year:1993,stockret:0.1062439,bondret:0.1143246,stret:0.001,infrate:0.0274841437632136};
ratehistory[222]={year:1994,stockret:-0.0016865,bondret:-0.0432623,stret:0.001,infrate:0.0267489711934155};
ratehistory[223]={year:1995,stockret:0.3578528,bondret:0.2044167,stret:0.001,infrate:0.0253841015364062};
ratehistory[224]={year:1996,stockret:0.2096198,bondret:0.0191815,stret:0.001,infrate:0.0332247557003258};
ratehistory[225]={year:1997,stockret:0.3099493,bondret:0.0895729,stret:0.001,infrate:0.0170239596469106};
ratehistory[226]={year:1998,stockret:0.2326422,bondret:0.1060622,stret:0.001,infrate:0.0161190328580285};
ratehistory[227]={year:1999,stockret:0.2381314,bondret:-0.0352199,stret:0.001,infrate:0.0268456375838926};
ratehistory[228]={year:2000,stockret:-0.1057467,bondret:0.140309,stret:0.001,infrate:0.0338680926916219};
ratehistory[229]={year:2001,stockret:-0.1096591,bondret:0.0754739,stret:0.001,infrate:0.0155172413793103};
ratehistory[230]={year:2002,stockret:-0.2096089,bondret:0.141481,stret:0.001,infrate:0.0237691001697793};
ratehistory[231]={year:2003,stockret:0.313538,bondret:0.0236803,stret:0.001,infrate:0.0187949143173025};
ratehistory[232]={year:2004,stockret:0.1251571,bondret:0.0340293,stret:0.001,infrate:0.032555615843733};
ratehistory[233]={year:2005,stockret:0.059804,bondret:0.02316,stret:0.001,infrate:0.0341565948502365};
ratehistory[234]={year:2006,stockret:0.1551101,bondret:0.0313647,stret:0.001,infrate:0.0254065040650406};
ratehistory[235]={year:2007,stockret:0.0548951,bondret:0.0997935,stret:0.001,infrate:0.0408126858275519};
ratehistory[236]={year:2008,stockret:-0.3703776,bondret:0.1332444,stret:0.001,infrate:0.000914129006456044};
ratehistory[237]={year:2009,stockret:0.2869796,bondret:-0.0168526,stret:0.001,infrate:0.0272133112620583};
ratehistory[238]={year:2010,stockret:0.1709371,bondret:0.0735455,stret:0.001,infrate:0.0149572352731431};
ratehistory[239]={year:2011,stockret:0.0096204,bondret:0.0979512,stret:0.001,infrate:0.029624188448711};
ratehistory[240]={year:2012,stockret:0.1625301,bondret:0.0267462,stret:0.001,infrate:0.0174102236874756};
ratehistory[241]={year:2013,stockret:0.3334968,bondret:-0.0308716,stret:0.001,infrate:0.0150173561961839};
ratehistory[242]={year:2014,stockret:0.1242925,bondret:0.0431725,stret:0.001,infrate:0.00756493269655745};
ratehistory[243]={year:2015,stockret:0.0029369,bondret:0.0150475,stret:0.001,infrate:0.00729519786041588};
ratehistory[244]={year:2016,stockret:0.125333112125257,bondret:0.0118665028716585,stret:0.001,infrate:0.021};
ratehistory[245]={year:2017,stockret:0.210515319460834,bondret:0.0157377447702158,stret:0.001,infrate:0.021};
ratehistory[246]={year:2018,stockret:-0.0528,bondret:0.0100286505951323,stret:0.001,infrate:0.019};
ratehistory[247]={year:2019,stockret:0.3092,bondret:0.0628798680072757,stret:0.001,infrate:0.0171};
ratehistory[248]={year:2020,stockret:0.08,bondret:0.0820617115200492,stret:0.001,infrate:0.0125};
ratehistory[249]={year:2021,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[250]={year:2022,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[251]={year:2023,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[252]={year:2024,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[253]={year:2025,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[254]={year:2026,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[255]={year:2027,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[256]={year:2028,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[257]={year:2029,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[258]={year:2030,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[259]={year:2031,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[260]={year:2032,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[261]={year:2033,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[262]={year:2034,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[263]={year:2035,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[264]={year:2036,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[265]={year:2037,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[266]={year:2038,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[267]={year:2039,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[268]={year:2040,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[269]={year:2041,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[270]={year:2042,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[271]={year:2043,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[272]={year:2044,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[273]={year:2045,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[274]={year:2046,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[275]={year:2047,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[276]={year:2048,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[277]={year:2049,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[278]={year:2050,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[279]={year:2051,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[280]={year:2052,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[281]={year:2053,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[282]={year:2054,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[283]={year:2055,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[284]={year:2056,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[285]={year:2057,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[286]={year:2058,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[287]={year:2059,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[288]={year:2060,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[289]={year:2061,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[290]={year:2062,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[291]={year:2063,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[292]={year:2064,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[293]={year:2065,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[294]={year:2066,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[295]={year:2067,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[296]={year:2068,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[297]={year:2069,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[298]={year:2070,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[299]={year:2071,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[300]={year:2072,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[301]={year:2073,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[302]={year:2074,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[303]={year:2075,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[304]={year:2076,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[305]={year:2077,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[306]={year:2078,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[307]={year:2079,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[308]={year:2080,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[309]={year:2081,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[310]={year:2082,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[311]={year:2083,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[312]={year:2084,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[313]={year:2085,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[314]={year:2086,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[315]={year:2087,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[316]={year:2088,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[317]={year:2089,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[318]={year:2090,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[319]={year:2091,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[320]={year:2092,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[321]={year:2093,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[322]={year:2094,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[323]={year:2095,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[324]={year:2096,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[325]={year:2097,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[326]={year:2098,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[327]={year:2099,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[328]={year:2100,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[329]={year:2101,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[330]={year:2102,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[331]={year:2103,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[332]={year:2104,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[333]={year:2105,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[334]={year:2106,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[335]={year:2107,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[336]={year:2108,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[337]={year:2109,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[338]={year:2110,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[339]={year:2111,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[340]={year:2112,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[341]={year:2113,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[342]={year:2114,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[343]={year:2115,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[344]={year:2116,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[345]={year:2117,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[346]={year:2118,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[347]={year:2119,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[348]={year:2120,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[349]={year:2121,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[350]={year:2122,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[351]={year:2123,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[352]={year:2124,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[353]={year:2125,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[354]={year:2126,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[355]={year:2127,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[356]={year:2128,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[357]={year:2129,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[358]={year:2130,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[359]={year:2131,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[360]={year:2132,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[361]={year:2133,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[362]={year:2134,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[363]={year:2135,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[364]={year:2136,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[365]={year:2137,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[366]={year:2138,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[367]={year:2139,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[368]={year:2140,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[369]={year:2141,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[370]={year:2142,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[371]={year:2143,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[372]={year:2144,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[373]={year:2145,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[374]={year:2146,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[375]={year:2147,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[376]={year:2148,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[377]={year:2149,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[378]={year:2150,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[379]={year:2151,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[380]={year:2152,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[381]={year:2153,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[382]={year:2154,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[383]={year:2155,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[384]={year:2156,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[385]={year:2157,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[386]={year:2158,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[387]={year:2159,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[388]={year:2160,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[389]={year:2161,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[390]={year:2162,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[391]={year:2163,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[392]={year:2164,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[393]={year:2165,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[394]={year:2166,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[395]={year:2167,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};
ratehistory[396]={year:2168,stockret:0.06,bondret:0.03,stret:0.02,infrate:0.0225};



</script>
 </body>
</html>

